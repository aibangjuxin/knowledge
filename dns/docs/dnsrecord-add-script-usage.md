# GCP Cloud DNS è®°å½•æ‰¹é‡æ·»åŠ è„šæœ¬ä½¿ç”¨è¯´æ˜

## è„šæœ¬åŠŸèƒ½

è‡ªåŠ¨è§£æåŸŸååˆ—è¡¨ä¸­çš„æ‰€æœ‰åŸŸåï¼Œæå–å®Œæ•´çš„ CNAME é“¾å’Œ A è®°å½•ï¼Œå¹¶å°†å®ƒä»¬æ‰¹é‡æ·»åŠ åˆ°æŒ‡å®šçš„ GCP Cloud DNS Zone ä¸­ã€‚

## ä¸»è¦ç‰¹æ€§

âœ… **è‡ªåŠ¨è§£æ CNAME é“¾**: å®Œæ•´è¿½è¸ª CNAME è·³è½¬é“¾è·¯  
âœ… **æå– A è®°å½•**: è‡ªåŠ¨è·å–æœ€ç»ˆçš„ IP åœ°å€  
âœ… **æ‰¹é‡å¯¼å…¥**: ä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªåŸŸå  
âœ… **éªŒè¯åŠŸèƒ½**: å¯¼å…¥åè‡ªåŠ¨éªŒè¯è®°å½•æ˜¯å¦æ·»åŠ æˆåŠŸ  
âœ… **å½©è‰²è¾“å‡º**: æ¸…æ™°çš„å¯è§†åŒ–åé¦ˆ  
âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æ£€æŸ¥å’Œæç¤º

## é…ç½®è¯´æ˜

### 1. ä¿®æ”¹è„šæœ¬é…ç½®

ç¼–è¾‘è„šæœ¬å¼€å¤´çš„é…ç½®åŒºåŸŸ:

```bash
# GCP é¡¹ç›® ID
PROJECT_ID="your-project-id"

# é»˜è®¤ DNS Zone åç§°
DEFAULT_ZONE_NAME="private-access"

# éœ€è¦æ·»åŠ çš„åŸŸååˆ—è¡¨
DOMAINS=(
    "www.example.com"
    "api.example.com"
    "login.microsoft.com"
    "graph.microsoft.com"
)
```

### 2. åŸŸååˆ—è¡¨æ ¼å¼

åœ¨ `DOMAINS` æ•°ç»„ä¸­æ·»åŠ éœ€è¦å¤„ç†çš„åŸŸåï¼Œæ¯è¡Œä¸€ä¸ª:

```bash
DOMAINS=(
    "login.microsoft.com"
    "graph.microsoft.com"
    "outlook.office365.com"
    "www.googleapis.com"
)
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®(è„šæœ¬ä¸­å®šä¹‰çš„ PROJECT_ID å’Œ DEFAULT_ZONE_NAME)
./dnsrecord-add-script.sh

# æŒ‡å®šé¡¹ç›® ID
./dnsrecord-add-script.sh -p my-gcp-project

# æŒ‡å®š DNS Zone
./dnsrecord-add-script.sh -z my-custom-zone

# åŒæ—¶æŒ‡å®šé¡¹ç›®å’Œ Zone
./dnsrecord-add-script.sh -p my-gcp-project -z my-custom-zone

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
./dnsrecord-add-script.sh -h
```

## å·¥ä½œæµç¨‹

è„šæœ¬æ‰§è¡Œä»¥ä¸‹æ­¥éª¤:

1. **åˆ—å‡ºæ‰€æœ‰ DNS Zones**: æ˜¾ç¤ºå½“å‰é¡¹ç›®ä¸­çš„æ‰€æœ‰ Cloud DNS Zones
2. **éªŒè¯ Zone å­˜åœ¨**: æ£€æŸ¥æŒ‡å®šçš„ Zone æ˜¯å¦å­˜åœ¨
3. **è§£æåŸŸå**: ä½¿ç”¨ `host` å‘½ä»¤è§£ææ¯ä¸ªåŸŸå
4. **æå–è®°å½•**: 
   - è¿½è¸ªå®Œæ•´çš„ CNAME é“¾ (å¦‚æœå­˜åœ¨)
   - æå–æœ€ç»ˆçš„ A è®°å½•å’Œ IP åœ°å€
5. **åˆ›å»ºäº‹åŠ¡**: ç”Ÿæˆ DNS è®°å½•å¯¼å…¥æ–‡ä»¶
6. **å¯¼å…¥è®°å½•**: ä½¿ç”¨ `gcloud dns record-sets import` å¯¼å…¥
7. **éªŒè¯ç»“æœ**: æŸ¥è¯¢å¹¶æ˜¾ç¤ºæ·»åŠ çš„è®°å½•

## è¾“å‡ºç¤ºä¾‹

```
========================================
GCP Cloud DNS è®°å½•æ‰¹é‡æ·»åŠ å·¥å…·
========================================
é¡¹ç›® ID: my-project
DNS Zone: private-access
åŸŸåæ•°é‡: 2

å½“å‰é¡¹ç›®çš„ DNS Zones:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DNS_NAME            â”‚ CREATION_TIMEâ”‚ NAME         â”‚ NETWORKS â”‚ DESCRIPTION â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ private.example.com.â”‚ 2024-01-01   â”‚ private-zone â”‚ vpc-net  â”‚ Private DNS â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

========================================
å¤„ç†åŸŸå: login.microsoft.com
========================================
è§£æåŸŸå: login.microsoft.com
  CNAME: login.microsoft.com -> login.mso.msidentity.com
  CNAME: login.mso.msidentity.com -> ak.privatelink.msidentity.com
  A Record: ak.privatelink.msidentity.com -> 20.190.160.1

ä¸º login.microsoft.com åˆ›å»º DNS è®°å½•...
  æ·»åŠ  CNAME: login.microsoft.com. -> login.mso.msidentity.com.
  æ·»åŠ  CNAME: login.mso.msidentity.com. -> ak.privatelink.msidentity.com.
  æ·»åŠ  A Record: ak.privatelink.msidentity.com. -> 20.190.160.1

å¯¼å…¥ DNS è®°å½•åˆ° Zone: private-access
âœ“ æˆåŠŸå¯¼å…¥ DNS è®°å½•

éªŒè¯ login.microsoft.com çš„ DNS è®°å½•...
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NAME                             â”‚ TYPE  â”‚ TTL â”‚ RRDATAS                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ login.microsoft.com.             â”‚ CNAME â”‚ 300 â”‚ login.mso.msidentity.com.    â”‚
â”‚ login.mso.msidentity.com.        â”‚ CNAME â”‚ 300 â”‚ ak.privatelink.msidentity... â”‚
â”‚ ak.privatelink.msidentity.com.   â”‚ A     â”‚ 300 â”‚ 20.190.160.1                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

========================================
å¤„ç†å®Œæˆ
========================================
æ€»åŸŸåæ•°: 2
æˆåŠŸ: 2
å¤±è´¥: 0
========================================
```

## æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦æé†’

1. **æƒé™è¦æ±‚**: ç¡®ä¿æœ‰ Cloud DNS ç®¡ç†æƒé™
2. **Zone å¿…é¡»å­˜åœ¨**: ç›®æ ‡ DNS Zone å¿…é¡»æå‰åˆ›å»º
3. **åŸŸåå¯è§£æ**: åŸŸåå¿…é¡»èƒ½å¤Ÿé€šè¿‡å…¬ç½‘ DNS è§£æ
4. **è®°å½•å†²çª**: å¦‚æœè®°å½•å·²å­˜åœ¨,å¯¼å…¥å¯èƒ½å¤±è´¥

### ğŸ” æ•…éšœæ’é™¤

#### é—®é¢˜: "DNS Zone ä¸å­˜åœ¨"
**è§£å†³**: 
```bash
# æŸ¥çœ‹å¯ç”¨çš„ Zones
gcloud dns managed-zones list

# æˆ–åˆ›å»ºæ–° Zone
gcloud dns managed-zones create private-access \
    --dns-name="private.example.com." \
    --description="Private DNS Zone" \
    --visibility=private \
    --networks=default
```

#### é—®é¢˜: "æ— æ³•è§£æåŸŸå"
**è§£å†³**: 
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤åŸŸåæ‹¼å†™æ­£ç¡®
- å°è¯•æ‰‹åŠ¨æ‰§è¡Œ `host domain.com` éªŒè¯

#### é—®é¢˜: "å¯¼å…¥å¤±è´¥"
**è§£å†³**:
- æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤è®°å½•
- æŸ¥çœ‹äº‹åŠ¡æ–‡ä»¶å†…å®¹ (è„šæœ¬ä¼šä¿ç•™å¤±è´¥çš„äº‹åŠ¡æ–‡ä»¶)
- æ‰‹åŠ¨åˆ é™¤å†²çªè®°å½•åé‡è¯•

## é«˜çº§ç”¨æ³•

### å¤„ç†å¤§é‡åŸŸå

å¦‚æœæœ‰å¤§é‡åŸŸåéœ€è¦å¤„ç†,å»ºè®®:

1. åˆ†æ‰¹å¤„ç†,æ¯æ‰¹ 10-20 ä¸ªåŸŸå
2. åœ¨éé«˜å³°æ—¶æ®µæ‰§è¡Œ
3. ä¿å­˜è„šæœ¬è¾“å‡ºæ—¥å¿—:

```bash
./dnsrecord-add-script.sh 2>&1 | tee dns-import-$(date +%Y%m%d).log
```

### è‡ªå®šä¹‰ TTL

ä¿®æ”¹è„šæœ¬ä¸­çš„ TTL å€¼ (é»˜è®¤ 300 ç§’):

```bash
# åœ¨ create_dns_transaction å‡½æ•°ä¸­ä¿®æ”¹
ttl: 300  # æ”¹ä¸ºä½ éœ€è¦çš„å€¼,å¦‚ 3600
```

### ä»…é¢„è§ˆä¸å¯¼å…¥

æ³¨é‡Šæ‰å¯¼å…¥éƒ¨åˆ†,åªæŸ¥çœ‹å°†è¦æ·»åŠ çš„è®°å½•:

```bash
# åœ¨ main å‡½æ•°ä¸­æ³¨é‡Šæ‰
# import_dns_records "$ZONE_NAME" "$transaction_file"
```

## ä¾èµ–è¦æ±‚

- `gcloud` CLI å·¥å…·
- `host` å‘½ä»¤ (é€šå¸¸é¢„è£…åœ¨ Linux/macOS)
- æœ‰æ•ˆçš„ GCP è®¤è¯

## ç›¸å…³å‘½ä»¤

```bash
# æ‰‹åŠ¨æŸ¥çœ‹ Zone ä¸­çš„æ‰€æœ‰è®°å½•
gcloud dns record-sets list --zone=private-access

# åˆ é™¤ç‰¹å®šè®°å½•
gcloud dns record-sets delete example.com. \
    --type=CNAME \
    --zone=private-access

# æ‰‹åŠ¨æ·»åŠ å•æ¡è®°å½•
gcloud dns record-sets create test.example.com. \
    --rrdatas="192.168.1.1" \
    --type=A \
    --ttl=300 \
    --zone=private-access
```
