## **ä¸€ã€é—®é¢˜åˆ†æ**

Loon ç°åœ¨åœ¨ **DNS å±‚**æ”¯æŒä¸‰ç§â€œåŠ å¯† DNS ä¼ è¾“åè®®â€ï¼š
- **DoH**ï¼šDNS over HTTPS
- **DoQ**ï¼šDNS over QUIC
- **DoH3**ï¼šDNS over HTTP/3ï¼ˆ= QUIC + HTTP è¯­ä¹‰ï¼‰
å®ƒä»¬è§£å†³çš„æ˜¯**åŒä¸€ä»¶äº‹**ï¼š

> ğŸ‘‰ è®© DNS æŸ¥è¯¢ä¸å†æ˜¯æ˜æ–‡ UDP/53ï¼Œè€Œæ˜¯åŠ å¯†ä¼ è¾“ï¼Œé˜²åŠ«æŒã€é˜²æ±¡æŸ“ã€‚

å·®åˆ«åœ¨äºï¼š**åº•å±‚åè®®æ ˆ & æ€§èƒ½ç‰¹æ€§ä¸åŒ**ã€‚

---

## **äºŒã€ä¸‰ä¸ªåè®®åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼ˆæ ¸å¿ƒå·®å¼‚ï¼‰**

### **1ï¸âƒ£ DoHï¼ˆDNS over HTTPSï¼‰**

**å·¥ä½œæ–¹å¼**

```
DNS Query
  â†“
HTTPS (TCP + TLS, port 443)
  â†“
DNS Server
```

**ç‰¹ç‚¹**

| **é¡¹** | **è¯´æ˜**                         |
| ------ | -------------------------------- |
| ä¼ è¾“   | HTTPS / TCP                      |
| ç«¯å£   | 443                              |
| æˆç†Ÿåº¦ | â­â­â­â­â­                       |
| å…¼å®¹æ€§ | æœ€å¥½                             |
| ç¼ºç‚¹   | TCP æ¡æ‰‹ + Head-of-line blocking |

**é€‚åˆåœºæ™¯**

- ç¨³å®šä¼˜å…ˆ
- ç½‘ç»œå¤æ‚ï¼ˆå…¬å¸ / é…’åº— / å…¬å…± Wi-Fiï¼‰
- ä¸æƒ³æŠ˜è…¾

âœ… **æœ€æ¨èä½œä¸ºé»˜è®¤**

---

### **2ï¸âƒ£ DoQï¼ˆDNS over QUICï¼‰**

**å·¥ä½œæ–¹å¼**

```
DNS Query
  â†“
QUIC (UDP + TLS1.3, port 784)
  â†“
DNS Server
```

**ç‰¹ç‚¹**

| **é¡¹** | **è¯´æ˜**                  |
| ------ | ------------------------- |
| ä¼ è¾“   | QUIC                      |
| ç«¯å£   | 784                       |
| ä¼˜ç‚¹   | 0-RTTã€æ—  TCP é˜Ÿå¤´é˜»å¡    |
| ç¼ºç‚¹   | UDP æ˜“è¢« QoS / é˜²ç«å¢™é™åˆ¶ |
| æˆç†Ÿåº¦ | â­â­â­                    |

**é€‚åˆåœºæ™¯**

- å®¶åº­ / ç§»åŠ¨ç½‘ç»œ
- è¿½æ±‚ DNS æè‡´å»¶è¿Ÿ
- ç½‘ç»œç¯å¢ƒâ€œå¹²å‡€â€

âš ï¸ **åœ¨å…¬å¸ç½‘ç»œå¯èƒ½ç›´æ¥ä¸å¯ç”¨**

---

### **3ï¸âƒ£ DoH3ï¼ˆDNS over HTTP/3ï¼‰**

**å·¥ä½œæ–¹å¼**

```
DNS Query
  â†“
HTTP/3 (QUIC + HTTP, port 443)
  â†“
DNS Server
```

**ç‰¹ç‚¹**

| **é¡¹** | **è¯´æ˜**           |
| ------ | ------------------ |
| ä¼ è¾“   | HTTP/3 over QUIC   |
| ç«¯å£   | 443                |
| ä¼˜ç‚¹   | ä½å»¶è¿Ÿ + å…¼å®¹ 443  |
| ç¼ºç‚¹   | æœåŠ¡å™¨æ”¯æŒä»ä¸å®Œå…¨ |
| æˆç†Ÿåº¦ | â­â­â­â­           |

ğŸ“Œ **DoH3 = DoH çš„ QUIC ç‰ˆæœ¬**

---

## **ä¸‰ã€Loon ä¸­è¿™äº›é€‰é¡¹åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ**

ä½ æˆªå›¾é‡Œçš„é€»è¾‘æ˜¯ï¼š

```
DNS ä¼˜å…ˆçº§ï¼š
DoH / DoQ / DoH3
â†“
ï¼ˆå¤±è´¥ï¼‰
â†“
æ™®é€š DNS (UDP 53)
```

å…³é”®ç‚¹ï¼š

- **å¯ä»¥åŒæ—¶é…ç½®å¤šä¸ª**
- Loon ä¼š **å¹¶å‘æŸ¥è¯¢ï¼Œå–æœ€å¿«å“åº”**
- DOH æµé‡æ¨¡å¼å»ºè®® DIRECT

---

## **å››ã€æ¨èé…ç½®æ–¹æ¡ˆï¼ˆç›´æ¥æŠ„ï¼‰**

### **âœ… æ–¹æ¡ˆä¸€ï¼šç¨³å¦¥å‹ï¼ˆå¼ºçƒˆæ¨èï¼‰**

> **DoH + æ™®é€š DNS å…œåº•**

#### **Loon DNS é…ç½®**

```
Add DNS over HTTPS
https://dns.google/dns-query

Add DNS over HTTPS
https://cloudflare-dns.com/dns-query
```

æ™®é€š DNSï¼ˆä¿ç•™ï¼‰ï¼š

```
114.114.114.114
223.5.5.5
```

**ç†ç”±**

- 443 ç«¯å£ï¼ŒæˆåŠŸç‡æœ€é«˜
- Google / Cloudflare SLA ç¨³
- å¤±è´¥å¯å›é€€ UDP

---

### **âš¡ æ–¹æ¡ˆäºŒï¼šæ€§èƒ½ä¼˜å…ˆï¼ˆå®¶ç”¨ / 5Gï¼‰**

> **DoH3 + DoH fallback**

```
Add DNS over HTTP3
https://cloudflare-dns.com/dns-query

Add DNS over HTTPS
https://dns.google/dns-query
```

**è¯´æ˜**

- DoH3 å¤±è´¥ä¼šè‡ªåŠ¨å›é€€ DoH
- å®æµ‹åœ¨ç§»åŠ¨ç½‘ç»œå»¶è¿Ÿæ›´ä½

---

### **ğŸ§ª æ–¹æ¡ˆä¸‰ï¼šæå®¢æµ‹è¯•ï¼ˆä¸æ¨èç”Ÿäº§ï¼‰**

```
Add DNS over QUIC
quic://dns.adguard.com
```

âš ï¸ åªé€‚åˆæµ‹è¯•ï¼Œä¸å»ºè®®å•ç‹¬ä½¿ç”¨

---

## **äº”ã€DOH æµé‡æ¨¡å¼æ€ä¹ˆé€‰ï¼Ÿ**

ä½ æˆªå›¾é‡Œæ˜¯ï¼š

```
DOH æµé‡æ¨¡å¼: DIRECT
```

### **å»ºè®®ä¿æŒ**Â 

### **DIRECT**

| **æ¨¡å¼** | **å«ä¹‰**         |
| -------- | ---------------- |
| DIRECT   | ä¸èµ°ä»£ç†ï¼ˆæ¨èï¼‰ |
| Rule     | å—ä»£ç†è§„åˆ™å½±å“   |

ğŸ“Œ **DNS æœ¬èº«ä¸è¯¥è¢«ä»£ç†è§„åˆ™å¹²æ‰°**

---

## **å…­ã€å·¥ç¨‹åŒ–ç†è§£ï¼ˆç±»æ¯”ä½ ç†Ÿçš„æ¶æ„ï¼‰**

ä½ å¯ä»¥è¿™æ ·ç†è§£ï¼š

| **DNS åè®®** | **ç±»æ¯”**       |
| ------------ | -------------- |
| UDP DNS      | æ˜æ–‡ HTTP      |
| DoH          | HTTPS          |
| DoQ          | gRPC over QUIC |
| DoH3         | HTTP/3 API     |

æœ¬è´¨ï¼š**DNS API çš„ä¼ è¾“å‡çº§**

---

## **ä¸ƒã€æœ€ç»ˆç»“è®ºï¼ˆTL;DRï¼‰**

> **æ€ä¹ˆé…æœ€åˆç†ï¼Ÿ**

âœ… **90% åœºæ™¯æœ€ä½³å®è·µ**

```
Primary: DoH
Backup: æ™®é€š DNS
```

âœ… **æƒ³è¦æ›´å¿«**

```
Primary: DoH3
Fallback: DoH
```

âŒ **ä¸è¦ All-in DoQ**

---

Reference:
https://developers.google.com/speed/public-dns/docs/doh
