è¿™ä¸¤ä¸ªå‘½ä»¤çš„æœ€å¤§åŒºåˆ«åœ¨äº **æ˜¯å¦åŒ…å«ç»“å°¾æ¢è¡Œç¬¦ï¼ˆnewline \nï¼‰**ï¼Œè¿™æ˜¯ echo å‘½ä»¤åœ¨é»˜è®¤è¡Œä¸ºä¸‹çš„å…¸å‹å·®å¼‚ï¼š

---

### **ğŸ” åŒºåˆ«è§£é‡Šï¼š**

| **å‘½ä»¤**         | **å®é™…ä¼ å…¥çš„å†…å®¹** | **æ˜¯å¦åŒ…å«æ¢è¡Œç¬¦** |
| ---------------- | ------------------ | ------------------ |
| echo -n "passwd" | passwd             | âŒ æ— æ¢è¡Œç¬¦        |
| echo "passwd"    | passwd\n           | âœ… æœ‰æ¢è¡Œç¬¦        |

---

### **ğŸ§ª è§£é‡Šç»†èŠ‚**

#### **âœ… å‘½ä»¤ 1ï¼š**

```
echo -n "passwd" | gcloud secret versions add secret-name --data-file=-
```

- -n å‚æ•°è¡¨ç¤º _ä¸è¦è¾“å‡ºæ¢è¡Œç¬¦_ã€‚
- å®é™…ä¸Šä¼ çš„å†…å®¹æ˜¯ **çº¯ç²¹çš„ passwd å­—ç¬¦ä¸²**ï¼Œæ²¡æœ‰é¢å¤–æ¢è¡Œç¬¦ã€‚
- è¿™æ˜¯ **é€šå¸¸æ¨èçš„æ–¹å¼**ï¼Œç”¨äºç¡®ä¿ secret ç²¾ç¡®åŒ¹é…ã€‚

#### **âŒ å‘½ä»¤ 2ï¼š**

```
echo "passwd" | gcloud secret versions add secret-name --data-file=-
```

- é»˜è®¤ echo ä¼šåœ¨æœ«å°¾ **è‡ªåŠ¨åŠ ä¸Šæ¢è¡Œç¬¦ \n**ã€‚
- å®é™…ä¸Šä¼ çš„æ˜¯ passwd\nï¼ˆä¹Ÿå°±æ˜¯ä»¥æ¢è¡Œç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²ï¼‰ã€‚
- å¦‚æœä½ çš„ç¨‹åºï¼ˆæ¯”å¦‚ Java/Springï¼‰è¯»å–è¯¥ secret å¹¶å¯¹æ¯”å¯†ç ï¼Œä¼šå› ä¸ºæœ«å°¾å¤šäº† \n è€ŒåŒ¹é…å¤±è´¥ã€‚

---

### **âœ… æ¨èåšæ³•**

å¦‚æœä½ è¦æŠŠå­—ç¬¦ä¸² secret **ç²¾ç¡®ä¸Šä¼ ï¼ˆä¸å«æ¢è¡Œç¬¦ï¼‰**ï¼Œæ¨èä½¿ç”¨ï¼š

```
echo -n "your-secret" | gcloud secret versions add your-secret-name --data-file=-
```

æˆ–æ›´å®‰å…¨çš„æ–¹å¼ä½¿ç”¨ heredoc ç»“åˆ catï¼š

```
cat <<EOF | gcloud secret versions add your-secret-name --data-file=-
your-secret
EOF
```

---

### **âœ… å°è´´å£«ï¼ˆéªŒè¯ä¸Šä¼ å†…å®¹ï¼‰**

ä½ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼éªŒè¯ secret å†…å®¹æ˜¯å¦å«æœ‰æ¢è¡Œï¼š

```
gcloud secrets versions access latest --secret=secret-name | od -c
```

ç¤ºä¾‹è¾“å‡ºï¼š

```
0000000   p   a   s   s   w   d  \n
```

è¡¨ç¤ºæœ‰ \nã€‚å¦‚æœæ²¡æœ‰ \nï¼š

```
0000000   p   a   s   s   w   d
```

---

### **âœ… Mermaid ç®€å›¾**

```mermaid
graph TD;
    A[echo passwd] --> B[åŒ…å«æ¢è¡Œç¬¦ \n];
    A2[echo -n passwd] --> B2[ä¸åŒ…å«æ¢è¡Œç¬¦];

    B --> C[ä¸Šä¼ åˆ° GCP Secret å«æœ‰æ¢è¡Œ];
    B2 --> C2[ä¸Šä¼ åˆ° GCP Secret æ˜¯çº¯æ–‡æœ¬];

    C --> D[ç¨‹åºè¯»å– secret å¯èƒ½å¤šä¸€è¡Œ];
    C2 --> D2[ç¨‹åºè¯»å–æ— é¢å¤–å­—ç¬¦ â†’ æ¨è];
```

---

å¦‚ä½ æ‰€å‘ç°çš„ï¼Œâ€œ**çœ‹ä¼¼ç›¸åŒçš„å­—ç¬¦ä¸²**â€ï¼Œåªå› ä¸€ä¸ªæ¢è¡Œï¼Œå°±å¯èƒ½è®©è®¤è¯å¤±è´¥ã€‚ğŸ‘€

éœ€è¦æˆ‘å¸®ä½ å†™ä¸€æ®µéªŒè¯æ˜¯å¦ secret ä¸­å¸¦æ¢è¡Œçš„è„šæœ¬ä¹Ÿå¯ä»¥ç»§ç»­è¯´ã€‚

å¥½çš„ï¼Œä»¥ä¸‹æ˜¯ä¸€æ®µå¯å¤ç”¨çš„ **Shell è„šæœ¬**ï¼Œç”¨äºéªŒè¯ GCP Secret Manager ä¸­æŸä¸ª secret çš„å€¼æ˜¯å¦ **åŒ…å«æœ«å°¾æ¢è¡Œç¬¦ \n**ï¼Œå¹¶æ¸…æ¥šæ ‡ç¤ºç»“æœã€‚

---

### **âœ… è„šæœ¬ï¼šæ£€æŸ¥ GCP Secret æ˜¯å¦åŒ…å«æ¢è¡Œç¬¦**

```
#!/bin/bash

SECRET_NAME="$1"

if [ -z "$SECRET_NAME" ]; then
  echo "â— è¯·è¾“å…¥ secret åç§°ä½œä¸ºå‚æ•°"
  echo "ç”¨æ³•: ./check_secret_newline.sh your-secret-name"
  exit 1
fi

# è·å– secret å†…å®¹ï¼ˆlatest ç‰ˆæœ¬ï¼‰
SECRET_VALUE=$(gcloud secrets versions access latest --secret="$SECRET_NAME")

# ç”¨ od æ˜¾ç¤ºå­—ç¬¦ç»“æ„
echo "ğŸ” Secret å†…å®¹å­—èŠ‚è§†å›¾:"
echo "$SECRET_VALUE" | od -c

# åˆ¤æ–­æ˜¯å¦æœ‰æ¢è¡Œç¬¦ç»“å°¾
if echo "$SECRET_VALUE" | tail -c1 | grep -q $'\n'; then
  echo "âš ï¸ è¯¥ Secret ç»“å°¾åŒ…å«æ¢è¡Œç¬¦ '\\n'"
else
  echo "âœ… è¯¥ Secret æ²¡æœ‰ç»“å°¾æ¢è¡Œç¬¦"
fi
```

---

### **âœ… ä½¿ç”¨æ–¹æ³•**

```
chmod +x check_secret_newline.sh
./check_secret_newline.sh your-secret-name
```

---

### **âœ… ç¤ºä¾‹è¾“å‡º**

è‹¥å«æ¢è¡Œï¼š

```
ğŸ” Secret å†…å®¹å­—èŠ‚è§†å›¾:
0000000   p   a   s   s   w   d  \n
âš ï¸ è¯¥ Secret ç»“å°¾åŒ…å«æ¢è¡Œç¬¦ '\n'
```

è‹¥æ— æ¢è¡Œï¼š

```
ğŸ” Secret å†…å®¹å­—èŠ‚è§†å›¾:
0000000   p   a   s   s   w   d
âœ… è¯¥ Secret æ²¡æœ‰ç»“å°¾æ¢è¡Œç¬¦
```

---

### **âœ… å»ºè®®ï¼ˆä¿®å¤å«æ¢è¡Œçš„ secretï¼‰**

å¦‚æœä½ å‘ç° secret æœ‰æ¢è¡Œï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤é‡æ–°ä¸Šä¼ ä¸å¸¦ \n çš„å†…å®¹ï¼š

```
echo -n "your-secret" | gcloud secret versions add your-secret-name --data-file=-
```

---

éœ€è¦æˆ‘å¸®ä½ å†è¡¥å……æˆä¸€ä¸ªè‡ªåŠ¨æ›¿æ¢å« \n çš„ç‰ˆæœ¬ä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ã€‚
