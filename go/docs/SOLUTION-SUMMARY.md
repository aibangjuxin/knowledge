# Golang åº”ç”¨é€‚é…å¹³å° ConfigMap - è§£å†³æ–¹æ¡ˆæ€»ç»“

## ğŸ“‹ é—®é¢˜æè¿°

å¹³å°ç›®å‰é€šè¿‡ ConfigMap ä¸º Java SpringBoot åº”ç”¨ç»Ÿä¸€æ³¨å…¥é…ç½®ï¼š
- å¼ºåˆ¶ HTTPSï¼ˆç«¯å£ 8443ï¼‰
- ç»Ÿä¸€ Context Pathï¼š`/${apiName}/v${minorVersion}`
- ç»Ÿä¸€è¯ä¹¦ç®¡ç†ï¼ˆPKCS12 æ ¼å¼ï¼‰

**æŒ‘æˆ˜**ï¼šå¦‚ä½•è®© Golang åº”ç”¨ä¹Ÿèƒ½ä½¿ç”¨ç›¸åŒçš„é…ç½®æœºåˆ¶ï¼Ÿ

## âœ… è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯

**ä¸ Java åº”ç”¨ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ ConfigMap**ï¼ŒGolang åº”ç”¨é€šè¿‡é…ç½®åŠ è½½å™¨è¯»å–å¹¶é€‚é…ã€‚

### å…³é”®ç»„ä»¶

1. **é…ç½®åŠ è½½å™¨**ï¼ˆ`platform-config-loader.go`ï¼‰
   - è¯»å– Java properties æ ¼å¼é…ç½®æ–‡ä»¶
   - è§£æç¯å¢ƒå˜é‡å ä½ç¬¦ï¼ˆ`${apiName}`ï¼‰
   - æä¾›é…ç½®éªŒè¯
   - å¤„ç†è¯ä¹¦è·¯å¾„

2. **åº”ç”¨é€‚é…**ï¼ˆ`main.go`ï¼‰
   - ä½¿ç”¨è·¯ç”± Group å®ç° Context Path
   - æ”¯æŒ HTTP/HTTPS åŠ¨æ€åˆ‡æ¢
   - å®ç°å¥åº·æ£€æŸ¥ç«¯ç‚¹

3. **è¯ä¹¦å¤„ç†**
   - æ–¹æ¡ˆ Aï¼šå¹³å°æä¾› PEM æ ¼å¼ï¼ˆæ¨èï¼‰
   - æ–¹æ¡ˆ Bï¼šInitContainer è‡ªåŠ¨è½¬æ¢ PKCS12

## ğŸ¯ å®ç°æ•ˆæœ

### é…ç½®ç»Ÿä¸€æ€§

| é…ç½®é¡¹ | Java | Golang | çŠ¶æ€ |
|--------|------|--------|------|
| ConfigMap | âœ… | âœ… | å®Œå…¨ç›¸åŒ |
| ç«¯å£ 8443 | âœ… | âœ… | è‡ªåŠ¨è¯»å– |
| Context Path | âœ… | âœ… | è‡ªåŠ¨åº”ç”¨ |
| HTTPS | âœ… | âœ… | è‡ªåŠ¨å¯ç”¨ |
| ç¯å¢ƒå˜é‡æ›¿æ¢ | âœ… | âœ… | è‡ªåŠ¨å¤„ç† |

### éƒ¨ç½²ä¸€è‡´æ€§

```yaml
# ConfigMapï¼ˆJava å’Œ Golang å®Œå…¨ç›¸åŒï¼‰
apiVersion: v1
kind: ConfigMap
metadata:
  name: mycoat-common-sprint-conf
data:
  server-conf.properties: |
    server.port=8443
    server.ssl.enabled=true
    server.servlet.context-path=/${apiName}/v${minorVersion}
```

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ Aï¼šå¹³å°æä¾› PEM è¯ä¹¦ï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… éƒ¨ç½²ç®€å•ï¼Œæ— éœ€é¢å¤–æ­¥éª¤
- âœ… å¯åŠ¨é€Ÿåº¦å¿«
- âœ… é…ç½®æ¸…æ™°

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦å¹³å°æ”¹é€ ï¼ˆSecret ä¸­æ·»åŠ  PEM æ ¼å¼ï¼‰

**é€‚ç”¨åœºæ™¯**ï¼šé•¿æœŸæ–¹æ¡ˆï¼Œå¹³å°ç»Ÿä¸€ç®¡ç†

### æ–¹æ¡ˆ Bï¼šInitContainer è½¬æ¢

**ä¼˜ç‚¹**ï¼š
- âœ… æ— éœ€å¹³å°æ”¹é€ 
- âœ… ä¸ Java å…±äº« PKCS12 è¯ä¹¦
- âœ… ç«‹å³å¯ç”¨

**ç¼ºç‚¹**ï¼š
- âš ï¸ Pod å¯åŠ¨ç¨æ…¢ï¼ˆå¢åŠ  2-3 ç§’ï¼‰
- âš ï¸ éœ€è¦é¢å¤–çš„ InitContainer

**é€‚ç”¨åœºæ™¯**ï¼šçŸ­æœŸæ–¹æ¡ˆï¼Œå¿«é€Ÿä¸Šçº¿

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### é…ç½®è¯»å–æµç¨‹

```
1. åº”ç”¨å¯åŠ¨
   â†“
2. è¯»å– /opt/config/server-conf.properties
   â†“
3. è§£æ properties æ ¼å¼
   â†“
4. æ›¿æ¢ç¯å¢ƒå˜é‡å ä½ç¬¦ï¼ˆ${apiName}ã€${minorVersion}ï¼‰
   â†“
5. éªŒè¯é…ç½®å®Œæ•´æ€§
   â†“
6. åº”ç”¨é…ç½®ï¼ˆç«¯å£ã€Context Pathã€TLSï¼‰
   â†“
7. å¯åŠ¨æœåŠ¡
```

### Context Path å®ç°

```go
// Java SpringBootï¼ˆè‡ªåŠ¨ï¼‰
// server.servlet.context-path=/user-service/v1
// æ‰€æœ‰è·¯ç”±è‡ªåŠ¨å¸¦ä¸Šå‰ç¼€

// Golangï¼ˆæ‰‹åŠ¨æŒ‚è½½ï¼‰
api := r.Group(cfg.ContextPath)  // cfg.ContextPath = "/user-service/v1"
{
    api.GET("/health", handler)  // å®é™…è·¯å¾„ï¼š/user-service/v1/health
    api.GET("/hello", handler)   // å®é™…è·¯å¾„ï¼š/user-service/v1/hello
}
```

### è¯ä¹¦è½¬æ¢ï¼ˆæ–¹æ¡ˆ Bï¼‰

```bash
# InitContainer æ‰§è¡Œ
openssl pkcs12 -in mycoat-sbrt.p12 \
  -passin env:KEY_STORE_PWD \
  -out tls.crt -clcerts -nokeys

openssl pkcs12 -in mycoat-sbrt.p12 \
  -passin env:KEY_STORE_PWD \
  -out tls.key -nocerts -nodes
```

## ğŸ“ˆ æ€§èƒ½å½±å“

### å¯åŠ¨æ—¶é—´

| æ–¹æ¡ˆ | é…ç½®åŠ è½½ | è¯ä¹¦è½¬æ¢ | åº”ç”¨å¯åŠ¨ | æ€»è®¡ |
|------|----------|----------|----------|------|
| æ–¹æ¡ˆ Aï¼ˆPEMï¼‰ | <10ms | 0 | ~1s | ~1s |
| æ–¹æ¡ˆ Bï¼ˆInitContainerï¼‰ | <10ms | 2-3s | ~1s | ~3-4s |
| Java SpringBoot | ~5s | 0 | ~25s | ~30s |

### èµ„æºæ¶ˆè€—

| æŒ‡æ ‡ | Java | Golang | èŠ‚çœ |
|------|------|--------|------|
| å†…å­˜ | 256MB | 32MB | 87.5% |
| CPU | 0.1 core | 0.01 core | 90% |
| é•œåƒ | 200MB | 20MB | 90% |

## ğŸ“ åº”ç”¨å¼€å‘è€…éœ€è¦åšä»€ä¹ˆ

### æœ€å°åŒ–æ”¹åŠ¨ï¼ˆ3 æ­¥ï¼‰

1. **å¤åˆ¶é…ç½®åŠ è½½å™¨**
   ```bash
   cp platform-config-loader.go your-project/pkg/config/
   ```

2. **ä¿®æ”¹ main.go**
   ```go
   cfg, _ := config.LoadPlatformConfig()
   api := r.Group(cfg.ContextPath)  // å…³é”®ï¼šä½¿ç”¨ Group
   ```

3. **éƒ¨ç½²**
   ```bash
   kubectl apply -f deployment.yaml
   ```

### æ— éœ€æ”¹åŠ¨

- âŒ ä¸éœ€è¦ä¿®æ”¹ ConfigMap
- âŒ ä¸éœ€è¦ä¿®æ”¹ç¯å¢ƒå˜é‡å®šä¹‰
- âŒ ä¸éœ€è¦ä¿®æ”¹ Secret
- âŒ ä¸éœ€è¦ä¿®æ”¹ç½‘å…³é…ç½®

## ğŸ¢ å¹³å°éœ€è¦åšä»€ä¹ˆ

### çŸ­æœŸï¼ˆç«‹å³å¯ç”¨ï¼‰

1. **æä¾›æ–‡æ¡£å’Œç¤ºä¾‹**
   - âœ… å·²å®Œæˆï¼ˆæœ¬æ–‡æ¡£ï¼‰

2. **æä¾› InitContainer æ¨¡æ¿**
   - âœ… å·²å®Œæˆï¼ˆ`deployment-with-initcontainer.yaml`ï¼‰

3. **æ— éœ€å…¶ä»–æ”¹åŠ¨**
   - ConfigMap ä¿æŒä¸å˜
   - Secret ä¿æŒä¸å˜

### é•¿æœŸï¼ˆæ¨èï¼‰

1. **è¯ä¹¦æ ¼å¼æ”¯æŒ**
   - åœ¨ Secret ä¸­åŒæ—¶æä¾› PKCS12 å’Œ PEM
   - æˆ–æä¾›ç»Ÿä¸€çš„è¯ä¹¦è½¬æ¢æœåŠ¡

2. **é…ç½® SDK**
   - å°è£…ä¸º `mycoat-config-go` åº“
   - æ”¯æŒå¤šè¯­è¨€ï¼ˆNode.jsã€Pythonï¼‰

3. **å·¥å…·é“¾é›†æˆ**
   - é…ç½®éªŒè¯å·¥å…·
   - CI/CD é›†æˆ
   - è‡ªåŠ¨åŒ–æµ‹è¯•

## ğŸ“¦ äº¤ä»˜ç‰©æ¸…å•

### æ–‡æ¡£ï¼ˆ6 ä¸ªï¼‰

- âœ… `QUICK-START.md` - 5 åˆ†é’Ÿå¿«é€Ÿå¼€å§‹
- âœ… `INTEGRATION-GUIDE.md` - è¯¦ç»†é›†æˆæŒ‡å—
- âœ… `platform-configmap-adapter.md` - å®Œæ•´æŠ€æœ¯æ–¹æ¡ˆ
- âœ… `JAVA-GOLANG-COMPARISON.md` - Java å¯¹æ¯”
- âœ… `INDEX.md` - æ–‡æ¡£ç´¢å¼•
- âœ… `README.md` - é¡¹ç›®è¯´æ˜

### ä»£ç ï¼ˆ4 ä¸ªï¼‰

- âœ… `platform-config-loader.go` - é…ç½®åŠ è½½å™¨
- âœ… `platform-config-loader_test.go` - å•å…ƒæµ‹è¯•
- âœ… `main.go` - åº”ç”¨ç¤ºä¾‹
- âœ… `go.mod` - ä¾èµ–ç®¡ç†

### é…ç½®ï¼ˆ3 ä¸ªï¼‰

- âœ… `deployment.yaml` - æ ‡å‡†éƒ¨ç½²
- âœ… `deployment-with-initcontainer.yaml` - InitContainer éƒ¨ç½²
- âœ… `Dockerfile` - å®¹å™¨æ„å»º

### å·¥å…·ï¼ˆ2 ä¸ªï¼‰

- âœ… `convert-cert.sh` - è¯ä¹¦è½¬æ¢
- âœ… `test-local.sh` - æœ¬åœ°æµ‹è¯•

**æ€»è®¡**ï¼š15 ä¸ªæ–‡ä»¶ï¼Œè¦†ç›–æ‰€æœ‰åœºæ™¯

## âœ¨ æ ¸å¿ƒä¼˜åŠ¿

### 1. é…ç½®ç»Ÿä¸€
- Java å’Œ Golang ä½¿ç”¨ç›¸åŒçš„ ConfigMap
- å¹³å°æ— éœ€ç»´æŠ¤ä¸¤å¥—é…ç½®
- é…ç½®å˜æ›´å¯¹æ‰€æœ‰è¯­è¨€ç”Ÿæ•ˆ

### 2. æœ€å°æ”¹åŠ¨
- åº”ç”¨å¼€å‘è€…ï¼š3 æ­¥é›†æˆ
- å¹³å°å·¥ç¨‹å¸ˆï¼šæ— éœ€æ”¹åŠ¨ï¼ˆçŸ­æœŸï¼‰
- éƒ¨ç½²æµç¨‹ï¼šä¿æŒä¸€è‡´

### 3. çµæ´»éƒ¨ç½²
- æ”¯æŒä¸¤ç§è¯ä¹¦æ–¹æ¡ˆ
- æ”¯æŒæœ¬åœ°æµ‹è¯•
- æ”¯æŒæ¸è¿›å¼è¿ç§»

### 4. å®Œæ•´æ–‡æ¡£
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- è¯¦ç»†é›†æˆæ­¥éª¤
- æ•…éšœæ’æŸ¥æ‰‹å†Œ
- å¯¹æ¯”åˆ†ææ–‡æ¡£

## ğŸš€ æ¨å¹¿è®¡åˆ’

### é˜¶æ®µ 1ï¼šè¯•ç‚¹ï¼ˆ1-2 å‘¨ï¼‰

1. é€‰æ‹© 1-2 ä¸ª Golang åº”ç”¨è¯•ç‚¹
2. ä½¿ç”¨ InitContainer æ–¹æ¡ˆå¿«é€Ÿä¸Šçº¿
3. æ”¶é›†åé¦ˆï¼Œä¼˜åŒ–æ–‡æ¡£

### é˜¶æ®µ 2ï¼šæ¨å¹¿ï¼ˆ1 ä¸ªæœˆï¼‰

1. å¹³å°æä¾› PEM è¯ä¹¦æ”¯æŒ
2. æ¨å¹¿åˆ°æ‰€æœ‰ Golang åº”ç”¨
3. æä¾›æŠ€æœ¯æ”¯æŒ

### é˜¶æ®µ 3ï¼šæ‰©å±•ï¼ˆæŒç»­ï¼‰

1. æ‰©å±•åˆ° Node.jsã€Python ç­‰
2. å¼€å‘ç»Ÿä¸€é…ç½® SDK
3. é›†æˆåˆ° CI/CD

## ğŸ“ æ”¯æŒæ¸ é“

- **æŠ€æœ¯é—®é¢˜**ï¼šå¹³å°å·¥ç¨‹å›¢é˜Ÿ
- **æ–‡æ¡£åé¦ˆ**ï¼šæäº¤ Issue
- **ç´§æ€¥æ”¯æŒ**ï¼šå›¢é˜Ÿ Wiki

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬æ–¹æ¡ˆï¼ŒGolang åº”ç”¨å¯ä»¥ï¼š
- âœ… ä½¿ç”¨ä¸ Java ç›¸åŒçš„ ConfigMap
- âœ… æœ€å°åŒ–ä»£ç æ”¹åŠ¨ï¼ˆ3 æ­¥ï¼‰
- âœ… ä¿æŒéƒ¨ç½²ä¸€è‡´æ€§
- âœ… è·å¾—å®Œæ•´çš„æ–‡æ¡£å’Œå·¥å…·æ”¯æŒ

**å¹³å°å®ç°äº†å¤šè¯­è¨€ç»Ÿä¸€é…ç½®ç®¡ç†ï¼Œä¸ºæœªæ¥æ‰©å±•å¥ å®šåŸºç¡€ã€‚**

---

**æ–¹æ¡ˆç‰ˆæœ¬**ï¼šv1.0  
**å‘å¸ƒæ—¥æœŸ**ï¼š2025-11-30  
**ç»´æŠ¤å›¢é˜Ÿ**ï¼šå¹³å°å·¥ç¨‹å›¢é˜Ÿ  
**çŠ¶æ€**ï¼šâœ… ç”Ÿäº§å°±ç»ª
