# 通过远程分支完全覆盖本地文件

要通过 Git 让远程 `main` 分支完全覆盖本地所有文件（包括文件内容和修改时间），核心思路是**放弃本地所有未提交的修改 + 拉取远程最新版本并强制覆盖本地**。以下是分步操作，确保安全且彻底：

## 前提准备

1. 打开终端/命令行，进入你的本地仓库目录（`cd 你的仓库路径`）；
2. 先确认当前分支是 `main`（避免操作错分支）：

```bash
git branch
```

如果不是 `main`，先切换：`git checkout main`。

## 步骤 1：放弃本地所有未提交的修改（关键）

如果本地有未提交的修改、新增文件，先彻底清理（**此操作不可逆，确保本地无需要保留的内容**）：

```bash
# 1. 放弃已追踪文件的修改（即 Git 已记录的文件）
git reset --hard

# 2. 删除本地新增的未追踪文件/文件夹（如编译产物、临时文件等）
git clean -fd
```

- `git reset --hard`：重置工作区和暂存区到最近一次提交，放弃所有本地修改；
- `git clean -fd`：`f`=强制删除文件，`d`=删除空文件夹和未追踪的文件夹，确保本地无多余文件。

## 步骤 2：拉取远程 main 分支并强制覆盖本地

先确保本地关联了远程仓库（通常远程名是 `origin`），然后拉取远程最新的 `main` 分支并强制覆盖本地：

```bash
# 1. 拉取远程最新的 main 分支信息（更新本地缓存）
git fetch origin main

# 2. 强制将本地 main 分支指向远程 main 的最新提交，并覆盖工作区
git reset --hard origin/main
```

- `git fetch`：仅拉取远程分支的最新提交记录，不合并，确保获取到最新的远程版本；
- `git reset --hard origin/main`：将本地 `main` 分支的 HEAD 强制重置到远程 `origin/main` 的最新提交，同时覆盖本地所有文件到远程版本。

## 步骤 3：验证结果

执行完后，可通过以下命令确认本地与远程一致：

```bash
# 查看本地分支与远程分支的差异（无输出则完全一致）
git diff main origin/main

# 查看当前分支的最新提交（应与远程 main 一致）
git log -1
```

## 关于「文件修改时间」的补充说明

Git **本身不追踪文件的修改时间**，文件的修改时间是本地文件系统的属性。执行上述操作后：

- 对于本地已存在的文件：Git 会用远程文件的内容覆盖，但**修改时间可能仍保留本地时间**（取决于操作系统和 Git 版本）；
- 对于本地被删除后重新拉取的文件：修改时间会是「拉取时的本地时间」。

如果需要让文件的修改时间与远程提交的时间一致，需额外处理（以 Linux/macOS 为例）：

```bash
# 安装 git-touch（需先安装 npm）
npm install -g git-touch

# 同步文件修改时间为对应提交的时间
git touch
```

Windows 可借助第三方工具（如 `SetFileTime`）或手动调整，核心逻辑是读取 Git 提交时间，批量修改文件的本地修改时间。

## 注意事项

1. **不可逆操作**：`git reset --hard` 和 `git clean -fd` 会彻底删除本地未提交的修改和新增文件，执行前务必确认无重要内容；
2. 若远程仓库名不是 `origin`（比如自定义了远程名），需将命令中的 `origin` 替换为实际远程名（可通过 `git remote -v` 查看）；
3. 如果本地有未推送的提交，执行后这些提交会被覆盖，若需要保留，可先创建临时分支备份：`git checkout -b backup-main`。