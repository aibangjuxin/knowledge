# å¤„ç†"å¤§æ”¹åŠ¨ + main å·²å‰è¿› + æœ‰ violation"åœºæ™¯çš„å®æˆ˜æ–¹æ¡ˆ

ä»¥ä¸‹æ˜¯åœ¨"å¤§æ”¹åŠ¨ + main å·²å‰è¿› + æœ‰ violation"åœºæ™¯ä¸‹ï¼Œ**æœ€å¿«ã€æœ€ç¨³ã€ä¸æ±¡æŸ“å†å²**çš„å®æˆ˜æ–¹æ¡ˆã€‚æˆ‘ä¼šæŒ‰**æ¨èä¼˜å…ˆçº§**è¿›è¡Œæ‹†è§£ï¼Œå¹¶è¯´æ˜**ä»€ä¹ˆæ—¶å€™è¯¥ç”¨å“ªä¸€ç§**ã€‚

## **1ï¸âƒ£ é—®é¢˜åˆ†æï¼ˆæ ¸å¿ƒçŸ›ç›¾ï¼‰**

ä½ çš„å½“å‰çŠ¶æ€å¯ä»¥æŠ½è±¡æˆï¼š

```
A --- B --- C (origin/main)   â† main å·²è¢«åŒäº‹ä¿®å¤ violation
      \
       D --- E --- F (your-branch)  â† ä½ åŸºäºæ—§ main åšäº†å¤§é‡æ”¹åŠ¨
```

**å†²çªç‚¹åœ¨äºï¼š**

- ä½ çš„åˆ†æ”¯æ˜¯åŸºäºã€Œæœ‰ violation çš„æ—§ mainã€
- main å·²ç» forwardï¼Œå¹¶ä¿®äº† violation
- ä½ ç›´æ¥ merge / push ä¼šï¼š
  - CI violation
  - å†²çªéå¸¸å¤š
  - review æå…¶ç—›è‹¦

**ç›®æ ‡ï¼š**
- å°½å¿«åˆå¹¶åˆ° main
- ä¿è¯ CI clean
- ä¸è¿”å·¥ã€ä¸é‡å†™å¤§é‡ä»£ç 

---

## **2ï¸âƒ£ æ¨èæ–¹æ¡ˆä¸€ï¼ˆâœ… æœ€å¿« + æœ€å¹²å‡€ï¼‰ï¼šrebase åˆ°æœ€æ–° main**

> **é€‚ç”¨åœºæ™¯ï¼š**
> - æ”¹åŠ¨å¾ˆå¤š
> - ä½ æ˜¯ feature åˆ†æ”¯å”¯ä¸€å¼€å‘è€…
> - å¸Œæœ› PR å¹²å‡€ã€review å‹å¥½

### **âœ… æ ¸å¿ƒæ€æƒ³**
æŠŠä½ çš„æ‰€æœ‰æäº¤ **"æ¬åˆ°" æœ€æ–° main ä¹‹ä¸Š**ï¼Œè®©å®ƒçœ‹èµ·æ¥åƒæ˜¯ã€ŒåŸºäºä¿®å¤åçš„ main å¼€å‘çš„ã€ã€‚

### **ğŸ›  æ“ä½œæ­¥éª¤ï¼ˆæ ‡å‡†åšæ³•ï¼‰**
```bash
# 1. ç¡®ä¿ main æ˜¯æœ€æ–°çš„
git fetch origin
git checkout main
git pull origin main

# 2. å›åˆ°ä½ çš„åˆ†æ”¯
git checkout your-branch

# 3. åˆ›å»ºå¤‡ä»½åˆ†æ”¯ï¼ˆå®‰å…¨èµ·è§ï¼‰
git branch backup-your-branch

# 4. rebase åˆ°æœ€æ–° main
git rebase origin/main
```

### **ğŸ§© å¤„ç†å†²çªï¼ˆå…³é”®ç‚¹ï¼‰**
- å†²çªæ–‡ä»¶å¤§æ¦‚ç‡æ˜¯ï¼š
  - violation ç›¸å…³æ–‡ä»¶
  - config / lint / formatting æ–‡ä»¶

- åŸåˆ™ï¼š
  - **ä¼˜å…ˆä¿ç•™ main ä¸­ä¿® violation çš„æ”¹åŠ¨**
  - å†æŠŠä½ è‡ªå·±çš„é€»è¾‘è¡¥å›å»

```bash
# è§£å†³å®Œä¸€ä¸ªå†²çªæ–‡ä»¶
git add <file>

# ç»§ç»­ rebase
git rebase --continue

# å¦‚æœä¸­é€”æƒ³æ”¾å¼ƒ rebase
git rebase --abort
```

### **ğŸ”§ è¿›é˜¶æŠ€å·§ï¼ˆå¯é€‰ï¼‰**
å¦‚æœéœ€è¦æ•´ç†æäº¤è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨äº¤äº’å¼ rebaseï¼š
```bash
git rebase -i origin/main
```
è¿™å…è®¸ä½  squashã€edit æˆ– reword æäº¤ã€‚

å¦‚æœæœ‰æ ‡è®°äº† `fixup!` æˆ– `squash!` çš„æäº¤ï¼Œå¯ä»¥ä½¿ç”¨ï¼š
```bash
git rebase --autosquash origin/main
```

### **âœ… rebase å®Œæˆå**
```bash
# å¦‚æœåˆ†æ”¯å·²ç»æ¨è¿‡è¿œç«¯
git push --force-with-lease
```

> âš ï¸ **ç”¨ --force-with-leaseï¼Œä¸è¦ç”¨è£¸ --force**

### **âœ… æ•ˆæœ**
- CI violation è‡ªåŠ¨æ¶ˆå¤±ï¼ˆå› ä¸º base å·²æ˜¯ clean mainï¼‰
- PR diff å¹²å‡€
- å®¡æ ¸åªçœ‹ä½ çš„æ”¹åŠ¨

---

## **3ï¸âƒ£ æ¨èæ–¹æ¡ˆäºŒï¼ˆâš¡ æ›´å¿«ä½† diff å¾ˆä¹±ï¼‰ï¼šmerge main åˆ°ä½ çš„åˆ†æ”¯**

> **é€‚ç”¨åœºæ™¯ï¼š**
> - éå¸¸ç€æ€¥
> - ä¸æƒ³é‡å†™å†å²
> - å¯ä»¥æ¥å— PR diff æ‚ä¹±

### **æ“ä½œ**
```bash
git fetch origin
git checkout your-branch
git merge origin/main
```

è§£å†³å†²çª â†’ commit â†’ push

### **âš ï¸ ç¼ºç‚¹**
- PR ä¼šåŒ…å«ï¼š
  - main çš„å¤§é‡å†å²æäº¤
- reviewer å¾ˆéš¾çœ‹
- åªé€‚åˆã€Œæ•‘ç«ã€

---

## **4ï¸âƒ£ æ¨èæ–¹æ¡ˆä¸‰ï¼ˆğŸ§¨ ç»ˆæå…œåº•ï¼‰ï¼šcherry-pick + é‡å»ºåˆ†æ”¯**

> **é€‚ç”¨åœºæ™¯ï¼š**
> - åˆ†æ”¯å·²ç»ä¹±åˆ°ä¸å¯æ•‘
> - violation æ–‡ä»¶å’Œä½ æ”¹åŠ¨é«˜åº¦è€¦åˆ
> - æƒ³è¦ 100% å¹²å‡€å†å²

### **æ€è·¯**
```
æœ€æ–° main
   |
   +-- new-branch
        |
        + cherry-pick ä½ çœŸæ­£æœ‰ä»·å€¼çš„æäº¤
```

### **æ“ä½œç¤ºä¾‹**
```bash
# 1. åˆ›å»ºå¤‡ä»½
git branch backup-your-branch

# 2. åˆ‡æ¢åˆ°æœ€æ–° main
git checkout main
git pull origin main

# 3. åˆ›å»ºæ–°åˆ†æ”¯
git checkout -b your-branch-v2

# 4. æŸ¥çœ‹ä½ åŸåˆ†æ”¯çš„æäº¤
git log your-branch --oneline

# 5. ä» oldest åˆ° newest ä¾æ¬¡ cherry-pick
git cherry-pick <commit-id-1>
git cherry-pick <commit-id-2>
# ... ä¾æ­¤ç±»æ¨
```

---

## **5ï¸âƒ£ å¿«é€Ÿå†³ç­–è¡¨ï¼ˆä½ ç°åœ¨ç”¨å“ªä¸ªï¼Ÿï¼‰**

| **åœºæ™¯** | **æ¨èæ–¹æ¡ˆ** |
|----------|--------------|
| æ”¹åŠ¨å¤š + æƒ³ä¸€æ¬¡åˆå¹¶æˆåŠŸ | âœ… rebase |
| ç´§æ€¥ä¸Šçº¿ | merge |
| åˆ†æ”¯å·²æ±¡æŸ“ | cherry-pick |

---

## **6ï¸âƒ£ å®æˆ˜ç»éªŒï¼ˆéå¸¸é‡è¦ï¼‰**

### **ğŸ”¥ violation ç›¸å…³æ–‡ä»¶å»ºè®®ï¼š**
- formatter / lint / license / header
- CI yaml / build config

ğŸ‘‰ **å…¨éƒ¨ä»¥ main ä¸ºå‡†**ï¼Œä¸è¦çº ç»“

### **ğŸ”’ é˜²æ­¢ä¸‹æ¬¡å†å‘ç”Ÿ**
```bash
# æ¯å¤©å¼€å§‹å·¥ä½œå‰
git checkout main
git pull
git checkout your-branch
git rebase main
```

æˆ–ç›´æ¥è®¾ç½®ï¼š
```bash
git config --global pull.rebase true
```

### **ğŸ›¡ï¸ å®‰å…¨å®è·µ**
- åœ¨æ‰§è¡Œä»»ä½•ç ´åæ€§æ“ä½œï¼ˆå¦‚ rebaseã€resetï¼‰ä¹‹å‰ï¼Œåˆ›å»ºå¤‡ä»½åˆ†æ”¯
- ä½¿ç”¨ `--force-with-lease` è€Œä¸æ˜¯ `--force` æ¨é€
- ç¡®ä¿å›¢é˜Ÿäº†è§£ä½ æ­£åœ¨å¼ºåˆ¶æ¨é€çš„åˆ†æ”¯

---

## **7ï¸âƒ£ ä¸€å¥è¯æ€»ç»“**

> **ä½ ç°åœ¨æœ€å¿«ã€æœ€ç¨³çš„åšæ³•ï¼š**
> ğŸ‘‰ **rebase ä½ çš„åˆ†æ”¯åˆ°æœ€æ–° mainï¼Œä¸Šæ¸¸ violation è‡ªåŠ¨æ¶ˆå¤±ï¼Œå† force-with-lease æ¨é€**

å¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥æŠŠ **violation ç±»å‹ï¼ˆlint / license / security / formattingï¼‰** æˆ– **Git å¹³å°ï¼ˆGitHub / GitLab / Gerritï¼‰** å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥ç»™ä½ ä¸€å¥—**æ›´ç²¾å‡†çš„å†²çªè§£å†³é¡ºåº**ã€‚