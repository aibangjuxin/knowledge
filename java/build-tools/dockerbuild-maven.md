åœ¨æ‚¨æè¿°çš„æƒ…å¢ƒä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸åŒçš„æ„å»ºè¿‡ç¨‹ï¼šMaven Build å’Œ Docker Image Buildï¼Œå®ƒä»¬ä¹‹é—´æœ‰æ˜ç¡®çš„ç›®çš„å’Œå®ç°åŒºåˆ«ã€‚ä»¥ä¸‹æ˜¯å¯¹ä¸¤è€…çš„è¯¦ç»†è¯´æ˜ï¼š

#  Maven Build

Maven æ˜¯ä¸€ä¸ªä¸“æ³¨äº Java é¡¹ç›®ç®¡ç†å’Œæ„å»ºçš„å·¥å…·ï¼Œç”¨äºç¼–è¯‘ã€æ‰“åŒ…å’Œç®¡ç† Java ä¾èµ–ã€‚

Maven Build çš„ä¸»è¦ä»»åŠ¡

	â€¢	ä¾èµ–ç®¡ç†ï¼šMaven ä½¿ç”¨ pom.xml æ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®æ‰€éœ€çš„ä¾èµ–é¡¹ï¼Œå¹¶ä¼šä»ä¸­å¤®ä»“åº“ï¼ˆå¦‚ Maven ä¸­å¤®ä»“åº“æˆ–ç§æœ‰ä»“åº“ï¼‰ä¸‹è½½å®ƒä»¬ã€‚
	â€¢	ç¼–è¯‘æºç ï¼šå°† Java æºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç ï¼ˆ.class æ–‡ä»¶ï¼‰ã€‚
	â€¢	æ‰“åŒ…ï¼šå°†ç¼–è¯‘å¥½çš„ .class æ–‡ä»¶ã€èµ„æºæ–‡ä»¶å’Œä¾èµ–é¡¹æ‰“åŒ…æˆ .jar æˆ– .war æ–‡ä»¶ï¼Œä¾›è¿è¡Œæˆ–éƒ¨ç½²ä½¿ç”¨ã€‚
	â€¢	æ‰§è¡Œæµ‹è¯•ï¼šé€šè¿‡ mvn test å‘½ä»¤è¿è¡Œå•å…ƒæµ‹è¯•ï¼Œç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§ã€‚
	â€¢	å®‰è£…å’Œå‘å¸ƒï¼šå¯ä»¥å°†ç”Ÿæˆçš„ .jar æ–‡ä»¶å‘å¸ƒåˆ°ç§æœ‰ä»“åº“æˆ–è¿œç¨‹ä»“åº“ä¸­ã€‚

Maven åªå…³æ³¨ Java é¡¹ç›®çš„æ„å»ºã€ä¾èµ–ç®¡ç†å’Œæµ‹è¯•ï¼Œè€Œä¸æ¶‰åŠå°†é¡¹ç›®éƒ¨ç½²åˆ°å®¹å™¨åŒ–ç¯å¢ƒä¸­è¿è¡Œã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŒ…å« maven build.sh çš„ Dockerfile ç¤ºä¾‹ï¼Œå¹¶æ”¯æŒ SonarQube ä»£ç è´¨é‡æ£€æŸ¥ã€‚è¯¥ Dockerfile ä¼šæ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š
	1.	å®‰è£… Maven å¹¶æ„å»ºé¡¹ç›®ï¼šä½¿ç”¨ maven build.sh æ‰§è¡Œ mvn clean install ã€‚
	2.	é›†æˆ SonarQubeï¼šæ‰§è¡Œ mvn sonar:sonar è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥ã€‚
	3.	æ‰“åŒ…æœ€ç»ˆçš„åº”ç”¨ï¼šä½¿ç”¨ mvn package æ„å»º JAR æ–‡ä»¶ï¼Œå¹¶å°†å…¶å¤åˆ¶åˆ°æœ€ç»ˆçš„è¿è¡Œå®¹å™¨ä¸­ã€‚

â¸»

ç›®å½•ç»“æ„ç¤ºä¾‹ï¼š
```bash
my-service/
â”‚â”€â”€ src/                   # ä½ çš„ Java æºä»£ç 
â”‚â”€â”€ pom.xml                # Maven é…ç½®æ–‡ä»¶
â”‚â”€â”€ Dockerfile             # Docker æ„å»ºæ–‡ä»¶
â”‚â”€â”€ build.sh               # Maven æ„å»ºè„šæœ¬
```
â¸»

build.shï¼ˆMaven æ„å»ºè„šæœ¬ï¼‰
```bash
#!/bin/bash
set -e

echo "Running Maven build..."
mvn clean install -DskipTests

echo "Running SonarQube analysis..."
mvn sonar:sonar \
    -Dsonar.projectKey=my-service \
    -Dsonar.host.url=http://sonarqube:9000 \
    -Dsonar.login=my-sonar-token
```
è¯´æ˜ï¼š
	â€¢	mvn clean install -DskipTestsï¼šè·³è¿‡æµ‹è¯•ï¼Œç¼–è¯‘å’Œå®‰è£…ä¾èµ–ã€‚
	â€¢	mvn sonar:sonarï¼šæ‰§è¡Œ SonarQube ä»£ç æ‰«æã€‚
	â€¢	-Dsonar.host.url=http://sonarqube:9000ï¼šSonarQube æœåŠ¡å™¨åœ°å€ã€‚
	â€¢	-Dsonar.login=my-sonar-tokenï¼šSonarQube è®¤è¯ Tokenã€‚

â¸»

```Dockerfile

# ä½¿ç”¨å®˜æ–¹ Maven ä½œä¸ºæ„å»ºç¯å¢ƒ
FROM maven:3.8.6-openjdk-17 AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ Maven é…ç½®æ–‡ä»¶ï¼ˆåŠ é€Ÿæ„å»ºï¼‰
COPY pom.xml ./
RUN mvn dependency:go-offline

# å¤åˆ¶æºä»£ç 
COPY src ./src
COPY build.sh ./

# ç»™äºˆ build.sh æ‰§è¡Œæƒé™
RUN chmod +x build.sh

# è¿è¡Œ Maven æ„å»ºå’Œ SonarQube æ£€æŸ¥
RUN ./build.sh

# ä½¿ç”¨ OpenJDK ä½œä¸ºè¿è¡Œæ—¶ç¯å¢ƒ
FROM openjdk:17-jdk-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶ JAR åŒ…
COPY --from=builder /app/target/*.jar app.jar

# æš´éœ²ç«¯å£
EXPOSE 8080

# è¿è¡Œ Spring Boot åº”ç”¨
CMD ["java", "-jar", "app.jar"]
```

Starting from version 2.0, we provide custom Dockerfile support. You can use custom Dockerfiles in your project to implement customized build processes.


ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„è‡ªå®šä¹‰ Dockerfileï¼Œå®ƒç»“åˆäº† Maven æ„å»ºã€SonarQube ä»£ç æ‰«æ å’Œ Docker å®¹å™¨åŒ–ï¼Œç¡®ä¿åœ¨ CI/CD è¿‡ç¨‹ä¸­ä»£ç è´¨é‡å’Œå¯å¤ç”¨æ€§ã€‚
â¸»

ä½¿ç”¨æ–¹æ³•ï¼š
	1.	æ„å»º Docker é•œåƒ

docker build -t my-service .


	2.	è¿è¡Œå®¹å™¨

docker run -p 8080:8080 my-service


	3.	ä½¿ç”¨ SonarQube
å¦‚æœä½ çš„ SonarQube è¿è¡Œåœ¨ http://localhost:9000ï¼Œç¡®ä¿ä½ å·²ç»é…ç½®äº† my-sonar-token å¹¶ä¸”æœåŠ¡å¯ç”¨ã€‚

â¸»

è¿™ä¸ª Dockerfile ç»“åˆäº† Maven æ„å»ºã€SonarQube ä»£ç æ‰«æ å’Œ Docker å®¹å™¨åŒ–ï¼Œç¡®ä¿åœ¨ CI/CD è¿‡ç¨‹ä¸­ä»£ç è´¨é‡å’Œå¯å¤ç”¨æ€§ã€‚å¦‚æœä½ æœ‰æ›´å¤æ‚çš„éœ€æ±‚ï¼Œæ¯”å¦‚ å¤šé˜¶æ®µæ„å»ºã€ç¼“å­˜ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥è¿›ä¸€æ­¥è°ƒæ•´ã€‚ğŸš€


æˆ‘æ—¢ç„¶å¯ä»¥è‡ªå®šä¹‰Dockfileå…¶å®æˆ‘æ˜¯å®Œå…¨å¯ä»¥æŠŠmav buildçš„ä»»åŠ¡èå…¥è¿›å»çš„



æ˜¯çš„ï¼Œä½ å®Œå…¨å¯ä»¥åœ¨ Dockerfile é‡Œç›´æ¥æ‰§è¡Œ Maven æ„å»ºä»»åŠ¡ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„ build.sh è„šæœ¬ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äº CI/CD åœºæ™¯ï¼Œå¯ä»¥å‡å°‘é¢å¤–çš„æ–‡ä»¶ç®¡ç†ï¼Œè®© Docker æ„å»ºè¿‡ç¨‹æ›´åŠ æ¸…æ™°ã€‚

â¸»

ç›´æ¥åœ¨ Dockerfile é‡Œæ‰§è¡Œ Maven æ„å»º

ä½ å¯ä»¥ä½¿ç”¨ å¤šé˜¶æ®µæ„å»ºï¼ˆMulti-Stage Buildï¼‰ï¼Œåœ¨ Docker æ„å»ºè¿‡ç¨‹ä¸­ç¼–è¯‘ä»£ç ï¼Œå¹¶å°†æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚ JAR åŒ…ï¼‰å¤åˆ¶åˆ°ä¸€ä¸ªè½»é‡çº§çš„è¿è¡Œæ—¶ç¯å¢ƒä¸­ã€‚

Dockerfile ç¤ºä¾‹
```dockerfile
# ä½¿ç”¨ Maven æ„å»ºç¯å¢ƒ
FROM maven:3.8.6-openjdk-17 AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶ Maven é…ç½®æ–‡ä»¶ï¼ˆåŠ é€Ÿä¾èµ–ä¸‹è½½ï¼‰
COPY pom.xml ./

# é¢„ä¸‹è½½ä¾èµ–ï¼Œé¿å…åç»­æ„å»ºæ—¶é‡å¤ä¸‹è½½
RUN mvn dependency:go-offline

# å¤åˆ¶æºä»£ç 
COPY src ./src

# è¿è¡Œ Maven æ„å»º
RUN mvn clean package -DskipTests

# ä½¿ç”¨è½»é‡çº§ JDK è¿è¡Œæ—¶ç¯å¢ƒ
FROM openjdk:17-jdk-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶ JAR æ–‡ä»¶
COPY --from=builder /app/target/*.jar app.jar

# æš´éœ²ç«¯å£
EXPOSE 8080

# è¿è¡Œ Spring Boot åº”ç”¨
CMD ["java", "-jar", "app.jar"]
```


â¸»

ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ

| æ„å»ºæ–¹å¼ | ä¼˜åŠ¿ | ç¼ºç‚¹ |
|---------|------|------|
| Dockerfile ç›´æ¥æ‰§è¡Œ Maven | â€¢ å‡å°‘é¢å¤–çš„ build.sh ä¾èµ–<br>â€¢ ç›´æ¥åœ¨ CI/CD ä¸­ä½¿ç”¨<br>â€¢ å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒä½“ç§¯ | â€¢ Dockerfile å¤æ‚åº¦ç¨å¾®å¢åŠ  |
| ä½¿ç”¨ build.sh | â€¢ è„šæœ¬å¯å¤ç”¨<br>â€¢ é€‚åˆæœ¬åœ°å¼€å‘è°ƒè¯• | â€¢ é¢å¤–çš„è„šæœ¬ç®¡ç†<br>â€¢ Dockerfile å¯èƒ½éœ€è¦é¢å¤– COPY |



â¸»

å¦‚æœä½ è¿˜éœ€è¦é›†æˆ SonarQube

å¦‚æœè¦åœ¨ Dockerfile é‡Œç›´æ¥æ‰§è¡Œ mvn sonar:sonarï¼Œå¯ä»¥ä¿®æ”¹ï¼š

RUN mvn clean package sonar:sonar -DskipTests \
    -Dsonar.host.url=http://sonarqube:9000 \
    -Dsonar.login=my-sonar-token

ä½†é€šå¸¸ mvn sonar:sonar é€‚åˆåœ¨ CI/CD æµæ°´çº¿é‡Œå•ç‹¬æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥æ”¾è¿› Dockerfile é‡Œã€‚

â¸»

ç»“è®º
	â€¢	ä½  å®Œå…¨å¯ä»¥ åœ¨ Dockerfile é‡Œç›´æ¥è¿è¡Œ mvn buildï¼Œå¹¶ä¸éœ€è¦ build.shã€‚
	â€¢	æ¨èä½¿ç”¨å¤šé˜¶æ®µæ„å»ºï¼Œé¿å…æŠŠ Maven å’Œ JDK ä¸€èµ·æ”¾åœ¨æœ€ç»ˆé•œåƒé‡Œï¼Œå‡å°‘é•œåƒä½“ç§¯ã€‚
	â€¢	å¦‚æœ CI/CD éœ€è¦ SonarQube åˆ†æï¼Œå»ºè®®å•ç‹¬åœ¨æµæ°´çº¿é‡Œæ‰§è¡Œï¼Œè€Œä¸æ˜¯åœ¨ Dockerfile é‡Œè¿è¡Œ mvn sonar:sonarã€‚

è¿™æ ·ï¼Œä½ çš„ Dockerfile å°±å˜å¾—æ›´æ¸…æ™°ã€å¯ç»´æŠ¤ï¼ŒåŒæ—¶æ„å»ºçš„ Docker é•œåƒä½“ç§¯æ›´å° ğŸš€ã€‚




æ˜¯çš„ï¼ŒDockerfile éœ€è¦é€‰æ‹©ä¸€ä¸ªåŒ…å« mvnï¼ˆMavenï¼‰å‘½ä»¤çš„åŸºç¡€é•œåƒï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œ mvn clean package ç­‰æ„å»ºä»»åŠ¡ã€‚ä½ çš„ Dockerfile é‡Œ FROM æŒ‡å®šçš„é•œåƒå†³å®šäº†æ˜¯å¦èƒ½è¿è¡Œ mvnã€‚

â¸»

é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ

é€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ï¼š

æ–¹æ³• 1ï¼šä½¿ç”¨ maven å®˜æ–¹é•œåƒ

Maven å®˜æ–¹æä¾›äº†å¸¦ Java ç¯å¢ƒçš„é•œåƒï¼Œé€‚åˆæ„å»º Java é¡¹ç›®ï¼š

`FROM maven:3.8.6-openjdk-17 AS builder`

âœ… ä¼˜ç‚¹ï¼š
	â€¢	å·²åŒ…å« Maven å’Œ OpenJDKï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚
	â€¢	é€‚ç”¨äº æ„å»ºé˜¶æ®µï¼Œæ¯”å¦‚ mvn packageã€mvn install ç­‰ä»»åŠ¡ã€‚

ğŸš« ç¼ºç‚¹ï¼š
	â€¢	ä½“ç§¯è¾ƒå¤§ï¼ˆåŒ…å« Maven å’Œ Java å¼€å‘å·¥å…·ï¼‰ï¼Œä¸é€‚åˆä½œä¸ºæœ€ç»ˆè¿è¡Œç¯å¢ƒã€‚

â¸»

æ–¹æ³• 2ï¼šä½¿ç”¨ openjdk + æ‰‹åŠ¨å®‰è£… Maven

å¦‚æœä½ çš„åŸºç¡€é•œåƒæ˜¯ openjdkï¼Œä½†ä½ ä»ç„¶æƒ³ç”¨ Maven æ„å»ºé¡¹ç›®ï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£…ï¼š
```Dockerfile
# ä½¿ç”¨å®˜æ–¹ Maven ä½œä¸ºæ„å»ºç¯å¢ƒ

FROM openjdk:17-jdk-slim AS builder

# æ‰‹åŠ¨å®‰è£… Maven
RUN apt update && apt install -y maven

WORKDIR /app
COPY pom.xml ./
RUN mvn dependency:go-offline
COPY src ./src
RUN mvn clean package -DskipTests
```
âœ… ä¼˜ç‚¹ï¼š
	â€¢	é€‚ç”¨äºå®šåˆ¶åŒ–éœ€æ±‚ï¼Œæ¯”å¦‚ç‰¹å®š Maven ç‰ˆæœ¬æˆ–é•œåƒä¼˜åŒ–ã€‚
	â€¢	openjdk:17-jdk-slim ä½“ç§¯æ¯” maven å®˜æ–¹é•œåƒå°ã€‚

ğŸš« ç¼ºç‚¹ï¼š
	â€¢	éœ€è¦æ‰‹åŠ¨å®‰è£… Mavenï¼Œå¢åŠ  apt install ä¾èµ–ã€‚

â¸»

æ„å»ºåçš„æœ€ç»ˆè¿è¡Œç¯å¢ƒ

æ— è®ºæ˜¯ç”¨ maven è¿˜æ˜¯ openjdk è¿›è¡Œæ„å»ºï¼Œæœ€ç»ˆè¿è¡Œç¯å¢ƒåº”å°½é‡ ç²¾ç®€ï¼š
```Dockerfile
FROM openjdk:17-jdk-slim
WORKDIR /app
COPY --from=builder /app/target/*.jar app.jar
EXPOSE 8080
CMD ["java", "-jar", "app.jar"]
```
è¿™æ ·æœ€ç»ˆçš„ Docker é•œåƒä½“ç§¯æ›´å°ï¼Œä¸ä¼šåŒ…å« Maven å’Œé¢å¤–çš„å¼€å‘å·¥å…·ã€‚

â¸»

æ€»ç»“

| æ–¹æ³• | FROM é•œåƒ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | ç¼ºç‚¹ |
|------|------------|----------|------|------|
| å®˜æ–¹ Maven é•œåƒ | maven:3.8.6-openjdk-17 | ç›´æ¥ä½¿ç”¨ Maven è¿›è¡Œæ„å»º | çœå»æ‰‹åŠ¨å®‰è£…æ­¥éª¤ | é•œåƒä½“ç§¯è¾ƒå¤§ |
| æ‰‹åŠ¨å®‰è£… Maven | openjdk:17-jdk-slim + apt install maven | è‡ªå®šä¹‰ Maven ç‰ˆæœ¬æˆ–ç²¾ç®€æ„å»º | é•œåƒæ›´å°ï¼Œé€‚åˆå®šåˆ¶åŒ– | éœ€è¦ apt install |
| è¿è¡Œæ—¶ç¯å¢ƒ | openjdk:17-jdk-slim | è¿è¡Œ Spring Boot æˆ– Java åº”ç”¨ | é•œåƒæœ€å°ï¼Œé€‚åˆç”Ÿäº§ | ä¸èƒ½ç”¨äºæ„å»º |

ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹å¼ï¼Œä¸€èˆ¬æ¨èç”¨ Maven å®˜æ–¹é•œåƒæ„å»ºï¼Œæœ€ç»ˆç”¨ OpenJDK è¿è¡Œï¼Œè¿™æ ·æ—¢èƒ½ä¼˜åŒ–æ„å»ºï¼Œåˆèƒ½å‡å°æœ€ç»ˆé•œåƒå¤§å° ğŸš€ã€‚




#  Docker Image Build
1. Docker Image Build

Docker Image Build æ˜¯é€šè¿‡ Dockerfile æ„å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¾èµ–ã€åº”ç”¨å’Œç¯å¢ƒçš„ æ“ä½œç³»ç»Ÿçº§é•œåƒã€‚è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ‰“åŒ…è¿‡ç¨‹ï¼Œå¯ä»¥åœ¨ä»»ä½•æ”¯æŒ Docker çš„ç¯å¢ƒä¸­è¿è¡Œã€‚

Docker Image Build çš„ä¸»è¦ä»»åŠ¡

	â€¢	å®šä¹‰è¿è¡Œç¯å¢ƒï¼šé€šè¿‡ Dockerfile æŒ‡å®šåŸºç¡€é•œåƒï¼ˆå¦‚ openjdkï¼‰ï¼Œæä¾›è¿è¡Œ Java åº”ç”¨æ‰€éœ€çš„åŸºç¡€ç¯å¢ƒã€‚
	â€¢	å¤åˆ¶æ–‡ä»¶ï¼šå¯ä»¥å°†ç¼–è¯‘å¥½çš„ .jar æ–‡ä»¶æˆ–æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒä¸­ã€‚
	â€¢	å®‰è£…ä¾èµ–ï¼šé™¤äº†åº”ç”¨ç¨‹åºä¹‹å¤–ï¼Œè¿˜å¯ä»¥å®‰è£…ç³»ç»Ÿçº§çš„ä¾èµ–ï¼ˆä¾‹å¦‚ç³»ç»Ÿå·¥å…·ã€åº“ç­‰ï¼‰ï¼Œè¿™åœ¨åº”ç”¨è¿è¡Œæ—¶å¯èƒ½éœ€è¦ã€‚
	â€¢	æ‰§è¡Œå‘½ä»¤ï¼šå¯ä»¥é€šè¿‡ Dockerfile æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå¦‚ java -jar app.jarï¼‰ï¼Œä¿è¯åº”ç”¨å¯åŠ¨è¿è¡Œã€‚
	â€¢	ç”Ÿæˆé•œåƒï¼šæœ€ç»ˆå°†æ‰€æœ‰å†…å®¹æ‰“åŒ…æˆä¸€ä¸ª Docker é•œåƒï¼Œå¯ä»¥åœ¨ä»»ä½•å®¹å™¨ç¯å¢ƒä¸­è¿è¡Œå¹¶ä¿è¯ä¸€è‡´æ€§ã€‚

Docker Build æ˜¯ä»¥å®¹å™¨ä¸ºåŸºç¡€ï¼Œå°†æ•´ä¸ªåº”ç”¨åŠå…¶è¿è¡Œæ—¶ç¯å¢ƒå°è£…åœ¨ä¸€ä¸ªé•œåƒä¸­ï¼Œé€‚åˆäºè·¨å¹³å°ã€è·¨ç¯å¢ƒçš„éƒ¨ç½²ã€‚

ä¸¤è€…çš„åŒºåˆ«æ€»ç»“

æ¯”è¾ƒé¡¹	Maven Build	Docker Image Build
ç›®æ ‡	ç¼–è¯‘ã€æ‰“åŒ… Java é¡¹ç›®ï¼Œç”Ÿæˆ .jar æˆ– .war æ–‡ä»¶	åˆ›å»ºåº”ç”¨å’Œç¯å¢ƒçš„å®Œæ•´é•œåƒï¼Œä¾¿äºè·¨ç¯å¢ƒè¿è¡Œ
ä¾èµ–ç®¡ç†	ä½¿ç”¨ pom.xml ç®¡ç† Java ä¾èµ–	ä½¿ç”¨åŸºç¡€é•œåƒæä¾›ç¯å¢ƒï¼Œæ”¯æŒç³»ç»Ÿçº§ä¾èµ–çš„å®‰è£…
æ„å»ºè¾“å‡º	.jar æˆ– .war æ–‡ä»¶	å¯è¿è¡Œçš„ Docker é•œåƒ
æ˜¯å¦ç‹¬ç«‹è¿è¡Œ	ä¸èƒ½ç‹¬ç«‹è¿è¡Œï¼Œéœ€è¦ Java ç¯å¢ƒæ”¯æŒ	å®Œå…¨ç‹¬ç«‹çš„å¯è¿è¡Œå•å…ƒï¼Œåœ¨å®¹å™¨ä¸­è¿è¡Œ
éƒ¨ç½²æ–¹å¼	éœ€è¦ä¾èµ–åº”ç”¨æœåŠ¡å™¨æˆ– Java ç¯å¢ƒè¿›è¡Œéƒ¨ç½²	å¯ç›´æ¥éƒ¨ç½²è‡³ä»»ä½•æ”¯æŒ Docker çš„ç¯å¢ƒï¼Œå¦‚ Kubernetes æˆ–æœ¬åœ°æœºå™¨

åº”ç”¨ç¤ºä¾‹

	1.	Maven Buildï¼šæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ„å»ºé¡¹ç›®

mvn clean package

ç”Ÿæˆçš„ .jar æ–‡ä»¶å¯ä»¥å‘å¸ƒåˆ° Maven ä»“åº“ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ·»åŠ åˆ° Docker é•œåƒä¸­ã€‚

	2.	Docker Image Buildï¼šåœ¨ Dockerfile ä¸­æŒ‡å®šäº†æ„å»ºç¯å¢ƒï¼Œæ„å»ºé•œåƒæ—¶å¯ä»¥ä½¿ç”¨

docker build -t my-java-app .
docker push my-java-app nexus:5000/my-java-app

è¿™å°†ç”Ÿæˆä¸€ä¸ªé•œåƒå¹¶æ¨é€è‡³ Nexus ä»“åº“ï¼Œä»¥ä¾›åœ¨å…¶ä»–ç¯å¢ƒä¸­éƒ¨ç½²ä½¿ç”¨ã€‚

æ„å»ºè¿‡ç¨‹çš„å…³ç³»å›¾

ä»¥ä¸‹ Mermaid å›¾ç¤ºå±•ç¤ºäº†ä¸¤ç§æ„å»ºæ–¹å¼çš„åŒºåˆ«å’Œå…³è”ï¼š
```mermaid
graph TD
    A[Maven Build]
    A --> B[ç¼–è¯‘æºä»£ç ]
    A --> C[æ‰“åŒ…æˆ JAR æ–‡ä»¶]
    B --> C
    C --> D[æ¨é€è‡³ Maven ä»“åº“]

    E[Docker Image Build]
    E --> F[åŸºäº Dockerfile æ„å»ºé•œåƒ]
    F --> G[æ·»åŠ  JAR æ–‡ä»¶åŠä¾èµ–]
    G --> H[ç”Ÿæˆ Docker é•œåƒ]
    H --> I[æ¨é€è‡³ Nexus ä»“åº“]
```
å¸Œæœ›è¿™å¯ä»¥æ¸…æ™°å±•ç¤ºä¸¤è€…çš„ä½œç”¨åŒºåˆ«ã€‚

æ˜¯çš„ï¼Œå°† Docker é•œåƒ å’Œ Maven ä¾èµ– åˆ†åˆ«å­˜å‚¨åœ¨ä¸åŒçš„ Nexus ä»“åº“ä¸­æ˜¯å®Œå…¨å¯è¡Œçš„ã€‚è¿™ç§åˆ†ç¦»ä¸ä»…ç¬¦åˆå®é™…åº”ç”¨ä¸­çš„åˆ†å·¥éœ€æ±‚ï¼Œè¿˜èƒ½å¢å¼ºç³»ç»Ÿç®¡ç†å’Œè®¿é—®æ§åˆ¶ã€‚å…·ä½“å¦‚ä¸‹ï¼š

ä¼˜åŠ¿

	1.	åˆ†ç¦»ç®¡ç†ï¼šDocker é•œåƒå’Œ Maven ä¾èµ–å„è‡ªæœ‰ä¸åŒçš„ç®¡ç†éœ€æ±‚ï¼Œåˆ†å¼€å­˜å‚¨èƒ½æ›´æ¸…æ™°åœ°ç®¡ç†è¿™äº›èµ„æºã€‚
	2.	è®¿é—®æ§åˆ¶ï¼šæ‚¨å¯ä»¥é’ˆå¯¹ä¸åŒä»“åº“è®¾ç½®ç‹¬ç«‹çš„è®¿é—®æƒé™ï¼Œä¾‹å¦‚é™åˆ¶æ„å»ºå·¥å…·ï¼ˆå¦‚ Jenkinsï¼‰åªè®¿é—® Docker é•œåƒçš„ Nexusï¼Œè€Œå¼€å‘äººå‘˜ä¸»è¦è®¿é—® Maven ä¾èµ–ä»“åº“ã€‚
	3.	æ€§èƒ½ä¼˜åŒ–ï¼šæ ¹æ®ä½¿ç”¨åœºæ™¯ä¼˜åŒ–æ¯ä¸ª Nexus ä»“åº“çš„ç¼“å­˜ã€å¤‡ä»½å’Œæ›´æ–°ç­–ç•¥ã€‚ä¾‹å¦‚ï¼ŒDocker é•œåƒå¯èƒ½éœ€è¦è¾ƒå¤§çš„å­˜å‚¨ç©ºé—´ï¼Œè€Œ Maven ä»“åº“åˆ™å¯ä»¥æ›´ä¸“æ³¨äºä¾èµ–ç‰ˆæœ¬çš„ç¼“å­˜ã€‚
	4.	ç¾å¤‡åˆ†ç¦»ï¼šä¸åŒä»“åº“å¯ä»¥é‡‡å–ç‹¬ç«‹çš„å¤‡ä»½å’Œç¾éš¾æ¢å¤ç­–ç•¥ï¼Œé¿å…å•ç‚¹æ•…éšœçš„å½±å“ã€‚

å®æ–½è¦ç‚¹

	â€¢	Docker ä»“åº“é…ç½®ï¼šåœ¨ Nexus ä¸­åˆ›å»º Dockerï¼ˆHostedï¼‰ä»“åº“ï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†æ„å»ºçš„ Docker é•œåƒï¼Œå¹¶é…ç½®åˆé€‚çš„ç«¯å£å·ï¼ˆä¾‹å¦‚ 5000ï¼‰ï¼Œä¾¿äºæ¨é€å’Œæ‹‰å–é•œåƒã€‚
	â€¢	Maven ä»“åº“é…ç½®ï¼šåœ¨ Nexus ä¸­åˆ›å»º Mavenï¼ˆHosted/Proxyï¼‰ä»“åº“ç”¨äºå­˜å‚¨é¡¹ç›®çš„ä¾èµ–é¡¹å’Œæ„å»ºäº§ç‰©ï¼ˆå¦‚ .jar å’Œ .warï¼‰ï¼Œå¹¶æŒ‡å®šä¸º Maven é¡¹ç›®ä½¿ç”¨çš„ä»“åº“åœ°å€ã€‚
	â€¢	æ„å»ºé…ç½®ç¤ºä¾‹ï¼š
	â€¢	Maven æ„å»ºï¼šæŒ‡å®š Maven ä»“åº“åœ°å€ï¼Œæ„å»ºå’Œä¸‹è½½ä¾èµ–ã€‚ä¾‹å¦‚ï¼Œåœ¨ settings.xml ä¸­é…ç½®ï¼š

<repository>
    <id>maven-repo</id>
    <url>http://your-nexus-server:8081/repository/maven-releases/</url>
</repository>


	â€¢	Docker æ„å»ºå’Œæ¨é€ï¼šä½¿ç”¨ Dockerfile æ„å»ºé•œåƒå¹¶æ¨é€è‡³ Docker Nexus ä»“åº“ã€‚ä¾‹å¦‚ï¼š

docker build -t my-java-app .
docker tag my-java-app your-nexus-server:5000/my-java-app
docker push your-nexus-server:5000/my-java-app



å…³ç³»å›¾ç¤º

ä»¥ä¸‹ Mermaid å›¾å±•ç¤ºäº†ä¸¤ç§ Nexus ä»“åº“çš„åˆ†å·¥å’Œæ•°æ®æµåŠ¨ï¼š
```mermaid
graph TD
    A[å¼€å‘è€…]
    B[Jenkins æ„å»ºæœåŠ¡å™¨]
    C[Nexus - Maven ä»“åº“]
    D[Nexus - Docker ä»“åº“]
    E[ç”Ÿäº§ç¯å¢ƒ]

    A -->|Maven æ„å»º & ä¸‹è½½ä¾èµ–| C
    B -->|æ‹‰å– Maven ä¾èµ–| C
    B -->|Docker Build & Push é•œåƒ| D
    E -->|æ‹‰å– Docker é•œåƒ| D
```
æ€»ç»“

è¿™ç§åˆ†ç¦»ä¸ä»…æå‡ç®¡ç†çµæ´»æ€§ï¼Œè€Œä¸”æœ‰åŠ©äºæ§åˆ¶ä¸åŒèµ„æºçš„ä½¿ç”¨æƒé™ã€ä¼˜åŒ–æ€§èƒ½ã€‚
