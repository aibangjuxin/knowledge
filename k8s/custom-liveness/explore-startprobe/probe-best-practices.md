# GKE Explorer: æ¢é’ˆé…ç½®æœ€ä½³å®è·µæŒ‡å—

æœ¬æ–‡æ¡£åŸºäºæ‚¨çš„ Deployment æ¨¡æ¿ (`{{apiName}}-{{apiVersion}}-deployment`)ï¼Œä¸ºæ‚¨æä¾›ä¸€å¥—å¯è½åœ°çš„ Pod å¯åŠ¨ä¸å­˜æ´»æ¢é’ˆï¼ˆProbeï¼‰é…ç½®æ–¹æ¡ˆã€‚

## ğŸ“‹ ç›®å½•

1. [æ ¸å¿ƒæ¦‚å¿µï¼šå¯åŠ¨æµç¨‹ä¸æ¢é’ˆ](#1-æ ¸å¿ƒæ¦‚å¿µå¯åŠ¨æµç¨‹ä¸æ¢é’ˆ)
2. [ç¬¬ä¸€æ­¥ï¼šæµ‹é‡çœŸå®å¯åŠ¨æ—¶é—´](#2-ç¬¬ä¸€æ­¥æµ‹é‡çœŸå®å¯åŠ¨æ—¶é—´-the-metric)
3. [ç¬¬äºŒæ­¥ï¼šå‚æ•°è®¡ç®—å…¬å¼](#3-ç¬¬äºŒæ­¥å‚æ•°è®¡ç®—å…¬å¼-the-math)
4. [æœ€ä½³å®è·µé…ç½®æ¨¡æ¿](#4-æœ€ä½³å®è·µé…ç½®æ¨¡æ¿)
5. [æ·±åº¦è§£æ](#5-æ·±åº¦è§£æ-deep-dive)
6. [å¸¸è§é—®é¢˜è§£ç­”](#6-å¸¸è§é—®é¢˜è§£ç­”-faq)
7. [æ€»ç»“ï¼šå¹³å°åŒ–å»ºè®®](#7-æ€»ç»“å¹³å°åŒ–å»ºè®®)
8. [å¯è§†åŒ–ï¼šæ¢é’ˆå®Œæ•´å·¥ä½œæµç¨‹](#8-å¯è§†åŒ–æ¢é’ˆå®Œæ•´å·¥ä½œæµç¨‹) â­ æ¨è
9. [é™„å½•ï¼šStartupProbe è¯¦ç»†æ—¶åºåˆ†æ](#9-é™„å½•startupprobe-è¯¦ç»†æ—¶åºåˆ†æ)

---

## 1. æ ¸å¿ƒæ¦‚å¿µï¼šå¯åŠ¨æµç¨‹ä¸æ¢é’ˆ

è¦å‡†ç¡®é…ç½®æ¢é’ˆï¼Œé¦–å…ˆå¿…é¡»ç†è§£ Pod çš„å¯åŠ¨æ—¶é—´çº¿ï¼Œç‰¹åˆ«æ˜¯ `InitContainer` ä¸ `StartupProbe` çš„å…³ç³»ã€‚

### 1.1 å¯åŠ¨æ—¶é—´çº¿åˆ†æ

åœ¨æ‚¨çš„ Deployment ä¸­ï¼Œå¯åŠ¨è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š

```mermaid
timeline
    title Pod å¯åŠ¨å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
    section Init é˜¶æ®µ
        InitContainer (appd-init-service) : å¤åˆ¶ Agent æ–‡ä»¶
        Init è€—æ—¶ : å±äº Pod å¯åŠ¨æ—¶é—´<br>ä½†ä¸è®¡å…¥ Probe è®¡æ—¶
    section App å®¹å™¨å¯åŠ¨
        Main Container Created : å®¹å™¨åˆ›å»º
        Process Start : ä¸šåŠ¡è¿›ç¨‹å¯åŠ¨ (Java/Go/Node...)
        App Logic Load : åŠ è½½é…ç½®/æ•°æ®åº“è¿æ¥/ç¼“å­˜é¢„çƒ­
        StartupProbe Active : âš ï¸ æ­¤æ—¶æ¢é’ˆå¼€å§‹å·¥ä½œ
        App Ready : ä¸šåŠ¡å®Œå…¨å°±ç»ª
```

> [!IMPORTANT]
> **å…³é”®è®¤çŸ¥**ï¼š
> `startupProbe`ã€`livenessProbe` å’Œ `readinessProbe` **åªåœ¨ä¸»å®¹å™¨ï¼ˆContainersï¼‰å¯åŠ¨åæ‰å¼€å§‹è®¡æ—¶**ã€‚
>
> *   **Init Container (appd-init-service)** çš„è€—æ—¶**ä¸ä¼š**æ¶ˆè€— `startupProbe` çš„æ—¶é—´é…é¢ã€‚
> *   å¦‚æœ Init Container å¡ä½ï¼ˆä¾‹å¦‚ `cp -r` ææ…¢æˆ–å¤±è´¥ï¼‰ï¼ŒPod çŠ¶æ€ä¼šåœç•™åœ¨ `Init:0/1`ï¼Œæ­¤æ—¶ä¸»å®¹å™¨è¿˜æ²¡åˆ›å»ºï¼Œæ¢é’ˆæ ¹æœ¬è¿˜æ²¡å¼€å§‹å·¥ä½œã€‚
> *   å› æ­¤ï¼Œ**æ¢é’ˆé…ç½®æ— éœ€è€ƒè™‘ Init Container çš„è€—æ—¶**ã€‚

### 1.2 æ¢é’ˆèŒè´£çŸ©é˜µ

| æ¢é’ˆç±»å‹ | å…³é”®å‚æ•° | èŒè´£ | å¤±è´¥åæœ | å»ºè®®é…ç½®åŸåˆ™ |
| :--- | :--- | :--- | :--- | :--- |
| **Startup** | `failureThreshold` | **ä¿æŠ¤æ…¢å¯åŠ¨**ã€‚ç»™åº”ç”¨è¶³å¤Ÿçš„æ—¶é—´å®Œæˆåˆå§‹åŒ–ï¼ˆåŠ è½½ç±»ã€è¿æ¥æ± ç­‰ï¼‰ã€‚ | **é‡å¯å®¹å™¨** (Kill & Restart) | **å®å¤§å‹¿å°**ã€‚è¦†ç›– 99% çš„å¯åŠ¨åœºæ™¯ã€‚ |
| **Readiness** | `periodSeconds` | **æµé‡æ§åˆ¶**ã€‚å†³å®šæ˜¯å¦å°† Pod IP åŠ å…¥ Service çš„ Endpointsã€‚ | **åˆ‡æ–­æµé‡** (Service æ‘˜é™¤) | **æ•æ·**ã€‚å¿«é€Ÿå‘ç°æ•…éšœå¹¶åˆ‡æ–­æµé‡ã€‚ |
| **Liveness** | `failureThreshold` | **æ­»é”æ£€æµ‹**ã€‚å‘ç°åº”ç”¨å‡æ­»ï¼ˆè¿›ç¨‹åœ¨ä½†æ— æ³•å¤„ç†è¯·æ±‚ï¼‰ã€‚ | **é‡å¯å®¹å™¨** (Kill & Restart) | **ä¿å®ˆ**ã€‚é¿å…å› çŸ­æš‚æ³¢åŠ¨å¯¼è‡´çš„è¯¯æ€ã€‚ |

---

## 2. ç¬¬ä¸€æ­¥ï¼šæµ‹é‡çœŸå®å¯åŠ¨æ—¶é—´ (The Metric)

åœ¨è®¾ç½®å‚æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“åº”ç”¨çš„â€œçœŸå®å¯åŠ¨è€—æ—¶â€ã€‚è¿™ä¸ä»…ä»…æ˜¯è¿›ç¨‹å¯åŠ¨çš„æ—¶é—´ï¼Œè€Œæ˜¯**ä¸šåŠ¡é€»è¾‘å®Œå…¨åŠ è½½å®Œæˆï¼Œèƒ½å¤Ÿå“åº”å¥åº·æ£€æŸ¥**çš„æ—¶é—´ã€‚

### 2.1 æµ‹é‡æ–¹æ³•ï¼šè£¸å¯åŠ¨æµ‹è¯• (Bare Metal Start)

æˆ‘ä»¬æ¨èä½¿ç”¨**â€œç§»é™¤æ¢é’ˆæ³•â€**è¿›è¡Œä¸€æ¬¡åŸºå‡†æµ‹è¯•ã€‚è¿™èƒ½é¿å…æ¢é’ˆæœ¬èº«çš„å¹²æ‰°ï¼ˆå¦‚é…ç½®è¿‡ç´§å¯¼è‡´çš„åå¤é‡å¯ï¼‰ã€‚

**æ“ä½œæ­¥éª¤ï¼š**

1.  **åˆ›å»ºæµ‹è¯• Deployment**ï¼šå¤åˆ¶ç°æœ‰çš„ Deployment YAMLã€‚
2.  **ç§»é™¤æ¢é’ˆ**ï¼šæ³¨é‡Šæ‰ `startupProbe`, `readinessProbe`, `livenessProbe` éƒ¨åˆ†ã€‚
3.  **éƒ¨ç½²å¹¶è§‚å¯Ÿ**ï¼šä½¿ç”¨æä¾›çš„è„šæœ¬æµ‹é‡ä» `ContainerStarted` åˆ° `Health Check 200 OK` çš„æ—¶é—´ã€‚

> [!TIP]
> ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æµ‹é‡çš„ä¸æ˜¯ `Init` çš„æ—¶é—´ï¼Œè€Œæ˜¯ä¸»å®¹å™¨ä» **Process Started** -> **Ready** çš„æ—¶é•¿ã€‚

### 2.2 æµ‹é‡è„šæœ¬ (pod_measure_startup_fixed.sh)

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬æ¥æµ‹é‡ Pod çš„çœŸå®å¯åŠ¨æ—¶é—´ã€‚è¯¥è„šæœ¬ä¼šï¼š
- è‡ªåŠ¨è¯»å– Pod çš„æ¢é’ˆé…ç½®
- è®¡ç®—ä»å®¹å™¨å¯åŠ¨åˆ° Ready çŠ¶æ€çš„è€—æ—¶
- åˆ†æå½“å‰é…ç½®æ˜¯å¦åˆç†
- æä¾›ä¼˜åŒ–å»ºè®®

**è„šæœ¬ä½ç½®**ï¼š`k8s/scripts/pod_measure_startup_fixed.sh`

#### ä½¿ç”¨æ–¹æ³•

```bash
# åŸºæœ¬ç”¨æ³•
./pod_measure_startup_fixed.sh -n <namespace> <pod-name>

# ç¤ºä¾‹ï¼šæµ‹é‡ nginx Pod çš„å¯åŠ¨æ—¶é—´
./pod_measure_startup_fixed.sh -n lex nginx-deployment-854b5bc678-m428j
```

#### è¾“å‡ºç¤ºä¾‹

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æµ‹é‡ Pod å¯åŠ¨æ—¶é—´: nginx-deployment-854b5bc678-m428j (å‘½åç©ºé—´: lex)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ æ­¥éª¤ 1: è·å– Pod åŸºæœ¬ä¿¡æ¯
   Pod åˆ›å»ºæ—¶é—´: 2025-10-29T10:58:34Z
   å®¹å™¨å¯åŠ¨æ—¶é—´: 2025-11-30T05:07:28Z

ğŸ“‹ æ­¥éª¤ 2: åˆ†æå°±ç»ªæ¢é’ˆé…ç½®
   å°±ç»ªæ¢é’ˆé…ç½®:
   {
     "failureThreshold": 3,
     "httpGet": {
       "path": "/",
       "port": 80,
       "scheme": "HTTP"
     },
     "periodSeconds": 20,
     "successThreshold": 1,
     "timeoutSeconds": 3
   }

   æå–çš„æ¢é’ˆå‚æ•°:
   - Scheme: HTTP
   - Port: 80
   - Path: /
   - Initial Delay: 0s
   - Period: 20s
   - Failure Threshold: 3

â±ï¸  æ­¥éª¤ 3: æ£€æŸ¥ Pod Ready çŠ¶æ€
   Pod å·²å¤„äº Ready çŠ¶æ€
   Ready æ—¶é—´: 2025-11-30T05:07:38Z

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æœ€ç»ˆç»“æœ (Result)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… åº”ç”¨ç¨‹åºå¯åŠ¨è€—æ—¶: 10 ç§’
   (åŸºäº Kubernetes Ready çŠ¶æ€)

ğŸ“‹ å½“å‰æ¢é’ˆé…ç½®åˆ†æ:
   - å½“å‰é…ç½®å…è®¸çš„æœ€å¤§å¯åŠ¨æ—¶é—´: 60 ç§’
   - å®é™…å¯åŠ¨æ—¶é—´: 10 ç§’
   âœ“ å½“å‰é…ç½®è¶³å¤Ÿ

ğŸ’¡ å»ºè®®çš„ä¼˜åŒ–é…ç½®:
   readinessProbe:
     httpGet:
       path: /
       port: 80
       scheme: HTTP
     initialDelaySeconds: 0
     periodSeconds: 20
     failureThreshold: 1

ğŸ“‹ æˆ–è€…ä½¿ç”¨ startupProbe (æ¨è):
   startupProbe:
     httpGet:
       path: /
       port: 80
       scheme: HTTP
     initialDelaySeconds: 0
     periodSeconds: 10
     failureThreshold: 1
   readinessProbe:
     httpGet:
       path: /
       port: 80
       scheme: HTTP
     initialDelaySeconds: 0
     periodSeconds: 5
     failureThreshold: 3
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

#### è„šæœ¬åŠŸèƒ½ç‰¹ç‚¹

1. **è‡ªåŠ¨æ£€æµ‹æ¢é’ˆé…ç½®**ï¼šæ— éœ€æ‰‹åŠ¨æŒ‡å®šç«¯å£å’Œè·¯å¾„
2. **æ”¯æŒ HTTP å’Œ HTTPS**ï¼šè‡ªåŠ¨è¯†åˆ«åè®®ç±»å‹
3. **å®æ—¶æ¢æµ‹**ï¼šå¦‚æœ Pod æœª Readyï¼Œä¼šå®æ—¶æ¢æµ‹ç›´åˆ°æˆåŠŸ
4. **æ™ºèƒ½å»ºè®®**ï¼šåŸºäºå®é™…å¯åŠ¨æ—¶é—´è®¡ç®—æ¨èé…ç½®
5. **è·¨å¹³å°æ”¯æŒ**ï¼šå…¼å®¹ macOS å’Œ Linux

#### å¤šæ¬¡æµ‹é‡å»ºè®®

ä¸ºäº†è·å¾—å‡†ç¡®çš„ P99 å¯åŠ¨æ—¶é—´ï¼Œå»ºè®®ï¼š

```bash
# 1. åˆ é™¤ç°æœ‰ Podï¼Œè®©å…¶é‡å»º
kubectl delete pod <pod-name> -n <namespace>

# 2. ç­‰å¾…æ–° Pod åˆ›å»º
kubectl get pods -n <namespace> -w

# 3. æµ‹é‡æ–° Pod çš„å¯åŠ¨æ—¶é—´
./pod_measure_startup_fixed.sh -n <namespace> <new-pod-name>

# 4. é‡å¤ 3-5 æ¬¡ï¼Œè®°å½•ç»“æœ
```

å‡è®¾æµ‹é‡ç»“æœå¦‚ä¸‹ï¼ˆç¤ºä¾‹ï¼‰ï¼š
*   ç¬¬ 1 æ¬¡: 15s
*   ç¬¬ 2 æ¬¡: 25s
*   ç¬¬ 3 æ¬¡: 22s
*   ç¬¬ 4 æ¬¡: 18s
*   ç¬¬ 5 æ¬¡: 40s (P99)

**ä½¿ç”¨ P99 å€¼ï¼ˆ40sï¼‰ä½œä¸ºé…ç½®ä¾æ®**ï¼Œç¡®ä¿ 99% çš„å¯åŠ¨åœºæ™¯éƒ½èƒ½æˆåŠŸã€‚

---

## 3. ç¬¬äºŒæ­¥ï¼šå‚æ•°è®¡ç®—å…¬å¼ (The Math)

åŸºäºæµ‹é‡å‡ºçš„ **P99ï¼ˆæœ€æ…¢å¯åŠ¨æ—¶é—´ï¼‰**ï¼Œæˆ‘ä»¬å¯ä»¥ç§‘å­¦åœ°è®¡ç®—å‡ºæ¨èå‚æ•°ã€‚

### 3.1 StartupProbeï¼šä¿æŠ¤å¯åŠ¨

ç›®æ ‡ï¼šç¡®ä¿å³ä½¿åœ¨æœ€æ…¢çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨ä¹Ÿæœ‰è¶³å¤Ÿçš„æ—¶é—´å¯åŠ¨ï¼ŒåŒæ—¶ç•™æœ‰å®‰å…¨å†—ä½™ï¼ˆBufferï¼‰ã€‚

*   **Period (æ¢æµ‹é—´éš”)**: å»ºè®®å›ºå®šä¸º **10s**ã€‚å¦‚æœè®¾ç½®å¤ªçŸ­ï¼ˆå¦‚ 1sï¼‰ï¼Œä¼šå¢åŠ  CPU æ¶ˆè€—ä¸”æ— å¿…è¦ã€‚
*   **Target Duration (ç›®æ ‡ä¿æŠ¤æ—¶é•¿)** = `P99å¯åŠ¨æ—¶é—´` Ã— `1.5` (å®‰å…¨ç³»æ•°)ã€‚
*   **FailureThreshold (å¤±è´¥é˜ˆå€¼)** = `Target Duration` / `Period`ã€‚

> **ç¤ºä¾‹è®¡ç®—**ï¼š
> *   P99 å¯åŠ¨æ—¶é—´ = 40s
> *   å®‰å…¨ä¿æŠ¤æ—¶é•¿ = 40s Ã— 1.5 = 60s
> *   Period = 10s
> *   **FailureThreshold** = 60 / 10 = **6**

### 3.2 ReadinessProbeï¼šæ•æ·ä¸Šçº¿

ç›®æ ‡ï¼šåº”ç”¨ä¸€æ—¦ Readyï¼Œå°½å¿«åˆ‡å…¥æµé‡ï¼›è¿è¡Œä¸­ä¸€æ—¦å¼‚å¸¸ï¼Œå°½å¿«åˆ‡æ–­æµé‡ã€‚

*   **InitialDelay**: å»ºè®®è®¾ä¸º **0** æˆ–æå°å€¼ï¼ˆå¦‚ 5sï¼‰ã€‚å› ä¸º StartupProbe æˆåŠŸåæ„å‘³ç€åº”ç”¨å·²ç» Readyï¼Œæ— éœ€å†æ¬¡å¼ºåˆ¶ç­‰å¾…ã€‚
*   **Period**: **5s - 10s**ã€‚
*   **FailureThreshold**: **3** æ¬¡ã€‚
*   **Timeout**: **1s - 3s**ã€‚ä¸è¦å¤ªé•¿ï¼Œå¦‚æœå¥åº·æ£€æŸ¥ 3 ç§’éƒ½ä¸å›ï¼Œè¯´æ˜æœåŠ¡è´Ÿè½½æé«˜ï¼Œä¸åº”å†æ¥æµé‡ã€‚

### 3.3 LivenessProbeï¼šå…œåº•é˜²çº¿

ç›®æ ‡ï¼šåªæœ‰åœ¨åº”ç”¨å½»åº•æ­»é”ï¼ˆDeadlockï¼‰æ—¶æ‰é‡å¯ã€‚

*   **InitialDelay**: **0**ã€‚StartupProbe æˆåŠŸåæ¥ç®¡ï¼Œå¤©ç„¶ä¸éœ€è¦ Delayã€‚
*   **Period**: **10s - 20s**ã€‚
*   **FailureThreshold**: **3 - 5** æ¬¡ã€‚
*   **Timeout**: **5s**ã€‚ç»™å®ƒå¤šä¸€ç‚¹å®½å®¹åº¦ï¼Œé¿å…å›  GC æˆ–ç¬æ—¶é«˜è´Ÿè½½å¯¼è‡´çš„é‡å¯ã€‚

---

## 4. æœ€ä½³å®è·µé…ç½®æ¨¡æ¿

å°†ä¸Šè¿°é€»è¾‘åº”ç”¨åˆ°æ‚¨çš„ `deployment.yaml` ä¸­ï¼š

### 4.1 åœºæ™¯ Aï¼šæ™®é€š Java/Go åº”ç”¨ (å¯åŠ¨è€—æ—¶ < 60s)

```yaml
      # å¯åŠ¨æ¢é’ˆï¼šæ ¸å¿ƒæ˜¯ä¸ºäº†ç»™åº”ç”¨ "ä¹°æ—¶é—´"
      startupProbe:
        httpGet:
          scheme: HTTPS
          path: /{{apiName}}/{{minorVersion}}/.well-known/health
          port: {{port}}
        periodSeconds: 10
        timeoutSeconds: 3
        failureThreshold: 12  # æä¾› 10 * 12 = 120s çš„å¯åŠ¨çª—å£ï¼Œè¶³å¤Ÿåº”å¯¹å¤§å¤šæ•°æ…¢å¯åŠ¨
        successThreshold: 1

      # å°±ç»ªæ¢é’ˆï¼šæ ¸å¿ƒæ˜¯ "æ•æ·"
      readinessProbe:
        httpGet:
          scheme: HTTPS
          path: /{{apiName}}/{{minorVersion}}/.well-known/health # ğŸ’¡ å»ºè®®ï¼šå°½é‡ä½¿ç”¨è½»é‡æ¥å£
          port: {{port}}
        initialDelaySeconds: 0 # Startup æˆåŠŸåç«‹å³å¼€å§‹
        periodSeconds: 5       # æ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡
        timeoutSeconds: 2      # è¶…æ—¶ 2 ç§’å³è§†ä¸ºä¸€æ¬¡å¤±è´¥
        failureThreshold: 3    # è¿ç»­ 3 æ¬¡å¤±è´¥åˆ™æ‘˜é™¤æµé‡

      # å­˜æ´»æ¢é’ˆï¼šæ ¸å¿ƒæ˜¯ "ç¨³é‡"
      livenessProbe:
        httpGet:
          scheme: HTTPS
          path: /{{apiName}}/{{minorVersion}}/.well-known/health
          port: {{port}}
        initialDelaySeconds: 0

ç»“è®ºï¼šè¿™ä¸ªè®¾ç½®æ˜¯åˆç†çš„ï¼Œèƒ½å¤Ÿæ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µéœ€è¦æ¾„æ¸…ï¼štimeoutSeconds å¹¶ä¸éœ€è¦è¦†ç›–æ•´ä¸ªåº”ç”¨çš„å¯åŠ¨æ—¶é—´ã€‚

ä¸ºä»€ä¹ˆæ˜¯åˆç†çš„ï¼Ÿ
Kubernetes çš„ StartupProbe æ˜¯é€šè¿‡ â€œå¤šæ¬¡é‡è¯•â€ æ¥è¦†ç›–å¯åŠ¨æ—¶é—´çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡â€œå•æ¬¡è¶…é•¿ç­‰å¾…â€ã€‚

è®©æˆ‘ä»¬æ‹†è§£ä¸€ä¸‹æ‚¨çš„åœºæ™¯ï¼š

æ€»çª—å£æœŸ (Total Window)ï¼š
æ‚¨æœ‰ 12æ¬¡æœºä¼š (failureThreshold: 12)ã€‚
æ¯ 10ç§’ è¯•ä¸€æ¬¡ (periodSeconds: 10)ã€‚
è¿™æ„å‘³ç€ï¼šåªè¦æ‚¨çš„åº”ç”¨åœ¨ 120ç§’ (12 * 10s) å†…å¯åŠ¨å®Œæˆï¼Œå°±æ²¡æœ‰é—®é¢˜ã€‚
å•æ¬¡æ¢æµ‹ (Single Probe)ï¼š
timeoutSeconds: 3 æ„å‘³ç€ï¼šKubelet å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œå¦‚æœ 3ç§’å†… æ²¡æ”¶åˆ°å›å¤ï¼Œå°±è®°ä¸º â€œ1æ¬¡å¤±è´¥â€ã€‚
å…³é”®ç‚¹ï¼šå¤±è´¥äº†æ²¡äº‹ï¼æˆ‘ä»¬è¿˜æœ‰ 11 æ¬¡æœºä¼šã€‚
æ¨¡æ‹Ÿåº”ç”¨å¯åŠ¨è¿‡ç¨‹
å‡è®¾æ‚¨çš„åº”ç”¨éœ€è¦ 40ç§’ æ‰èƒ½å¯åŠ¨å®Œæˆã€‚åœ¨è¿™ 40ç§’å†…ï¼Œåº”ç”¨å¯èƒ½å®Œå…¨ä¸å“åº”ç½‘ç»œè¯·æ±‚ï¼ˆæˆ–è€…å“åº”ææ…¢ï¼‰ã€‚è¿™é‡Œçš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š

T=0s: æ¢é’ˆç¬¬ 1 æ¬¡æ¢æµ‹ã€‚åº”ç”¨åœ¨å¿™ç€åŠ è½½å„ç±» Beanï¼Œæ²¡å¤„ç†è¯·æ±‚ã€‚
ç»“æœï¼š3ç§’åè¶…æ—¶ã€‚
è®¡æ•°ï¼šå¤±è´¥ 1 æ¬¡ (è¿˜å‰© 11 æ¬¡)ã€‚
T=10s: æ¢é’ˆç¬¬ 2 æ¬¡æ¢æµ‹ã€‚åº”ç”¨è¿˜åœ¨å¿™ï¼Œç”šè‡³è¿ç«¯å£éƒ½æ²¡ç›‘å¬ã€‚
ç»“æœï¼šConnection Refused (ç¬é—´å¤±è´¥)ã€‚
è®¡æ•°ï¼šå¤±è´¥ 2 æ¬¡ (è¿˜å‰© 10 æ¬¡)ã€‚
T=20s: ...... å¤±è´¥ 3 æ¬¡ã€‚
T=30s: ...... å¤±è´¥ 4 æ¬¡ã€‚
T=40s: åº”ç”¨ç»ˆäºå¯åŠ¨å¥½äº†ï¼ç«¯å£æ‰“å¼€äº†ï¼Œé€»è¾‘åŠ è½½å®Œäº†ã€‚
T=50s: æ¢é’ˆç¬¬ 6 æ¬¡æ¢æµ‹ã€‚
ç»“æœï¼šåº”ç”¨åœ¨ 200ms å†…è¿”å›äº† HTTP 200 OKã€‚
æœ€ç»ˆç»“æœï¼šStartupProbe æˆåŠŸï¼Pod è¢«æ ‡è®°ä¸º Readyï¼Œè¿›å…¥æ­£å¸¸è¿è¡Œã€‚
ä»€ä¹ˆæ—¶å€™ timeoutSeconds: 3 ä¼šæœ‰é—®é¢˜ï¼Ÿ
åªæœ‰ä¸€ç§æƒ…å†µä¼šå¯¼è‡´é—®é¢˜ï¼šæ‚¨çš„åº”ç”¨â€œå·²ç»å¯åŠ¨å¥½äº†â€ï¼Œä½†æ˜¯å“ªæ€•å¤„ç†ä¸€ä¸ªæœ€ç®€å•çš„ /health è¯·æ±‚ï¼Œä¹Ÿéœ€è¦æ­»æ­»å¡ä½è¶…è¿‡ 3ç§’ã€‚

å¦‚æœ /health æ¥å£åªæ˜¯ç®€å•è¿”å› "OK"ï¼Œé€šå¸¸åªéœ€è¦å‡ æ¯«ç§’ã€‚
å¦‚æœ /health æ¥å£é‡Œå†™äº†å¤æ‚çš„æ•°æ®åº“æŸ¥è¯¢ï¼Œå¯¼è‡´æ¯æ¬¡éƒ½è¦æŸ¥ 5ç§’é’Ÿæ•°æ®åº“æ‰èƒ½å›åŒ…ï¼Œé‚£å°±ä¼šæ°¸è¿œè¶…æ—¶ï¼Œå¯¼è‡´ Pod èµ·ä¸æ¥ã€‚
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å»ºè®®ï¼šå¥åº·æ£€æŸ¥æ¥å£ä¸€å®šè¦è½»é‡ã€‚
æ€»ç»“å»ºè®®
FailureThreshold (12æ¬¡)ï¼šè¿™æ˜¯ç»™æ‚¨â€œåŠ è½½ä¸šåŠ¡é€»è¾‘â€çš„æ—¶é—´ï¼ˆ120ç§’ï¼‰ã€‚
TimeoutSeconds (3ç§’)ï¼šè¿™æ˜¯è¦æ±‚æ‚¨çš„å¥åº·æ£€æŸ¥æ¥å£â€œååº”è¦å¿«â€ï¼Œä¸è¦å¡é¡¿ã€‚
æ‰€ä»¥ï¼Œåªè¦æ‚¨çš„åº”ç”¨æœ€ç»ˆèƒ½åœ¨ 120ç§’å†…å¯åŠ¨å®Œæˆï¼Œå¹¶ä¸”å¯åŠ¨åçš„ /health æ¥å£å“åº”é€Ÿåº¦æ­£å¸¸ï¼ˆ<3sï¼‰ï¼Œè¿™ä¸ªé…ç½®å°±æ˜¯å®‰å…¨çš„
```
### 4.2 åœºæ™¯ Bï¼šæ…¢å¯åŠ¨/é‡èµ„æºåº”ç”¨ (å¯åŠ¨è€—æ—¶ > 2åˆ†é’Ÿ)

ä¾‹å¦‚éœ€è¦åŠ è½½å¤§é‡ç¼“å­˜æˆ–æ¨¡å‹çš„ AI æœåŠ¡ã€‚

```yaml
      # å¯åŠ¨æ¢é’ˆï¼šä¸ºæ…¢å¯åŠ¨åº”ç”¨æä¾›æ›´é•¿çš„çª—å£
      startupProbe:
        httpGet:
          scheme: HTTPS
          path: /{{apiName}}/{{minorVersion}}/.well-known/health
          port: {{port}}
        periodSeconds: 10
        timeoutSeconds: 3
        failureThreshold: 30  # æä¾› 10 * 30 = 300s (5åˆ†é’Ÿ) çš„å¯åŠ¨çª—å£
        successThreshold: 1

      # å°±ç»ªæ¢é’ˆå’Œå­˜æ´»æ¢é’ˆé…ç½®ä¸åœºæ™¯ A ç›¸åŒ
      readinessProbe:
        httpGet:
          scheme: HTTPS
          path: /{{apiName}}/{{minorVersion}}/.well-known/health
          port: {{port}}
        initialDelaySeconds: 0
        periodSeconds: 5
        timeoutSeconds: 2
        failureThreshold: 3

      livenessProbe:
        httpGet:
          scheme: HTTPS
          path: /{{apiName}}/{{minorVersion}}/.well-known/health
          port: {{port}}
        initialDelaySeconds: 0
        periodSeconds: 20
        timeoutSeconds: 5
        failureThreshold: 3
```

**å…³é”®ç‚¹**ï¼š
- **å¢åŠ  `failureThreshold`**ï¼ˆä¸æ˜¯ `timeoutSeconds`ï¼‰æ¥å»¶é•¿å¯åŠ¨çª—å£
- åº”ç”¨æ…¢æ˜¯å› ä¸ºåœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸æ˜¯å•æ¬¡ HTTP è¯·æ±‚æ…¢
- HTTP è¯·æ±‚æœ¬èº«åº”è¯¥å¿«é€Ÿè¿”å›ï¼ˆå³ä½¿åœ¨å¯åŠ¨æœŸé—´è¿”å› 503ï¼‰

---

## 5. æ·±åº¦è§£æ (Deep Dive)

### 5.1 æ ¸å¿ƒé‡Šç–‘ï¼šå•æ¬¡è¶…æ—¶(Timeout) vs å¯åŠ¨çª—å£(Window)

å¾ˆå¤šç”¨æˆ·æ‹…å¿ƒï¼š*"æˆ‘çš„åº”ç”¨å¯åŠ¨è¦ 1åˆ†é’Ÿï¼Œä½† `timeoutSeconds` åªæœ‰ 3ç§’ï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ"*

**ç­”æ¡ˆï¼šå®Œå…¨æ²¡é—®é¢˜ã€‚**

Kubernetes çš„ StartupProbe æ˜¯é€šè¿‡ **â€œå¤šæ¬¡é‡è¯•â€** æ¥è¦†ç›–å¯åŠ¨æ—¶é—´çš„ã€‚

*   **FailureThreshold (12æ¬¡) Ã— Period (10s) = 120ç§’**ï¼šè¿™æ˜¯ç»™åº”ç”¨çš„**å¯åŠ¨é¢„ç®—**ã€‚åªè¦åœ¨è¿™ 120ç§’å†…ä»»ä½•æ—¶å€™å¯åŠ¨å®Œæˆï¼Œéƒ½æ˜¯æˆåŠŸçš„ã€‚
*   **TimeoutSeconds (3ç§’)**ï¼šè¿™æ˜¯å¯¹**å¥åº·æ£€æŸ¥æ¥å£å“åº”é€Ÿåº¦**çš„è¦æ±‚ã€‚
    *   åœ¨å¯åŠ¨æœŸé—´ï¼ˆå‰ 119ç§’ï¼‰ï¼ŒProbe è¯·æ±‚è¶…æ—¶æˆ–è¢«æ‹’ç»éƒ½æ²¡å…³ç³»ï¼Œè¿™åªæ¶ˆè€—â€œé‡è¯•æ¬¡æ•°â€ã€‚
    *   ä¸€æ—¦åº”ç”¨å¯åŠ¨å®Œæˆï¼ŒProbe è¯·æ±‚åº”è¯¥åœ¨ 3ç§’å†…è¿…é€Ÿè¿”å›ã€‚å¦‚æœæ‚¨çš„ `/health` æ¥å£é€»è¾‘å¤ªé‡ï¼ˆå¦‚æ‰§è¡Œé•¿è€—æ—¶ SQLï¼‰å¯¼è‡´æ°¸è¿œè¶…è¿‡ 3ç§’ï¼Œæ¢é’ˆæ‰ä¼šæ°¸è¿œå¤±è´¥ã€‚

### 5.2 Java åº”ç”¨çš„æ—¶é—´è´¦å•ï¼šSpring ä¸ APPD

æ‚¨å¯èƒ½ä¼šåœ¨æ—¥å¿—ä¸­çœ‹åˆ°ï¼š
`Root WebApplicationContext: initialization completed in 8000 ms`

**é—®ï¼šè¿™ 8000ms ç®—åœ¨å“ªé‡Œï¼Ÿ**

**ç­”ï¼šè¿™å®Œå…¨å±äºä¸»å®¹å™¨å¯åŠ¨æ—¶é—´ï¼Œå¿…é¡»åŒ…å«åœ¨ `startupProbe` çš„é¢„ç®—å†…ã€‚**

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå…¸å‹çš„ Java + AppDynamics (APPD) åº”ç”¨å¯åŠ¨æ—¶é—´çº¿ï¼š

```mermaid
gantt
    dateFormat  s
    axisFormat  %s
    title Java åº”ç”¨çœŸå®å¯åŠ¨è€—æ—¶åˆ†è§£

    section é˜¶æ®µ
    JVM åˆå§‹åŒ– (ç±»åŠ è½½)      :active, jvm, 0, 5s
    APPD Agent æ³¨å…¥/è¿æ¥     :crit, appd, 5, 15s
    Spring Context Init     :active, spring, 15, 23s
    Tomcat/Undertow å¯åŠ¨     :server, 23, 26s
    åº”ç”¨å®Œå…¨ Ready           :milestone, ready, 26, 0s
```

1.  **JVM Start**: Java è™šæ‹Ÿæœºæœ¬èº«çš„å¯åŠ¨æˆæœ¬ã€‚
2.  **APPD Agent Overhead**: **è¿™æ˜¯å®¹æ˜“è¢«å¿½è§†çš„å¤§å¤´**ã€‚Agent éœ€è¦è¿æ¥ Controllerã€ä¸‹è½½é…ç½®ã€ä¿®æ”¹å­—èŠ‚ç ï¼ˆInstrumentationï¼‰ã€‚è¿™é€šå¸¸ä¼šå¢åŠ  10% - 30% çš„å¯åŠ¨è€—æ—¶ã€‚
3.  **Spring Init (8000ms)**: è¿™æ˜¯æ—¥å¿—é‡Œæ‰“å°çš„æ—¶é—´ï¼Œ**å®ƒåªæ˜¯æ€»è€—æ—¶çš„ä¸€éƒ¨åˆ†**ã€‚
4.  **Web Server Start**: ç«¯å£ç»ˆäºè¢«ç›‘å¬ï¼Œæ­¤æ—¶ Probe æ‰èƒ½è¿ä¸Šã€‚

**ç»“è®º**ï¼š
å¦‚æœæ—¥å¿—æ˜¾ç¤º Spring å¯åŠ¨ç”¨äº† 8ç§’ï¼Œæ‚¨çš„**çœŸå®ç«¯åˆ°ç«¯å¯åŠ¨æ—¶é—´**ï¼ˆä» Pod Created åˆ° Readyï¼‰å¯èƒ½é«˜è¾¾ **20-30ç§’**ã€‚
å› æ­¤ï¼Œé…ç½® `startupProbe` æ—¶ï¼Œ**ä¸è¦åªå‚è€ƒ Spring çš„å¯åŠ¨æ—¥å¿—**ï¼ŒåŠ¡å¿…ä½¿ç”¨ `measure_startup.sh` è„šæœ¬æµ‹é‡çš„**çœŸå®æ€»æ—¶é•¿**ã€‚

---

## 6. å¸¸è§é—®é¢˜è§£ç­” (FAQ)

### Q1: Init Container æ‰§è¡Œæ…¢ä¼šå¯¼è‡´ Probe å¤±è´¥é‡å¯å—ï¼Ÿ
**ä¸ä¼šã€‚**
å¦‚æœæ˜¯ `appd-init-service` å¤åˆ¶æ–‡ä»¶èŠ±äº† 5 åˆ†é’Ÿï¼ŒPod çŠ¶æ€ä¼šä¸€ç›´æ˜¯ `Init:0/1`ã€‚æ­¤æ—¶ä¸»å®¹å™¨è¿˜æ²¡å¯åŠ¨ï¼ŒKubelet ä¸ä¼šæ‰§è¡Œä»»ä½• Probeï¼Œå› æ­¤ä¹Ÿä¸ä¼šè§¦å‘ Probe å¤±è´¥é‡å¯ã€‚
*æ³¨ï¼šå¦‚æœ Init Container å´©æºƒé€€å‡ºï¼Œé‚£æ˜¯ Pod çš„ RestartPolicy æ§åˆ¶çš„ï¼Œä¸ Probe æ— å…³ã€‚*

### Q2: æ—¢ç„¶æœ‰äº† StartupProbeï¼Œè¿˜éœ€è¦ InitialDelaySeconds å—ï¼Ÿ
**åŸºæœ¬ä¸éœ€è¦ã€‚**
åœ¨ Kubernetes v1.18+ å¼•å…¥ `startupProbe` åï¼Œå®ƒå°±æ˜¯ç”¨æ¥æ›¿ä»£â€œé€šè¿‡é¢„ä¼° `initialDelaySeconds` æ¥ç­‰å¾…å¯åŠ¨â€è¿™ç§ç¬¨åŠæ³•çš„ã€‚
æ¨èåšæ³•ï¼š
*   `startupProbe`: é…ç½®è¶³å¤Ÿçš„ FailureThresholdã€‚
*   `liveness/readiness`: `initialDelaySeconds: 0`ã€‚

### Q3: ä¸ºä»€ä¹ˆæˆ‘çš„ Probe æ€»æ˜¯è¶…æ—¶ (Timeout)ï¼Ÿ
æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1.  **èµ„æºé™åˆ¶ (CPU throttling)**: å¯åŠ¨é˜¶æ®µ CPU éœ€æ±‚å¤§ï¼Œå¦‚æœ `resources.limits.cpu` è®¾ç½®è¿‡å°ï¼Œåº”ç”¨å“åº”ææ…¢ã€‚
2.  **ä¾èµ–çº§è”**: å¥åº·æ£€æŸ¥æ¥å£æ˜¯å¦å»è¿äº†æ•°æ®åº“ï¼Ÿå¦‚æœæ•°æ®åº“æ…¢ï¼Œæ¢é’ˆå°±æ…¢ã€‚æ¨èå¥åº·æ£€æŸ¥**ä»…æ£€æŸ¥åº”ç”¨æœ¬èº«çŠ¶æ€**ï¼Œæˆ–è€…ç”¨ç‹¬ç«‹çš„ `/ready` æ¥å£æ£€æŸ¥ä¾èµ–ï¼Œ`/live` æ¥å£ä»…æ£€æŸ¥è¿›ç¨‹ã€‚

### Q4: å¦‚ä½•å¤„ç† "é…ç½®åŠ è½½" å¯¹å¯åŠ¨çš„å½±å“ï¼Ÿ
å¦‚æœåº”ç”¨éœ€è¦æ‹‰å–è¿œç¨‹é…ç½®ï¼ˆå¦‚ Spring Cloud Configï¼‰ï¼Œè¿™å±äºâ€œä¸šåŠ¡å¯åŠ¨é€»è¾‘â€ã€‚
**ç­–ç•¥**ï¼šè¿™ä¼šè®¡å…¥ StartupProbe çš„æ—¶é—´ã€‚å› æ­¤éœ€è¦æµ‹é‡è¿™ä¸€æ®µè€—æ—¶ï¼Œå¹¶åŒ…å«åœ¨ StartupProbe çš„ `failureThreshold` ç¼“å†²ä¸­ã€‚

---

## 7. æ€»ç»“ï¼šå¹³å°åŒ–å»ºè®®

å¦‚æœæ‚¨è¦ä¸ºç”¨æˆ·æä¾›è‡ªåŠ©é…ç½®ï¼Œå»ºè®®éµå¾ªä»¥ä¸‹æµç¨‹ï¼š

1.  **Default (é»˜è®¤å€¼)**:
    *   Startup: 120s (10s * 12) â€”â€” è¦†ç›–ç»å¤§å¤šæ•°åº”ç”¨ã€‚
    *   Liveness: 3æ¬¡ * 20s â€”â€” è¶³å¤Ÿå®½å®¹ã€‚
2.  **Override (è‡ªå®šä¹‰)**:
    *   å…è®¸ç”¨æˆ·è¦†ç›– `failureThreshold`ï¼ˆé’ˆå¯¹æ…¢å¯åŠ¨åº”ç”¨ï¼‰ã€‚
    *   å…è®¸ç”¨æˆ·è¦†ç›– `path`ï¼ˆé’ˆå¯¹è‡ªå®šä¹‰å¥åº·æ£€æŸ¥è·¯å¾„ï¼‰ã€‚
3.  **Validate (æ ¡éªŒ)**:
    *   ç¦æ­¢ç”¨æˆ·å°† `timeoutSeconds` è®¾å¾—è¿‡å¤§ï¼ˆå¦‚ >10sï¼‰ï¼Œè¿™ä¼šæ©ç›–ç³»ç»Ÿæ€§èƒ½é—®é¢˜ã€‚

---

## 8. å¯è§†åŒ–ï¼šæ¢é’ˆå®Œæ•´å·¥ä½œæµç¨‹

### 8.1 Pod å¯åŠ¨å…¨æµç¨‹å›¾ï¼ˆå¸¦æ¢é’ˆçŠ¶æ€ï¼‰

```mermaid
stateDiagram-v2
    [*] --> PodCreated: kubectl apply
    
    PodCreated --> InitRunning: è°ƒåº¦åˆ°èŠ‚ç‚¹
    note right of InitRunning
        Init Container æ‰§è¡Œ
        (appd-init-service)
        æ¢é’ˆå°šæœªå¯åŠ¨ â¸ï¸
    end note
    
    InitRunning --> MainContainerStarting: Init å®Œæˆ
    
    MainContainerStarting --> StartupProbeActive: ä¸»å®¹å™¨åˆ›å»º
    note right of StartupProbeActive
        StartupProbe å¼€å§‹å·¥ä½œ ğŸ”
        periodSeconds: 10s
        timeoutSeconds: 3s
        failureThreshold: 12
    end note
    
    state StartupProbeActive {
        [*] --> ProbeAttempt
        ProbeAttempt --> ProbeFailed: è¿æ¥æ‹’ç»/è¶…æ—¶/é200
        ProbeFailed --> CheckFailureCount
        CheckFailureCount --> ProbeAttempt: å¤±è´¥æ¬¡æ•° < 12<br/>ç­‰å¾… 10 ç§’
        CheckFailureCount --> ContainerKilled: å¤±è´¥æ¬¡æ•° = 12
        ProbeAttempt --> ProbeSuccess: HTTP 200 OK
    }
    
    StartupProbeActive --> ReadinessProbeActive: StartupProbe æˆåŠŸ âœ…
    note right of ReadinessProbeActive
        ReadinessProbe æ¥ç®¡ ğŸš¦
        å¿«é€Ÿæ£€æµ‹æµé‡å°±ç»ªçŠ¶æ€
        periodSeconds: 5s
    end note
    
    StartupProbeActive --> ContainerKilled: StartupProbe å¤±è´¥ 12 æ¬¡
    ContainerKilled --> [*]: Pod é‡å¯
    
    state ReadinessProbeActive {
        state fork_state <<fork>>
        [*] --> fork_state
        fork_state --> ReadinessCheck
        fork_state --> LivenessCheck
        
        ReadinessCheck --> Ready: HTTP 200
        ReadinessCheck --> NotReady: å¤±è´¥
        Ready --> InService: åŠ å…¥ Service Endpoints
        NotReady --> OutOfService: ç§»å‡º Service Endpoints
        
        LivenessCheck --> Alive: HTTP 200
        LivenessCheck --> DeadlockDetected: è¿ç»­å¤±è´¥
        DeadlockDetected --> RestartContainer: é‡å¯å®¹å™¨
    }
    
    ReadinessProbeActive --> [*]: Pod åˆ é™¤
```

### 8.2 æ¢é’ˆæ—¶åºäº¤äº’å›¾ï¼ˆ80ç§’å¯åŠ¨åœºæ™¯ï¼‰

```mermaid
sequenceDiagram
    autonumber
    participant K as Kubelet
    participant C as Container
    participant A as Application
    participant H as /health Endpoint
    
    rect rgb(240, 240, 240)
        Note over K,H: é˜¶æ®µ 1: Init Container (ä¸è®¡å…¥æ¢é’ˆæ—¶é—´)
        K->>C: å¯åŠ¨ Init Container
        C->>C: å¤åˆ¶ APPD Agent æ–‡ä»¶
        C-->>K: Init å®Œæˆ
    end
    
    rect rgb(255, 240, 240)
        Note over K,H: é˜¶æ®µ 2: ä¸»å®¹å™¨å¯åŠ¨ + StartupProbe æ¢æµ‹
        K->>C: å¯åŠ¨ä¸»å®¹å™¨
        C->>A: å¯åŠ¨ Java è¿›ç¨‹
        
        Note over K: T=0s: æ¢æµ‹ #1
        K->>H: GET /health (HTTPS)
        H--xK: Connection Refused âŒ
        Note over K: å¤±è´¥è®¡æ•°: 1/12
        
        Note over A: åŠ è½½ JVM + Spring Context
        
        Note over K: T=10s: æ¢æµ‹ #2
        K->>H: GET /health
        H--xK: Connection Refused âŒ
        Note over K: å¤±è´¥è®¡æ•°: 2/12
        
        Note over A: åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± 
        
        Note over K: T=20s: æ¢æµ‹ #3
        K->>H: GET /health
        H--xK: Connection Refused âŒ
        Note over K: å¤±è´¥è®¡æ•°: 3/12
        
        Note over A: åŠ è½½ APPD Agent
        
        Note over K: T=30s: æ¢æµ‹ #4
        K->>H: GET /health
        H--xK: Connection Refused âŒ
        Note over K: å¤±è´¥è®¡æ•°: 4/12
        
        Note over A: ç«¯å£å¼€å§‹ç›‘å¬
        
        Note over K: T=40s: æ¢æµ‹ #5
        K->>H: GET /health
        H-->>K: HTTP 503 (50ms) âš ï¸
        Note over K: å¤±è´¥è®¡æ•°: 5/12
        
        Note over A: é¢„çƒ­ç¼“å­˜
        
        Note over K: T=50s: æ¢æµ‹ #6
        K->>H: GET /health
        H-->>K: HTTP 503 (80ms) âš ï¸
        Note over K: å¤±è´¥è®¡æ•°: 6/12
        
        Note over K: T=60s: æ¢æµ‹ #7
        K->>H: GET /health
        H-->>K: HTTP 503 (120ms) âš ï¸
        Note over K: å¤±è´¥è®¡æ•°: 7/12
        
        Note over K: T=70s: æ¢æµ‹ #8
        K->>H: GET /health
        H-->>K: HTTP 503 (200ms) âš ï¸
        Note over K: å¤±è´¥è®¡æ•°: 8/12
        
        Note over A: åº”ç”¨å®Œå…¨å°±ç»ªï¼
        
        Note over K: T=80s: æ¢æµ‹ #9
        K->>H: GET /health
        H-->>K: HTTP 200 OK (150ms) âœ…
        Note over K: StartupProbe æˆåŠŸï¼
    end
    
    rect rgb(240, 255, 240)
        Note over K,H: é˜¶æ®µ 3: ReadinessProbe + LivenessProbe æ¥ç®¡
        K->>K: Pod æ ‡è®°ä¸º Ready
        K->>H: ReadinessProbe (æ¯ 5s)
        H-->>K: HTTP 200 âœ…
        Note over K: åŠ å…¥ Service Endpoints
        
        K->>H: LivenessProbe (æ¯ 20s)
        H-->>K: HTTP 200 âœ…
        Note over K: å®¹å™¨å¥åº·è¿è¡Œ
    end
```

### 8.3 æ¢é’ˆå†³ç­–æ ‘ï¼ˆæ•…éšœæ’æŸ¥æŒ‡å—ï¼‰

```mermaid
graph TD
    Start([Pod æ— æ³•å¯åŠ¨?]) --> CheckStatus{æ£€æŸ¥ Pod çŠ¶æ€}
    
    CheckStatus -->|Init:0/1| InitIssue[Init Container é—®é¢˜]
    InitIssue --> InitSolution[æ£€æŸ¥ Init æ—¥å¿—<br/>ä¸æ¢é’ˆæ— å…³]
    
    CheckStatus -->|CrashLoopBackOff| CrashIssue{æ£€æŸ¥é‡å¯åŸå› }
    CrashIssue -->|StartupProbe failed| StartupFail[StartupProbe å¤±è´¥]
    CrashIssue -->|LivenessProbe failed| LivenessFail[LivenessProbe å¤±è´¥]
    CrashIssue -->|Application crash| AppCrash[åº”ç”¨è‡ªèº«å´©æºƒ]
    
    StartupFail --> CheckStartupTime{åº”ç”¨å¯åŠ¨æ—¶é—´?}
    CheckStartupTime -->|> 120s| IncreaseFT[å¢åŠ  failureThreshold<br/>ä¾‹å¦‚: 18 æˆ– 30]
    CheckStartupTime -->|< 120s| CheckHealthEndpoint{/health å“åº”æ—¶é—´?}
    
    CheckHealthEndpoint -->|> 3s| OptimizeHealth[ä¼˜åŒ– /health æ¥å£<br/>ç§»é™¤é‡é€»è¾‘]
    CheckHealthEndpoint -->|< 3s| CheckResources{æ£€æŸ¥èµ„æºé™åˆ¶}
    
    CheckResources -->|CPU throttling| IncreaseResources[å¢åŠ  CPU limits<br/>æˆ–ä½¿ç”¨ burstable]
    CheckResources -->|æ­£å¸¸| CheckDependency[æ£€æŸ¥ä¾èµ–æœåŠ¡<br/>æ•°æ®åº“/Redisç­‰]
    
    LivenessFail --> CheckLivenessConfig{LivenessProbe é…ç½®}
    CheckLivenessConfig -->|failureThreshold å¤ªå°| IncreaseLiveness[å¢åŠ  failureThreshold<br/>å»ºè®®: 3-5]
    CheckLivenessConfig -->|periodSeconds å¤ªçŸ­| IncreasePeriod[å¢åŠ  periodSeconds<br/>å»ºè®®: 10-20s]
    
    CheckStatus -->|Running ä½†æ— æµé‡| ReadinessIssue[ReadinessProbe å¤±è´¥]
    ReadinessIssue --> CheckEndpoints{æ£€æŸ¥ Service Endpoints}
    CheckEndpoints -->|Pod IP ä¸åœ¨åˆ—è¡¨| ReadinessFailing[ReadinessProbe æŒç»­å¤±è´¥]
    ReadinessFailing --> CheckReadinessHealth[æ£€æŸ¥ /health æ¥å£<br/>æ˜¯å¦è¿”å› 200]
    
    style Start fill:#e1f5ff
    style InitIssue fill:#fff3cd
    style StartupFail fill:#f8d7da
    style LivenessFail fill:#f8d7da
    style ReadinessIssue fill:#fff3cd
    style IncreaseFT fill:#d4edda
    style OptimizeHealth fill:#d4edda
    style IncreaseResources fill:#d4edda
```

### 8.4 ä¸‰ç§æ¢é’ˆå¯¹æ¯”å¯è§†åŒ–

```mermaid
gantt
    title æ¢é’ˆç”Ÿå‘½å‘¨æœŸä¸èŒè´£åˆ†å·¥
    dateFormat s
    axisFormat %Ss
    
    section Init é˜¶æ®µ
    Init Container æ‰§è¡Œ :crit, init, 0, 15s
    æ¢é’ˆæœªå¯åŠ¨ :milestone, 15, 0s
    
    section StartupProbe
    ä¿æŠ¤å¯åŠ¨çª—å£ (0-120s) :active, startup, 15, 135s
    æ¢æµ‹ #1 (å¤±è´¥) :milestone, 15, 0s
    æ¢æµ‹ #2 (å¤±è´¥) :milestone, 25, 0s
    æ¢æµ‹ #3 (å¤±è´¥) :milestone, 35, 0s
    æ¢æµ‹ #4 (å¤±è´¥) :milestone, 45, 0s
    æ¢æµ‹ #5 (å¤±è´¥) :milestone, 55, 0s
    æ¢æµ‹ #6 (å¤±è´¥) :milestone, 65, 0s
    æ¢æµ‹ #7 (å¤±è´¥) :milestone, 75, 0s
    æ¢æµ‹ #8 (å¤±è´¥) :milestone, 85, 0s
    æ¢æµ‹ #9 (æˆåŠŸ) :milestone, 95, 0s
    
    section ReadinessProbe
    æµé‡æ§åˆ¶ (å¿«é€Ÿå“åº”) :done, readiness, 95, 200s
    æ¯ 5s æ£€æŸ¥ä¸€æ¬¡ :milestone, 95, 0s
    
    section LivenessProbe
    æ­»é”æ£€æµ‹ (ä¿å®ˆç­–ç•¥) :done, liveness, 95, 200s
    æ¯ 20s æ£€æŸ¥ä¸€æ¬¡ :milestone, 95, 0s
```

---

## 9. é™„å½•ï¼šStartupProbe è¯¦ç»†æ—¶åºåˆ†æ

### 9.1 æ¢é’ˆå¤±è´¥åœºæ™¯è¯¦ç»†æ‹†è§£ï¼ˆåŸºäºæ‚¨çš„é…ç½®ï¼‰

è®©æˆ‘ä»¬ç”¨æ‚¨çš„å®é™…é…ç½®æ¥æ‹†è§£ StartupProbe çš„å·¥ä½œæœºåˆ¶ï¼š

**é…ç½®å‚æ•°**ï¼š
```yaml
startupProbe:
  httpGet:
    scheme: HTTPS
    path: /{{apiName}}/{{minorVersion}}/.well-known/health
    port: {{port}}
  periodSeconds: 10        # æ¯ 10 ç§’æ¢æµ‹ä¸€æ¬¡ï¼ˆä»ä¸Šæ¬¡æ¢æµ‹å¼€å§‹è®¡æ—¶ï¼‰
  timeoutSeconds: 3        # å•æ¬¡æ¢æµ‹è¶…æ—¶æ—¶é—´ 3 ç§’
  failureThreshold: 12     # å…è®¸å¤±è´¥ 12 æ¬¡
  successThreshold: 1      # æˆåŠŸ 1 æ¬¡å³é€šè¿‡
```

**æ€»å¯åŠ¨çª—å£ = 10s Ã— 12 = 120ç§’**

**é‡è¦æ¦‚å¿µ**ï¼š
- `periodSeconds: 10` è¡¨ç¤ºä»**æœ¬æ¬¡æ¢æµ‹å¼€å§‹**åˆ°**ä¸‹æ¬¡æ¢æµ‹å¼€å§‹**çš„é—´éš”æ˜¯ 10 ç§’
- å¦‚æœæ¢æµ‹åœ¨ 3 ç§’å†…å®Œæˆï¼ˆæˆåŠŸæˆ–è¶…æ—¶ï¼‰ï¼Œå®é™…ç­‰å¾…æ—¶é—´çº¦ä¸º 7 ç§’
- å¦‚æœæ¢æµ‹ç¬é—´å¤±è´¥ï¼ˆå¦‚è¿æ¥è¢«æ‹’ç»ï¼‰ï¼Œå®é™…ç­‰å¾…æ—¶é—´çº¦ä¸º 10 ç§’

---

### 9.2 åœºæ™¯ Aï¼šæ­£å¸¸å¯åŠ¨ï¼ˆåº”ç”¨è€—æ—¶ 80 ç§’ï¼‰

å‡è®¾æ‚¨çš„åº”ç”¨éœ€è¦ 80 ç§’æ‰èƒ½å®Œå…¨å¯åŠ¨å¹¶å“åº”å¥åº·æ£€æŸ¥ã€‚

**å…³é”®ç†è§£**ï¼š`periodSeconds: 10` æ˜¯æŒ‡ä»**ä¸Šä¸€æ¬¡æ¢æµ‹å¼€å§‹**åˆ°**ä¸‹ä¸€æ¬¡æ¢æµ‹å¼€å§‹**çš„é—´éš”ï¼Œä¸æ˜¯ä»ä¸Šä¸€æ¬¡æ¢æµ‹ç»“æŸå¼€å§‹è®¡æ—¶ã€‚

#### è¯¦ç»†æ—¶é—´çº¿ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’çº§ï¼‰

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¢æµ‹æ¬¡æ•° #1
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T = 0.000s:  æ¢æµ‹å¼€å§‹
             â”œâ”€ Kubelet å‘èµ· HTTPS è¯·æ±‚åˆ° /health
             â”œâ”€ åº”ç”¨æœªå¯åŠ¨ï¼Œç«¯å£æœªç›‘å¬
T = 0.001s:  â”œâ”€ è¿æ¥è¢«æ‹’ç»ï¼ˆConnection Refusedï¼Œå‡ ä¹ç¬é—´å¤±è´¥ï¼‰
             â””â”€ å¤±è´¥è®¡æ•°: 1/12
             
ã€ç´¯ç§¯è€—æ—¶ã€‘ä»å®¹å™¨å¯åŠ¨åˆ°ç°åœ¨ï¼š0.001 ç§’
ã€ä¸‹æ¬¡æ¢æµ‹ã€‘T = 0sï¼ˆæœ¬æ¬¡å¼€å§‹ï¼‰ + 10sï¼ˆperiodSecondsï¼‰ = 10s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¢æµ‹æ¬¡æ•° #2
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T = 10.000s: æ¢æµ‹å¼€å§‹ï¼ˆè·ç¦»ç¬¬ 1 æ¬¡æ¢æµ‹å¼€å§‹æ­£å¥½ 10 ç§’ï¼‰
             â”œâ”€ åº”ç”¨ä»åœ¨åŠ è½½ Spring Context
             â”œâ”€ ç«¯å£æœªç›‘å¬
T = 10.001s: â”œâ”€ è¿æ¥è¢«æ‹’ç»
             â””â”€ å¤±è´¥è®¡æ•°: 2/12
             
ã€ç´¯ç§¯è€—æ—¶ã€‘ä»å®¹å™¨å¯åŠ¨åˆ°ç°åœ¨ï¼š10.001 ç§’
ã€ä¸‹æ¬¡æ¢æµ‹ã€‘T = 10s + 10s = 20s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¢æµ‹æ¬¡æ•° #3
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T = 20.000s: æ¢æµ‹å¼€å§‹
             â”œâ”€ åº”ç”¨æ­£åœ¨åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± 
T = 20.001s: â”œâ”€ è¿æ¥è¢«æ‹’ç»
             â””â”€ å¤±è´¥è®¡æ•°: 3/12
             
ã€ç´¯ç§¯è€—æ—¶ã€‘ä»å®¹å™¨å¯åŠ¨åˆ°ç°åœ¨ï¼š20.001 ç§’
ã€ä¸‹æ¬¡æ¢æµ‹ã€‘T = 20s + 10s = 30s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¢æµ‹æ¬¡æ•° #4
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T = 30.000s: æ¢æµ‹å¼€å§‹
             â”œâ”€ åº”ç”¨æ­£åœ¨åŠ è½½ APPD Agent
T = 30.001s: â”œâ”€ è¿æ¥è¢«æ‹’ç»
             â””â”€ å¤±è´¥è®¡æ•°: 4/12
             
ã€ç´¯ç§¯è€—æ—¶ã€‘ä»å®¹å™¨å¯åŠ¨åˆ°ç°åœ¨ï¼š30.001 ç§’
ã€ä¸‹æ¬¡æ¢æµ‹ã€‘T = 30s + 10s = 40s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¢æµ‹æ¬¡æ•° #5
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T = 40.000s: æ¢æµ‹å¼€å§‹
             â”œâ”€ åº”ç”¨ç«¯å£åˆšåˆšæ‰“å¼€ï¼Œä½†ä¸šåŠ¡é€»è¾‘æœªå°±ç»ª
             â”œâ”€ è¿æ¥æˆåŠŸï¼Kubelet å‘é€ HTTP GET è¯·æ±‚
T = 40.050s: â”œâ”€ åº”ç”¨è¿”å› 503 Service Unavailableï¼ˆå“åº”è€—æ—¶ 50msï¼‰
             â””â”€ å¤±è´¥è®¡æ•°: 5/12  âš ï¸ æ³¨æ„ï¼šå³ä½¿å“åº”å¿«ï¼Œè¿”å›é 200 ä¹Ÿç®—å¤±è´¥
             
ã€ç´¯ç§¯è€—æ—¶ã€‘ä»å®¹å™¨å¯åŠ¨åˆ°ç°åœ¨ï¼š40.050 ç§’
ã€ä¸‹æ¬¡æ¢æµ‹ã€‘T = 40s + 10s = 50s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¢æµ‹æ¬¡æ•° #6
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T = 50.000s: æ¢æµ‹å¼€å§‹
             â”œâ”€ åº”ç”¨ä»åœ¨é¢„çƒ­ç¼“å­˜
T = 50.080s: â”œâ”€ åº”ç”¨è¿”å› 503ï¼ˆå“åº”è€—æ—¶ 80msï¼‰
             â””â”€ å¤±è´¥è®¡æ•°: 6/12
             
ã€ç´¯ç§¯è€—æ—¶ã€‘ä»å®¹å™¨å¯åŠ¨åˆ°ç°åœ¨ï¼š50.080 ç§’
ã€ä¸‹æ¬¡æ¢æµ‹ã€‘T = 50s + 10s = 60s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¢æµ‹æ¬¡æ•° #7
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T = 60.000s: æ¢æµ‹å¼€å§‹
             â”œâ”€ åº”ç”¨ä»åœ¨åŠ è½½é…ç½®
T = 60.120s: â”œâ”€ åº”ç”¨è¿”å› 503ï¼ˆå“åº”è€—æ—¶ 120msï¼‰
             â””â”€ å¤±è´¥è®¡æ•°: 7/12
             
ã€ç´¯ç§¯è€—æ—¶ã€‘ä»å®¹å™¨å¯åŠ¨åˆ°ç°åœ¨ï¼š60.120 ç§’
ã€ä¸‹æ¬¡æ¢æµ‹ã€‘T = 60s + 10s = 70s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¢æµ‹æ¬¡æ•° #8
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T = 70.000s: æ¢æµ‹å¼€å§‹
             â”œâ”€ åº”ç”¨å‡ ä¹å°±ç»ª
T = 70.200s: â”œâ”€ åº”ç”¨è¿”å› 503ï¼ˆå“åº”è€—æ—¶ 200msï¼‰
             â””â”€ å¤±è´¥è®¡æ•°: 8/12
             
ã€ç´¯ç§¯è€—æ—¶ã€‘ä»å®¹å™¨å¯åŠ¨åˆ°ç°åœ¨ï¼š70.200 ç§’
ã€ä¸‹æ¬¡æ¢æµ‹ã€‘T = 70s + 10s = 80s

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¢æµ‹æ¬¡æ•° #9 âœ… æˆåŠŸï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
T = 80.000s: æ¢æµ‹å¼€å§‹
             â”œâ”€ åº”ç”¨åˆšåˆšå®Œå…¨å¯åŠ¨ï¼ï¼ˆç«¯å£ç›‘å¬ + ä¸šåŠ¡é€»è¾‘å°±ç»ªï¼‰
             â”œâ”€ Kubelet å‘èµ· HTTPS è¯·æ±‚
T = 80.150s: â”œâ”€ åº”ç”¨è¿”å› HTTP 200 OKï¼ˆå“åº”è€—æ—¶ 150msï¼‰
             â””â”€ âœ… æ¢é’ˆæˆåŠŸï¼successThreshold = 1ï¼Œç«‹å³é€šè¿‡
             
ã€ç´¯ç§¯è€—æ—¶ã€‘ä»å®¹å™¨å¯åŠ¨åˆ°ç°åœ¨ï¼š80.150 ç§’
ã€Pod çŠ¶æ€ã€‘è¿›å…¥ Ready çŠ¶æ€ï¼Œå¼€å§‹æ¥æ”¶æµé‡
```

#### å…³é”®æ—¶é—´èŠ‚ç‚¹æ€»ç»“

| æ¢æµ‹æ¬¡æ•° | å¼€å§‹æ—¶é—´ | ç»“æŸæ—¶é—´ | æ¢æµ‹è€—æ—¶ | ç´¯ç§¯æ€»è€—æ—¶ | ç»“æœ | å¤±è´¥è®¡æ•° |
|---------|---------|---------|---------|-----------|------|---------|
| #1 | 0.000s | 0.001s | 0.001s | 0.001s | è¿æ¥è¢«æ‹’ç» | 1/12 |
| #2 | 10.000s | 10.001s | 0.001s | 10.001s | è¿æ¥è¢«æ‹’ç» | 2/12 |
| #3 | 20.000s | 20.001s | 0.001s | 20.001s | è¿æ¥è¢«æ‹’ç» | 3/12 |
| #4 | 30.000s | 30.001s | 0.001s | 30.001s | è¿æ¥è¢«æ‹’ç» | 4/12 |
| #5 | 40.000s | 40.050s | 0.050s | 40.050s | HTTP 503 | 5/12 |
| #6 | 50.000s | 50.080s | 0.080s | 50.080s | HTTP 503 | 6/12 |
| #7 | 60.000s | 60.120s | 0.120s | 60.120s | HTTP 503 | 7/12 |
| #8 | 70.000s | 70.200s | 0.200s | 70.200s | HTTP 503 | 8/12 |
| #9 | 80.000s | 80.150s | 0.150s | **80.150s** | âœ… HTTP 200 | æˆåŠŸ |

#### æ ¸å¿ƒç†è§£

1. **periodSeconds = 10** çš„å«ä¹‰ï¼š
   - ç¬¬ 1 æ¬¡æ¢æµ‹åœ¨ T=0s **å¼€å§‹**
   - ç¬¬ 2 æ¬¡æ¢æµ‹åœ¨ T=10s **å¼€å§‹**ï¼ˆä¸ç®¡ç¬¬ 1 æ¬¡ä»€ä¹ˆæ—¶å€™ç»“æŸï¼‰
   - ç¬¬ 3 æ¬¡æ¢æµ‹åœ¨ T=20s **å¼€å§‹**
   - ä»¥æ­¤ç±»æ¨...

2. **æ¢æµ‹è€—æ—¶ä¸å½±å“ä¸‹æ¬¡æ¢æµ‹æ—¶é—´**ï¼š
   - å³ä½¿ç¬¬ 5 æ¬¡æ¢æµ‹è€—æ—¶ 50msï¼Œç¬¬ 6 æ¬¡ä»ç„¶åœ¨ T=50s å¼€å§‹
   - å³ä½¿ç¬¬ 1 æ¬¡æ¢æµ‹ç¬é—´å¤±è´¥ï¼ˆ1msï¼‰ï¼Œç¬¬ 2 æ¬¡ä»ç„¶åœ¨ T=10s å¼€å§‹

3. **ç´¯ç§¯æ€»è€—æ—¶ = æœ€åä¸€æ¬¡æ¢æµ‹ç»“æŸçš„æ—¶é—´**ï¼š
   - åº”ç”¨åœ¨ 80.150 ç§’å®Œæˆæ•´ä¸ªå¯åŠ¨è¿‡ç¨‹
   - å¤±è´¥äº† 8 æ¬¡ï¼Œè¿˜å‰© 4 æ¬¡æœºä¼šï¼ˆ12 - 8 = 4ï¼‰

**ç»“è®º**ï¼šåº”ç”¨åœ¨ 80 ç§’å¯åŠ¨å®Œæˆï¼Œæ¢é’ˆåœ¨ç¬¬ 9 æ¬¡ï¼ˆT=80s å¼€å§‹ï¼ŒT=80.150s æˆåŠŸï¼‰é€šè¿‡ï¼Œè¿œæœªè¾¾åˆ° 12 æ¬¡å¤±è´¥é˜ˆå€¼ã€‚é…ç½®å®‰å…¨ã€‚

---

### 9.3 åœºæ™¯ Bï¼šå¥åº·æ£€æŸ¥æ¥å£å“åº”æ…¢ï¼ˆè¶…æ—¶é™·é˜±ï¼‰

å‡è®¾åº”ç”¨åœ¨ 30 ç§’å°±å¯åŠ¨å®Œæˆäº†ï¼Œä½† `/health` æ¥å£é€»è¾‘å¤ªé‡ï¼ˆä¾‹å¦‚æŸ¥è¯¢æ•°æ®åº“ã€è°ƒç”¨ä¸‹æ¸¸æœåŠ¡ï¼‰ï¼Œå¯¼è‡´æ¯æ¬¡å“åº”éƒ½éœ€è¦ 5 ç§’ã€‚

```
T = 0s:  æ¢é’ˆç¬¬ 1 æ¬¡æ¢æµ‹å¼€å§‹
         â”œâ”€ åº”ç”¨æœªå¯åŠ¨ï¼Œè¿æ¥è¢«æ‹’ç»ï¼ˆç¬é—´å¤±è´¥ï¼‰
         â””â”€ å¤±è´¥è®¡æ•°: 1/12

T = 10s: æ¢é’ˆç¬¬ 2 æ¬¡æ¢æµ‹å¼€å§‹
         â”œâ”€ åº”ç”¨æœªå¯åŠ¨ï¼Œè¿æ¥è¢«æ‹’ç»
         â””â”€ å¤±è´¥è®¡æ•°: 2/12

T = 20s: æ¢é’ˆç¬¬ 3 æ¬¡æ¢æµ‹å¼€å§‹
         â”œâ”€ åº”ç”¨æœªå¯åŠ¨ï¼Œè¿æ¥è¢«æ‹’ç»
         â””â”€ å¤±è´¥è®¡æ•°: 3/12

T = 30s: æ¢é’ˆç¬¬ 4 æ¬¡æ¢æµ‹å¼€å§‹
         â”œâ”€ åº”ç”¨åˆšåˆšå¯åŠ¨å®Œæˆï¼ï¼ˆä½† /health æ¥å£é€»è¾‘å¤ªé‡ï¼‰
         â”œâ”€ Kubelet å‘èµ·è¯·æ±‚
         â”œâ”€ åº”ç”¨å¼€å§‹å¤„ç† /health è¯·æ±‚ï¼ˆæŸ¥è¯¢æ•°æ®åº“...ï¼‰
         â”œâ”€ T = 33s: Kubelet ç­‰å¾… 3 ç§’åè¶…æ—¶æ–­å¼€è¿æ¥
         â”œâ”€ åº”ç”¨åœ¨ T = 35s æ‰è¿”å› 200ï¼ˆä½† Kubelet å·²ç»æ”¾å¼ƒäº†ï¼‰
         â””â”€ å¤±è´¥è®¡æ•°: 4/12  âš ï¸ è¶…æ—¶è§†ä¸ºå¤±è´¥

T = 40s: æ¢é’ˆç¬¬ 5 æ¬¡æ¢æµ‹å¼€å§‹
         â”œâ”€ åŒæ ·çš„é—®é¢˜ï¼šåº”ç”¨éœ€è¦ 5 ç§’å¤„ç†
         â”œâ”€ T = 43s: Kubelet åœ¨ 3 ç§’åè¶…æ—¶
         â””â”€ å¤±è´¥è®¡æ•°: 5/12

T = 50s: æ¢é’ˆç¬¬ 6 æ¬¡æ¢æµ‹å¼€å§‹ -> T = 53s è¶…æ—¶ -> å¤±è´¥è®¡æ•°: 6/12
T = 60s: æ¢é’ˆç¬¬ 7 æ¬¡æ¢æµ‹å¼€å§‹ -> T = 63s è¶…æ—¶ -> å¤±è´¥è®¡æ•°: 7/12
T = 70s: æ¢é’ˆç¬¬ 8 æ¬¡æ¢æµ‹å¼€å§‹ -> T = 73s è¶…æ—¶ -> å¤±è´¥è®¡æ•°: 8/12
T = 80s: æ¢é’ˆç¬¬ 9 æ¬¡æ¢æµ‹å¼€å§‹ -> T = 83s è¶…æ—¶ -> å¤±è´¥è®¡æ•°: 9/12
T = 90s: æ¢é’ˆç¬¬ 10 æ¬¡æ¢æµ‹å¼€å§‹ -> T = 93s è¶…æ—¶ -> å¤±è´¥è®¡æ•°: 10/12
T = 100s: æ¢é’ˆç¬¬ 11 æ¬¡æ¢æµ‹å¼€å§‹ -> T = 103s è¶…æ—¶ -> å¤±è´¥è®¡æ•°: 11/12
T = 110s: æ¢é’ˆç¬¬ 12 æ¬¡æ¢æµ‹å¼€å§‹ -> T = 113s è¶…æ—¶ -> å¤±è´¥è®¡æ•°: 12/12

T = 113s: âŒ failureThreshold è¾¾åˆ° 12ï¼Œå®¹å™¨è¢« Kill å¹¶é‡å¯
```

**ç»“è®º**ï¼šåº”ç”¨æ˜æ˜åœ¨ 30 ç§’å°±å¯åŠ¨å¥½äº†ï¼Œä½†å› ä¸ºå¥åº·æ£€æŸ¥æ¥å£å“åº”å¤ªæ…¢ï¼ˆ>3ç§’ï¼‰ï¼Œå¯¼è‡´æ¢é’ˆæ°¸è¿œè¶…æ—¶ï¼Œæœ€ç»ˆåœ¨ T=113s è§¦å‘é‡å¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ `/health` æ¥å£å¿…é¡»è½»é‡ã€‚

---

### 9.4 åœºæ™¯ Cï¼šé…ç½®ä¸è¶³ï¼ˆfailureThreshold å¤ªå°ï¼‰

å‡è®¾æ‚¨é”™è¯¯åœ°é…ç½®äº† `failureThreshold: 5`ï¼ˆè€Œä¸æ˜¯ 12ï¼‰ï¼Œåº”ç”¨å¯åŠ¨éœ€è¦ 80 ç§’ã€‚

```
T = 0s:  æ¢é’ˆç¬¬ 1 æ¬¡æ¢æµ‹å¼€å§‹ -> è¿æ¥è¢«æ‹’ç» -> å¤±è´¥è®¡æ•°: 1/5
T = 10s: æ¢é’ˆç¬¬ 2 æ¬¡æ¢æµ‹å¼€å§‹ -> è¿æ¥è¢«æ‹’ç» -> å¤±è´¥è®¡æ•°: 2/5
T = 20s: æ¢é’ˆç¬¬ 3 æ¬¡æ¢æµ‹å¼€å§‹ -> è¿æ¥è¢«æ‹’ç» -> å¤±è´¥è®¡æ•°: 3/5
T = 30s: æ¢é’ˆç¬¬ 4 æ¬¡æ¢æµ‹å¼€å§‹ -> è¿æ¥è¢«æ‹’ç» -> å¤±è´¥è®¡æ•°: 4/5
T = 40s: æ¢é’ˆç¬¬ 5 æ¬¡æ¢æµ‹å¼€å§‹ -> è¿æ¥è¢«æ‹’ç» -> å¤±è´¥è®¡æ•°: 5/5

T = 40s: âŒ failureThreshold è¾¾åˆ° 5ï¼Œå®¹å™¨è¢« Kill å¹¶é‡å¯
         ï¼ˆåº”ç”¨æœ¬æ¥åœ¨ T=80s å°±èƒ½å¯åŠ¨å¥½ï¼Œä½†æ²¡æœºä¼šäº†ï¼‰
```

**ç»“è®º**ï¼šå¯åŠ¨çª—å£ï¼ˆ10s Ã— 5 = 50ç§’ï¼‰å°äºåº”ç”¨çœŸå®å¯åŠ¨æ—¶é—´ï¼ˆ80ç§’ï¼‰ï¼Œå¯¼è‡´åº”ç”¨æ°¸è¿œæ— æ³•å¯åŠ¨ï¼Œé™·å…¥é‡å¯å¾ªç¯ã€‚

---

### 9.5 å…³é”®æ—¶é—´èŠ‚ç‚¹æ€»ç»“

åœ¨æ‚¨çš„é…ç½®ä¸‹ï¼ˆ`periodSeconds: 10`, `timeoutSeconds: 3`, `failureThreshold: 12`ï¼‰ï¼š

| æ—¶é—´ç»´åº¦ | ä½œç”¨ | æ‚¨çš„é…ç½®å€¼ | è¯´æ˜ |
|---------|------|-----------|------|
| **å¯åŠ¨çª—å£** | ç»™åº”ç”¨"ä¹°æ—¶é—´" | 10s Ã— 12 = **120ç§’** | åº”ç”¨å¿…é¡»åœ¨ 120 ç§’å†…å¯åŠ¨å®Œæˆ |
| **æ¢æµ‹é—´éš”** | é‡è¯•é¢‘ç‡ | **10ç§’** | æ¯ 10 ç§’å°è¯•ä¸€æ¬¡ |
| **å•æ¬¡è¶…æ—¶** | æ¥å£å“åº”è¦æ±‚ | **3ç§’** | æ¯æ¬¡ /health è¯·æ±‚å¿…é¡»åœ¨ 3 ç§’å†…è¿”å› 200 |
| **å¤±è´¥å®¹å¿** | é‡è¯•æ¬¡æ•° | **12æ¬¡** | å…è®¸å¤±è´¥ 12 æ¬¡ï¼Œç¬¬ 13 æ¬¡å¤±è´¥æ‰é‡å¯ |

**ä¸‰ä¸ªå…³é”®è®¤çŸ¥**ï¼š
1. **å¯åŠ¨çª—å£ï¼ˆ120ç§’ï¼‰** æ˜¯ç»™åº”ç”¨"åŠ è½½ä¸šåŠ¡é€»è¾‘"çš„æ—¶é—´ï¼ˆSpring åˆå§‹åŒ–ã€æ•°æ®åº“è¿æ¥ã€ç¼“å­˜é¢„çƒ­ç­‰ï¼‰ã€‚
2. **å•æ¬¡è¶…æ—¶ï¼ˆ3ç§’ï¼‰** æ˜¯è¦æ±‚ `/health` æ¥å£"ååº”è¦å¿«"ï¼Œä¸è¦åœ¨æ¥å£é‡Œåšé‡é€»è¾‘ã€‚
3. **å¤±è´¥æ¬¡æ•°ï¼ˆ12æ¬¡ï¼‰** æ˜¯ç¼“å†²æœºåˆ¶ï¼Œå…è®¸åº”ç”¨åœ¨å¯åŠ¨æœŸé—´å¤šæ¬¡å¤±è´¥ï¼Œåªè¦æœ€ç»ˆæˆåŠŸå³å¯ã€‚

**é…ç½®æ˜¯å¦åˆç†ï¼Ÿ**
- å¦‚æœæ‚¨çš„åº”ç”¨å¯åŠ¨è€—æ—¶ < 120ç§’ï¼Œä¸” `/health` æ¥å£å“åº” < 3ç§’ â†’ âœ… é…ç½®å®‰å…¨
- å¦‚æœåº”ç”¨å¯åŠ¨è€—æ—¶ > 120ç§’ â†’ âš ï¸ éœ€è¦å¢åŠ  `failureThreshold`ï¼ˆä¾‹å¦‚æ”¹ä¸º 18ï¼Œæä¾› 180ç§’çª—å£ï¼‰
- å¦‚æœ `/health` æ¥å£å“åº” > 3ç§’ â†’ âŒ éœ€è¦ä¼˜åŒ–æ¥å£é€»è¾‘ï¼Œè€Œä¸æ˜¯å¢åŠ  `timeoutSeconds`

---

## 10. æœ€ç»ˆæ€»ç»“ä¸å¿«é€Ÿå‚è€ƒ

### 10.1 é»„é‡‘æ³•åˆ™ï¼ˆå¿…é¡»è®°ä½çš„ 3 æ¡ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£  å¯åŠ¨çª—å£ = periodSeconds Ã— failureThreshold                     â”‚
â”‚    ä¾‹å¦‚: 10s Ã— 12 = 120ç§’å¯åŠ¨ä¿æŠ¤                                    â”‚
â”‚                                                                       â”‚
â”‚ 2ï¸âƒ£  periodSeconds ä»æœ¬æ¬¡æ¢æµ‹ã€å¼€å§‹ã€‘åˆ°ä¸‹æ¬¡æ¢æµ‹ã€å¼€å§‹ã€‘               â”‚
â”‚    ä¸æ˜¯ä»æœ¬æ¬¡æ¢æµ‹ç»“æŸå¼€å§‹è®¡æ—¶                                         â”‚
â”‚                                                                       â”‚
â”‚ 3ï¸âƒ£  timeoutSeconds æ˜¯å¯¹ /health æ¥å£å“åº”é€Ÿåº¦çš„è¦æ±‚                   â”‚
â”‚    ä¸æ˜¯ç»™åº”ç”¨å¯åŠ¨çš„æ—¶é—´ï¼ˆé‚£æ˜¯ failureThreshold çš„èŒè´£ï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 å¿«é€Ÿé…ç½®å†³ç­–è¡¨

| åº”ç”¨å¯åŠ¨æ—¶é—´ | failureThreshold | periodSeconds | timeoutSeconds | æ€»çª—å£ |
|------------|-----------------|--------------|---------------|--------|
| < 60ç§’ | 12 | 10s | 3s | 120ç§’ âœ… |
| 60-120ç§’ | 12 | 10s | 3s | 120ç§’ âš ï¸ |
| 120-180ç§’ | 18 | 10s | 3s | 180ç§’ âœ… |
| 180-300ç§’ | 30 | 10s | 3s | 300ç§’ âœ… |
| > 300ç§’ | è‡ªå®šä¹‰ | 10s | 3s | è‡ªå®šä¹‰ |

**è®¡ç®—å…¬å¼**ï¼š`failureThreshold = (P99å¯åŠ¨æ—¶é—´ Ã— 1.5) / 10`

### 10.3 æ•…éšœæ’æŸ¥é€ŸæŸ¥è¡¨

| ç—‡çŠ¶ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|---------|---------|
| Pod ä¸€ç›´ `Init:0/1` | Init Container å¡ä½ | æ£€æŸ¥ Init æ—¥å¿—ï¼Œä¸æ¢é’ˆæ— å…³ |
| `CrashLoopBackOff` + StartupProbe failed | å¯åŠ¨æ—¶é—´ > çª—å£ | å¢åŠ  `failureThreshold` |
| `CrashLoopBackOff` + æ¢é’ˆè¶…æ—¶ | `/health` æ¥å£å¤ªæ…¢ | ä¼˜åŒ–æ¥å£é€»è¾‘ï¼Œç§»é™¤é‡æŸ¥è¯¢ |
| Pod Running ä½†æ— æµé‡ | ReadinessProbe å¤±è´¥ | æ£€æŸ¥ `/health` æ˜¯å¦è¿”å› 200 |
| Pod é¢‘ç¹é‡å¯ | LivenessProbe å¤ªæ•æ„Ÿ | å¢åŠ  `failureThreshold` æˆ– `periodSeconds` |
| CPU throttling | èµ„æºé™åˆ¶è¿‡å° | å¢åŠ  `resources.limits.cpu` |

### 10.4 æ¨èé…ç½®æ¨¡æ¿ï¼ˆå¤åˆ¶å³ç”¨ï¼‰

```yaml
# âœ… æ¨èé…ç½®ï¼šé€‚ç”¨äºå¤§å¤šæ•° Java/Go/Node åº”ç”¨
startupProbe:
  httpGet:
    scheme: HTTPS
    path: /{{apiName}}/{{minorVersion}}/.well-known/health
    port: {{port}}
  periodSeconds: 10        # å›ºå®š 10 ç§’
  timeoutSeconds: 3        # /health å¿…é¡»åœ¨ 3 ç§’å†…å“åº”
  failureThreshold: 12     # æä¾› 120 ç§’å¯åŠ¨çª—å£
  successThreshold: 1      # æˆåŠŸ 1 æ¬¡å³é€šè¿‡

readinessProbe:
  httpGet:
    scheme: HTTPS
    path: /{{apiName}}/{{minorVersion}}/.well-known/health
    port: {{port}}
  initialDelaySeconds: 0   # StartupProbe æˆåŠŸåç«‹å³æ¥ç®¡
  periodSeconds: 5         # å¿«é€Ÿæ£€æµ‹ï¼ˆ5 ç§’ï¼‰
  timeoutSeconds: 2        # æ•æ·åˆ‡æ–­æµé‡
  failureThreshold: 3      # è¿ç»­ 3 æ¬¡å¤±è´¥æ‘˜é™¤

livenessProbe:
  httpGet:
    scheme: HTTPS
    path: /{{apiName}}/{{minorVersion}}/.well-known/health
    port: {{port}}
  initialDelaySeconds: 0   # StartupProbe æˆåŠŸåç«‹å³æ¥ç®¡
  periodSeconds: 20        # ä¿å®ˆæ£€æµ‹ï¼ˆ20 ç§’ï¼‰
  timeoutSeconds: 5        # å®½å®¹åº¦æ›´é«˜
  failureThreshold: 3      # é¿å…è¯¯æ€
```

### 10.5 å…³é”®æ—¶é—´ç‚¹è®°å¿†å£è¯€

```
æ¢é’ˆå¼€å§‹çœ‹ä¸»å®¹å™¨ï¼ŒInit å†æ…¢ä¹Ÿä¸æ€•
åç§’ä¸€æ¬¡ä»å¤´ç®—ï¼Œæ¢æµ‹ç»“æŸä¸å½±å“
ä¸‰ç§’è¶…æ—¶çœ‹æ¥å£ï¼Œå¯åŠ¨æ—¶é—´çœ‹å¤±è´¥æ¬¡æ•°
åäºŒæ¬¡æœºä¼šä¸€ç™¾äºŒï¼Œåº”ç”¨æ…¢å¯ä¸ç”¨æ„
```

**è§£é‡Š**ï¼š
- **æ¢é’ˆå¼€å§‹çœ‹ä¸»å®¹å™¨**ï¼šæ¢é’ˆåªåœ¨ä¸»å®¹å™¨å¯åŠ¨åæ‰å¼€å§‹å·¥ä½œ
- **Init å†æ…¢ä¹Ÿä¸æ€•**ï¼šInit Container è€—æ—¶ä¸è®¡å…¥æ¢é’ˆæ—¶é—´
- **åç§’ä¸€æ¬¡ä»å¤´ç®—**ï¼šperiodSeconds ä»æœ¬æ¬¡æ¢æµ‹å¼€å§‹è®¡æ—¶
- **æ¢æµ‹ç»“æŸä¸å½±å“**ï¼šæ¢æµ‹è€—æ—¶ä¸å½±å“ä¸‹æ¬¡æ¢æµ‹æ—¶é—´
- **ä¸‰ç§’è¶…æ—¶çœ‹æ¥å£**ï¼štimeoutSeconds æ˜¯å¯¹ /health æ¥å£çš„è¦æ±‚
- **å¯åŠ¨æ—¶é—´çœ‹å¤±è´¥æ¬¡æ•°**ï¼šfailureThreshold å†³å®šå¯åŠ¨çª—å£
- **åäºŒæ¬¡æœºä¼šä¸€ç™¾äºŒ**ï¼š12 Ã— 10s = 120ç§’å¯åŠ¨ä¿æŠ¤
- **åº”ç”¨æ…¢å¯ä¸ç”¨æ„**ï¼šå¢åŠ  failureThreshold å³å¯

### 10.6 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **æµ‹é‡å¯åŠ¨æ—¶é—´**ï¼šä½¿ç”¨ `pod_measure_startup_fixed.sh` è„šæœ¬è·å–çœŸå®æ•°æ®
   ```bash
   ./pod_measure_startup_fixed.sh -n <namespace> <pod-name>
   ```
2. **è®¡ç®—å‚æ•°**ï¼šæ ¹æ® P99 å¯åŠ¨æ—¶é—´è®¡ç®— `failureThreshold`
   - å…¬å¼ï¼š`failureThreshold = (P99å¯åŠ¨æ—¶é—´ Ã— 1.5) / periodSeconds`
   - è„šæœ¬ä¼šè‡ªåŠ¨æä¾›å»ºè®®å€¼
3. **åº”ç”¨é…ç½®**ï¼šæ›´æ–° Deployment YAML
   ```bash
   kubectl apply -f deployment.yaml
   ```
4. **éªŒè¯æ•ˆæœ**ï¼šè§‚å¯Ÿ Pod å¯åŠ¨è¿‡ç¨‹ï¼Œç¡®ä¿ä¸å† CrashLoopBackOff
   ```bash
   kubectl get pods -n <namespace> -w
   kubectl describe pod <pod-name> -n <namespace>
   ```
5. **ä¼˜åŒ–æ¥å£**ï¼šç¡®ä¿ `/health` æ¥å£è½»é‡å¿«é€Ÿï¼ˆ< 3ç§’ï¼‰
   - ç§»é™¤æ•°æ®åº“æŸ¥è¯¢
   - ç§»é™¤å¤–éƒ¨æœåŠ¡è°ƒç”¨
   - ä»…æ£€æŸ¥åº”ç”¨æœ¬èº«çŠ¶æ€

---

## ğŸ“š å‚è€ƒèµ„æº

- [Kubernetes å®˜æ–¹æ–‡æ¡£ï¼šConfigure Liveness, Readiness and Startup Probes](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)
- [GKE æœ€ä½³å®è·µï¼šHealth Checks](https://cloud.google.com/kubernetes-engine/docs/concepts/ingress#health_checks)
- [Spring Boot Actuator Health Endpoint](https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.endpoints.health)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2024-12  
**ç»´æŠ¤è€…**: GKE Platform Team  
**åé¦ˆ**: å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– PR
