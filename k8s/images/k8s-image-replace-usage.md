# K8s é•œåƒæ›¿æ¢è„šæœ¬ä½¿ç”¨è¯´æ˜

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” è‡ªåŠ¨æœç´¢åŒ¹é…çš„ deployments å’Œå®¹å™¨
- ğŸ¯ æ”¯æŒæŒ‡å®šå‘½åç©ºé—´æˆ–æœç´¢æ‰€æœ‰å‘½åç©ºé—´
- ğŸ“‹ äº¤äº’å¼é€‰æ‹©è¦æ›´æ–°çš„ deployments
- âœ… æ”¯æŒæ‰¹é‡é€‰æ‹©ï¼ˆåºå·èŒƒå›´ã€é€—å·åˆ†éš”ã€å…¨é€‰ï¼‰
- ğŸ”„ è‡ªåŠ¨ç­‰å¾… rollout å®Œæˆ
- ğŸ¨ å½©è‰²è¾“å‡ºï¼Œæ¸…æ™°æ˜“è¯»
- ğŸ›¡ï¸ å®‰å…¨ç¡®è®¤æœºåˆ¶

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# æœç´¢æ‰€æœ‰å‘½åç©ºé—´ä¸­åŒ¹é…çš„ deployments
./k8s-image-replace.sh -i myapp:v1.2.3

# æŒ‡å®šå‘½åç©ºé—´æœç´¢
./k8s-image-replace.sh -i registry.io/myorg/myapp:v2.0.0 -n production
```

### å‚æ•°è¯´æ˜

- `-i, --image`: ç›®æ ‡é•œåƒï¼ˆå¿…éœ€ï¼‰
- `-n, --namespace`: æŒ‡å®šå‘½åç©ºé—´ï¼ˆå¯é€‰ï¼Œé»˜è®¤æœç´¢æ‰€æœ‰å‘½åç©ºé—´ï¼‰
- `-h, --help`: æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

## ä½¿ç”¨æµç¨‹

1. **æ‰§è¡Œè„šæœ¬**ï¼šæä¾›ç›®æ ‡é•œåƒåç§°
2. **æŸ¥çœ‹åŒ¹é…ç»“æœ**ï¼šè„šæœ¬ä¼šåˆ—å‡ºæ‰€æœ‰åŒ¹é…çš„ deployments
3. **é€‰æ‹©è¦æ›´æ–°çš„é¡¹ç›®**ï¼š
   - è¾“å…¥åºå·ï¼š`1,3,5` æˆ– `1-3`
   - è¾“å…¥ `all` é€‰æ‹©å…¨éƒ¨
   - è¾“å…¥ `q` é€€å‡º
4. **ç¡®è®¤æ‰§è¡Œ**ï¼šæ£€æŸ¥æ›´æ–°åˆ—è¡¨åç¡®è®¤
5. **ç­‰å¾…å®Œæˆ**ï¼šè„šæœ¬ä¼šè‡ªåŠ¨ç­‰å¾… rollout å®Œæˆ

## ç¤ºä¾‹è¾“å‡º

```
[INFO] ç›®æ ‡é•œåƒ: myapp:v1.2.3
[INFO] é•œåƒåç§°: myapp
[INFO] é•œåƒæ ‡ç­¾: v1.2.3
[INFO] æœç´¢æ‰€æœ‰å‘½åç©ºé—´

[SUCCESS] æ‰¾åˆ° 2 ä¸ªåŒ¹é…çš„ deployment(s):

åºå· å‘½åç©ºé—´             Deployment                     å®¹å™¨                 å½“å‰é•œåƒ
---- --------             ----------                     ----                 --------
1    default              myapp-frontend                 myapp                myapp:v1.2.2
2    production           myapp-api                      api-container        myapp:v1.2.1

è¯·é€‰æ‹©è¦æ›´æ–°çš„ deployment:
  è¾“å…¥åºå· (ä¾‹å¦‚: 1,3,5 æˆ– 1-3)
  è¾“å…¥ 'all' é€‰æ‹©å…¨éƒ¨
  è¾“å…¥ 'q' é€€å‡º

è¯·é€‰æ‹©: all

[INFO] å°†è¦æ‰§è¡Œä»¥ä¸‹æ›´æ–°æ“ä½œ:
  default/myapp-frontend (myapp): myapp:v1.2.2 -> myapp:v1.2.3
  production/myapp-api (api-container): myapp:v1.2.1 -> myapp:v1.2.3

ç¡®è®¤æ‰§è¡Œ? (y/N): y

[INFO] å¼€å§‹æ‰§è¡Œé•œåƒæ›´æ–°...
[INFO] æ›´æ–° default/myapp-frontend ä¸­çš„å®¹å™¨ myapp...
[SUCCESS] âœ“ default/myapp-frontend æ›´æ–°æˆåŠŸ
[INFO] ç­‰å¾… default/myapp-frontend rollout å®Œæˆ...
[SUCCESS] âœ“ default/myapp-frontend rollout å®Œæˆ

[SUCCESS] é•œåƒæ›´æ–°æ“ä½œå®Œæˆ!
```

## æ³¨æ„äº‹é¡¹

1. **æƒé™è¦æ±‚**ï¼šéœ€è¦å¯¹ç›®æ ‡å‘½åç©ºé—´çš„ deployments æœ‰æ›´æ–°æƒé™
2. **é•œåƒåŒ¹é…**ï¼šæ”¯æŒéƒ¨åˆ†åŒ¹é…ï¼Œä¼šåŒ¹é…åŒ…å«æŒ‡å®šé•œåƒåç§°çš„æ‰€æœ‰å®¹å™¨
3. **å›æ»š**ï¼šå¦‚æœæ›´æ–°å¤±è´¥ï¼Œè„šæœ¬ä¼šæç¤ºå›æ»šå‘½ä»¤
4. **è¶…æ—¶è®¾ç½®**ï¼šrollout ç­‰å¾…æ—¶é—´ä¸º 5 åˆ†é’Ÿï¼Œå¯æ ¹æ®éœ€è¦è°ƒæ•´

## å®‰å…¨ç‰¹æ€§

- âœ… æ‰§è¡Œå‰æ˜¾ç¤ºè¯¦ç»†çš„æ›´æ–°è®¡åˆ’
- âœ… éœ€è¦ç”¨æˆ·ç¡®è®¤æ‰ä¼šæ‰§è¡Œ
- âœ… è‡ªåŠ¨æ£€æŸ¥ kubectl è¿æ¥
- âœ… æä¾›å›æ»šå»ºè®®
- âœ… å½©è‰²è¾“å‡ºåŒºåˆ†ä¸åŒçŠ¶æ€

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **kubectl æœªæ‰¾åˆ°**
   ```bash
   # ç¡®ä¿ kubectl å·²å®‰è£…å¹¶åœ¨ PATH ä¸­
   which kubectl
   ```

2. **æ— æ³•è¿æ¥é›†ç¾¤**
   ```bash
   # æ£€æŸ¥ kubeconfig
   kubectl cluster-info
   ```

3. **æƒé™ä¸è¶³**
   ```bash
   # æ£€æŸ¥æƒé™
   kubectl auth can-i update deployments -n <namespace>
   ```

4. **rollout å¤±è´¥**
   ```bash
   # æ‰‹åŠ¨å›æ»š
   kubectl rollout undo deployment/<deployment-name> -n <namespace>
   ```