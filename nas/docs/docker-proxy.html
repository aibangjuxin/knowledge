<!DOCTYPE html><html><head>
      <title>docker-proxy</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////Users/lex/.antigravity/extensions/shd101wyy.markdown-preview-enhanced-0.8.20-universal/crossnote/dependencies/katex/katex.min.css">
      
      
      <script type="text/javascript" src="file:////Users/lex/.antigravity/extensions/shd101wyy.markdown-preview-enhanced-0.8.20-universal/crossnote/dependencies/mermaid/mermaid.min.js" charset="UTF-8"></script>
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<p>ä¸‹é¢ç»™ä½ ä¸€ä¸ª <strong>åœ¨ NASï¼ˆQNAP / Synology / ä»»æ„ Linuxï¼‰ä¸Šè®© Docker èµ°ä»£ç†æ‹‰å–é•œåƒçš„å®Œæ•´å¯æ“ä½œæ–¹æ¡ˆ</strong>ã€‚</p>
<p>æ–¹æ¡ˆ4 success</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token punctuation">[</span>/share/CACHEDEV3_DATA/git/dashboard/hestia-core<span class="token punctuation">]</span> <span class="token comment"># docker pull nginx:alpine</span>
alpine: Pulling from library/nginx
2d35ebdb57d9: Pull complete
8f6a6833e95d: Pull complete
194fa24e147d: Pull complete
3eaba6cd10a3: Pull complete
df413d6ebdc8: Pull complete
d9a55dab5954: Pull complete
ff8a36d5502a: Pull complete
bdabb0d44271: Pull complete
Digest: sha256:b3c656d55d7ad751196f21b7fd2e8d4da9cb430e32f646adcf92441b72f82b14
Status: Downloaded newer image <span class="token keyword keyword-for">for</span> nginx:alpine
docker.io/library/nginx:alpine


<span class="token number">1</span> è¿è¡Œk3s reference Docker hub è¿™é‡Œå› ä¸ºç«¯å£å ç”¨ ï¼Œæ‰€ä»¥æˆ‘é‡æ–°å¯ç”¨æ–°çš„ç«¯å£ã€‚ 
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> k3s-server <span class="token punctuation">\</span>
  <span class="token parameter variable">--privileged</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">6444</span>:6443 <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">8888</span>:80 <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">4433</span>:443 <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> /var/lib/rancher/k3s:/var/lib/rancher/k3s <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> /var/lib/kubelet:/var/lib/kubelet <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> /var/run:/var/run <span class="token punctuation">\</span>
  rancher/k3s:v1.32.10-k3s1 server
<span class="token number">2</span>   
<span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span>
CONTAINER ID   IMAGE                                           COMMAND                  CREATED          STATUS                       PORTS                                                                    NAMES
40b5eb9cad24   rancher/k3s:v1.32.10-k3s1                       <span class="token string">"/bin/k3s server"</span>        <span class="token number">33</span> seconds ago   Up <span class="token number">32</span> seconds                <span class="token number">0.0</span>.0.0:8888-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, <span class="token number">0.0</span>.0.0:4433-<span class="token operator">&gt;</span><span class="token number">443</span>/tcp, <span class="token number">0.0</span>.0.0:6444-<span class="token operator">&gt;</span><span class="token number">6443</span>/tcp      k3s-server
<span class="token number">3</span> é‡æ–°å¯¼å‡º kubeconfigï¼šç„¶åä¿®æ”¹ä¾¦å¬åœ°å€å’Œ å¿½ç•¥è¯ä¹¦
clusters:
- cluster:
    insecure-skip-tls-verify: <span class="token boolean">true</span>
    server: https://192.168.31.88:6444
  name: default
<span class="token number">4</span> macOSä¸Š 
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/kubeconfig.yaml <span class="token operator">==</span><span class="token operator">&gt;</span> mac pro
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/Users/lex/nas-k3s.yaml <span class="token operator">==</span><span class="token operator">&gt;</span> na
<span class="token number">5</span> 
âœ  ~ kubectl get nodes
NAME           STATUS   ROLES                  AGE   VERSION
40b5eb9cad24   Ready    control-plane,master   13m   v1.32.10+k3s1
âœ  ~ kubectl get pod <span class="token parameter variable">-A</span>
NAMESPACE     NAME                                      READY   STATUS              RESTARTS   AGE
kube-system   coredns-6d668d687-qlxkb                   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          13m
kube-system   helm-install-traefik-crd-ggqq6            <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          13m
kube-system   helm-install-traefik-j7nn7                <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          13m
kube-system   local-path-provisioner-869c44bfbd-rhd5j   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          13m
kube-system   metrics-server-7bfffcd44-zjq52            <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          13m
<span class="token number">6</span> manual pull images 
<span class="token function">docker</span> pull rancher/mirrored-coredns-coredns:1.13.1
rancher/local-path-provisioner:v0.0.32
rancher/mirrored-metrics-server:v0.8.0

</code></pre><p>å…¨éƒ¨å†…å®¹å‡ä¸º <strong>å¯ç›´æ¥å¤åˆ¶ä½¿ç”¨çš„ Shell å‘½ä»¤</strong>ï¼Œå¹¶æŒ‰ç…§ä½ çš„ç½‘ç»œç»“æ„ï¼ˆNAS æ— æ³•ç›´è¿ <a href="http://docker.io">docker.io</a>ï¼ŒMac æœ‰ä»£ç†ï¼‰æ¥è®¾è®¡ã€‚</p>
<hr>
<h1 id="é—®é¢˜åˆ†æ"><strong>é—®é¢˜åˆ†æ</strong> </h1>
<p>ä½ çš„ NAS ä¸Šæ— æ³•ç›´æ¥ä» <code>docker.io/library/nginx:alpine</code> æ‹‰å–é•œåƒã€‚<br>
å¸¸è§åŸå› ï¼š</p>
<ul>
<li>
<p>NAS æ‰€åœ¨ç½‘ç»œæ— æ³•ç›´è¿ Docker Hubï¼ˆè¢«å¢™ or ç½‘ç»œç­–ç•¥ï¼‰</p>
</li>
<li>
<p>NAS é»˜è®¤ Docker <strong>ä¸ä¼šè¯»å– export çš„ä»£ç†å˜é‡</strong></p>
</li>
<li>
<p>éœ€è¦åœ¨ Docker daemon çº§åˆ«é…ç½®ä»£ç†ï¼Œæˆ–è€…åœ¨ Docker CLI å±‚é…ç½®ä»£ç†</p>
</li>
</ul>
<hr>
<h1 id="è§£å†³æ–¹æ¡ˆ"><strong>è§£å†³æ–¹æ¡ˆ</strong> </h1>
<p>é€‚åˆæ‰€æœ‰ç±»å‹ NASï¼ˆQNAP/Synology/è‡ªå»º Linuxï¼‰</p>
<hr>
<h2 id="æ–¹æ¡ˆ-1ç»™-docker-daemon-é…ç½®ä»£ç†æ¨èæœ€ç¨³å®š"><strong>æ–¹æ¡ˆ 1ï¼šç»™ Docker Daemon é…ç½®ä»£ç†ï¼ˆæ¨èï¼Œæœ€ç¨³å®šï¼‰</strong> </h2>
<h3 id="æ­¥éª¤-1åˆ›å»º-docker-daemon-ä»£ç†é…ç½®"><strong>æ­¥éª¤ 1ï¼šåˆ›å»º Docker daemon ä»£ç†é…ç½®</strong> </h3>
<p>åœ¨ NAS ä¸Šæ‰§è¡Œï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/systemd/system/docker.service.d
</code></pre><p>åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> <span class="token function">tee</span> /etc/systemd/system/docker.service.d/http-proxy.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF
[Service]
Environment="HTTP_PROXY=http://192.168.31.198:7222"
Environment="HTTPS_PROXY=http://192.168.31.198:7222"
Environment="NO_PROXY=localhost,127.0.0.1"
EOF</span>
</code></pre><blockquote>
<p>è¯´æ˜ï¼š<br>
<code>192.168.31.198:7222</code> æ˜¯ä½  Mac ä¸Šçš„ä»£ç†ï¼ˆå¦‚ Loon/Clashï¼‰ã€‚</p>
</blockquote>
<hr>
<h3 id="æ­¥éª¤-2é‡è½½å¹¶é‡å¯-docker"><strong>æ­¥éª¤ 2ï¼šé‡è½½å¹¶é‡å¯ Docker</strong> </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre><hr>
<h3 id="æ­¥éª¤-3æµ‹è¯•æ˜¯å¦ç”Ÿæ•ˆ"><strong>æ­¥éª¤ 3ï¼šæµ‹è¯•æ˜¯å¦ç”Ÿæ•ˆ</strong> </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">docker</span> pull nginx:alpine
</code></pre><p>å¦‚æœæˆåŠŸï¼Œé‚£ä¹ˆ Daemon ä»£ç†å·²ç»å¯ç”¨ã€‚</p>
<hr>
<h2 id="æ–¹æ¡ˆ-2cli-å±‚ä½¿ç”¨ä»£ç†ä¸´æ—¶ä½¿ç”¨"><strong>æ–¹æ¡ˆ 2ï¼šCLI å±‚ä½¿ç”¨ä»£ç†ï¼ˆä¸´æ—¶ä½¿ç”¨ï¼‰</strong> </h2>
<p>å¦‚æœ NAS ä¸æ”¯æŒ systemd æˆ–ä½ æƒ³å¿«é€Ÿæµ‹è¯•ï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">HTTP_PROXY</span><span class="token operator">=</span>http://192.168.31.198:7222
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HTTPS_PROXY</span><span class="token operator">=</span>http://192.168.31.198:7222

<span class="token function">docker</span> pull nginx:alpine
</code></pre><p><strong>æ³¨æ„</strong>ï¼š<br>
âš ï¸ Docker CLI å±‚çš„ proxy é€šå¸¸ <strong>å¯¹ build æœ‰æ•ˆï¼Œä½†æ˜¯å¯¹ pull ä¸ä¸€å®šç”Ÿæ•ˆ</strong><br>
å› ä¸º pull æ˜¯ Docker daemon æ‰§è¡Œçš„ã€‚</p>
<hr>
<h2 id="æ–¹æ¡ˆ-3ä¸º-docker-hub-é…ç½®é•œåƒåŠ é€Ÿå™¨è¾…åŠ©"><strong>æ–¹æ¡ˆ 3ï¼šä¸º Docker Hub é…ç½®é•œåƒåŠ é€Ÿå™¨ï¼ˆè¾…åŠ©ï¼‰</strong> </h2>
<p>ä½ ä¹Ÿå¯ä»¥åŠ ä¸€ä¸ª registry mirrorï¼ˆä¸æ˜¯ä»£ç†ï¼Œä½†èƒ½åŠ é€Ÿ/ç»•è·¯ï¼‰</p>
<h3 id="qnapsynology-å¯èƒ½éœ€è¦ä¿®æ”¹">QNAP/Synology å¯èƒ½éœ€è¦ä¿®æ”¹ï¼š </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF
{
  "registry-mirrors": [
    "https://docker.1panel.live",
    "https://dockerproxy.com"
  ]
}
EOF</span>
</code></pre><p>ç„¶åé‡å¯ Dockerï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre><hr>
<h1 id="æ–¹æ¡ˆ-4å¦‚æœ-nas-docker-æ˜¯-qnap-container-stationæ— -systemd"><strong>æ–¹æ¡ˆ 4ï¼šå¦‚æœ NAS Docker æ˜¯ QNAP Container Stationï¼ˆæ—  systemdï¼‰</strong> </h1>
<p>QNAP çš„ Docker è·¯å¾„æ˜¯ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>/share/CACHEDEV1_DATA/.qpkg/container-station/bin/docker
</code></pre><p>ä½ å¯ä»¥ç›´æ¥å†™ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š</p>
<h3 id="åˆ›å»ºé…ç½®ç›®å½•">åˆ›å»ºé…ç½®ç›®å½• </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /share/CACHEDEV1_DATA/.qpkg/container-station/etc/systemd/system/docker.service.d/
</code></pre><h3 id="åˆ›å»ºä»£ç†æ–‡ä»¶">åˆ›å»ºä»£ç†æ–‡ä»¶ </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">tee</span> /share/CACHEDEV1_DATA/.qpkg/container-station/etc/systemd/system/docker.service.d/http-proxy.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF
[Service]
Environment="HTTP_PROXY=http://192.168.31.198:7222"
Environment="HTTPS_PROXY=http://192.168.31.198:7222"
Environment="NO_PROXY=localhost,127.0.0.1"
EOF</span>
</code></pre><p>ç„¶åé‡å¯ Container Stationï¼ˆä¸æ˜¯ systemctlï¼‰ï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>/etc/init.d/container-station.sh restart
</code></pre><hr>
<h1 id="æ–¹æ¡ˆ-5ä½¿ç”¨-mac-ä½œä¸ºä»£ç†ç½‘å…³é€æ˜"><strong>æ–¹æ¡ˆ 5ï¼šä½¿ç”¨ Mac ä½œä¸ºã€Œä»£ç†ç½‘å…³ã€(é€æ˜)</strong> </h1>
<p>å¦‚æœ NAS æ— æ³•é…ç½® systemdï¼Œå¯ä»¥è®© NAS æ•´ä¸ªç½‘ç»œæµé‡èµ°ä½  Mac çš„ä»£ç†ï¼š</p>
<p>åœ¨ Mac çš„ Clash / Loon è®¾ç½®ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Allow LAN: true
Mixin å¼€å¯ redir / tproxy
</code></pre><p>NAS ä¸Šè®¾ç½®ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>é»˜è®¤ç½‘å…³æŒ‡å‘ Mac çš„ IP
DNS ä¹Ÿæ”¹æˆ 8.8.8.8 æˆ– Cloudflare
</code></pre><p>è¿™æ ·æ‹‰é•œåƒä¸éœ€è¦è®¾ç½®ä»£ç†ã€‚</p>
<hr>
<h1 id="æ³¨æ„äº‹é¡¹"><strong>æ³¨æ„äº‹é¡¹</strong> </h1>
<ul>
<li>
<p>Docker pull çš„ä»£ç†å¿…é¡»æ˜¯ Docker daemon å±‚ç”Ÿæ•ˆ</p>
</li>
<li>
<p>export åªèƒ½è§£å†³ <strong>docker build</strong>ï¼Œä¸ä¸€å®šè§£å†³ <strong>docker pull</strong></p>
</li>
<li>
<p>QNAP/Synology æ²¡ systemdï¼Œéœ€è¦ä½¿ç”¨å®ƒä»¬è‡ªå·±çš„ Docker æœåŠ¡è„šæœ¬</p>
</li>
<li>
<p>å¦‚æœ Mac çš„ä»£ç†é™åˆ¶äº† LANï¼Œéœ€è¦å¼€å¯ <strong>Allow LAN</strong></p>
</li>
</ul>
<hr>
<h1 id="å¦‚æœä½ å‘Šè¯‰æˆ‘"><strong>å¦‚æœä½ å‘Šè¯‰æˆ‘ï¼š</strong> </h1>
<p>ğŸ‘‰ ä½ çš„ NAS æ˜¯ <strong>QNAP / Synology / Linuxï¼ˆä»€ä¹ˆå‘è¡Œç‰ˆï¼‰</strong><br>
ğŸ‘‰ Docker è·¯å¾„ï¼ˆä½ å·²ç»æä¾›ï¼š<code>/share/CACHEDEV1_DATA/.qpkg/container-station/bin/docker</code>ï¼‰</p>
<p>æˆ‘å¯ä»¥å¸®ä½ ç”Ÿæˆ <strong>å®Œå…¨åŒ¹é…ä½ ç³»ç»Ÿçš„æœ€ç»ˆç‰ˆæœ¬è„šæœ¬</strong>ã€‚</p>
<p>è¦ä¸è¦æˆ‘ç›´æ¥å¸®ä½ åš <strong>NASï¼ˆQNAPï¼‰ä¸“ç”¨çš„å®Œæ•´é…ç½®æ–‡ä»¶ + ä¸€é”®è„šæœ¬ï¼Ÿ</strong></p>
<p>ä¸‹é¢æˆ‘ç»™ä½  <strong>åŸºäºä½ å½“å‰ç«¯å£æ˜ å°„ï¼ˆ8888/4433/6444ï¼‰</strong> çš„å®Œæ•´ä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>ä½ ç°åœ¨çš„ k3s å®¹å™¨è¿è¡Œæƒ…å†µå¦‚ä¸‹ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Host:8888  -&gt; Container:80
Host:4433 -&gt; Container:443
Host:6444 -&gt; Container:6443  â† k3s API server
</code></pre><p>å› æ­¤ <strong>ä½ çš„ Kubernetes API å…¥å£åœ°å€å˜æˆï¼š</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>https://&lt;NAS-IP&gt;:6444
</code></pre><p>æ¥ä¸‹æ¥éœ€è¦ 3 ä¸ªæ­¥éª¤ï¼š</p>
<hr>
<h1 id="1-è·å–-kubeconfigæœ€å…³é”®">1. è·å– kubeconfigï¼ˆæœ€å…³é”®ï¼‰ </h1>
<p>k3s çš„ kubeconfig åœ¨å®¹å™¨å†… <code>/etc/rancher/k3s/k3s.yaml</code><br>
ç›´æ¥ä»å®¹å™¨ä¸­å–å‡ºæ¥ï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> k3s-server <span class="token function">cat</span> /etc/rancher/k3s/k3s.yaml <span class="token operator">&gt;</span> kubeconfig.yaml
</code></pre><p>ç„¶åä¿®æ”¹å…¶ä¸­çš„ API åœ°å€ï¼š</p>
<h3 id="æ‰“å¼€-kubeconfigyaml">æ‰“å¼€ kubeconfig.yaml </h3>
<p>æŠŠé‡Œé¢çš„ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>server: https://127.0.0.1:6443
</code></pre><p>æ”¹æˆï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>server: https://&lt;NAS-IP&gt;:6444
</code></pre><p>ä¾‹å¦‚ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>server: https://192.168.31.50:6444
</code></pre><hr>
<h1 id="2-ä½¿ç”¨-kubeconfig-æ“ä½œ-k3s">2. ä½¿ç”¨ kubeconfig æ“ä½œ k3s </h1>
<p>ç¡®ä¿ä½ æœ¬åœ°è£…å¥½äº† kubectlï¼ˆMac å·²æœ‰ï¼‰ã€‚<br>
ç„¶åæ‰§è¡Œï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/kubeconfig.yaml
</code></pre><p>éªŒè¯è®¿é—®ï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>kubectl get nodes
</code></pre><p>ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>NAME         STATUS   ROLES                  AGE   VERSION
k3s-server   Ready    control-plane,master   2m    v1.32.10+k3s1
</code></pre><hr>
<h1 id="3-éƒ¨ç½²ä¸€ä¸ªæµ‹è¯•åº”ç”¨éªŒè¯ç«¯å£æ˜ å°„">3. éƒ¨ç½²ä¸€ä¸ªæµ‹è¯•åº”ç”¨éªŒè¯ç«¯å£æ˜ å°„ </h1>
<p>å› ä¸ºä½ æŠŠå®¹å™¨å†…çš„ <strong>80 æ˜ å°„åˆ° NAS çš„ 8888</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ª nginxï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>kubectl create deployment web <span class="token parameter variable">--image</span><span class="token operator">=</span>nginx
kubectl expose deployment web <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">80</span>
</code></pre><p>ç„¶ååˆ›å»º LoadBalancerï¼ˆk3s è‡ªå¸¦ servicelbï¼‰ï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>kubectl expose deployment web <span class="token parameter variable">--type</span><span class="token operator">=</span>LoadBalancer <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">80</span>
</code></pre><p>è·å–ç«¯å£ï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>kubectl get svc web
</code></pre><p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>NAME   TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)
web    LoadBalancer   10.43.120.45   192.168.31.50  80:31136/TCP
</code></pre><p>è®¿é—®æ–¹å¼ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>http://&lt;NAS-IP&gt;:31136
</code></pre><p>å¦‚æœæƒ³ç›´æ¥æ˜ å°„åˆ°ä½ è®¾ç½®çš„ 8888ï¼Œè¯·åœ¨ k3s å¯åŠ¨å‘½ä»¤ä¸­ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>-p 8888:80
</code></pre><p>ä½ å·²ç»è¿™ä¹ˆåšäº†ï¼Œæ‰€ä»¥è®¿é—®ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>http://&lt;NAS-IP&gt;:8888
</code></pre><p>ä½ ä¼šçœ‹åˆ° nginx æ¬¢è¿é¡µã€‚</p>
<hr>
<h1 id="4-æ£€æŸ¥-k3s-å†…éƒ¨ç»„ä»¶">4. æ£€æŸ¥ k3s å†…éƒ¨ç»„ä»¶ </h1>
<p>æŸ¥çœ‹ podsï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>kubectl get pods <span class="token parameter variable">-A</span>
</code></pre><p>ä½ ä¼šçœ‹åˆ°ï¼š</p>
<ul>
<li>
<p>traefikï¼ˆingressï¼‰</p>
</li>
<li>
<p>coredns</p>
</li>
<li>
<p>metrics-server</p>
</li>
<li>
<p>local-path-provisioner</p>
</li>
<li>
<p>servicelb</p>
</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯ k3s è‡ªå¸¦çš„ç»„ä»¶ã€‚</p>
<hr>
<h1 id="5-å®Œæ•´å›¾ç¤º">5. å®Œæ•´å›¾ç¤º </h1>
<div class="mermaid">graph TD
    A[Docker container k3s-server] --&gt; B[K3s API server 6443]
    B --&gt; C[Mapped to NAS 6444]
    C --&gt; D[kubectl via kubeconfig.yaml]

    A --&gt; E[Ingress / ServiceLB / etc]
    E --&gt; F[Nginx test app]
    F --&gt; G[NAS 8888 -&gt; 80]
</div><hr>
<h1 id="6-ä½ ç°åœ¨å¯ä»¥åšçš„äº‹">6. ä½ ç°åœ¨å¯ä»¥åšçš„äº‹ </h1>
<p>ä½ ç°åœ¨å·²ç»å…·å¤‡ï¼š</p>
<table>
<thead>
<tr>
<th>ä»»åŠ¡</th>
<th>å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
<td>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</td>
<td><code>kubectl get nodes</code></td>
</tr>
<tr>
<td>æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶</td>
<td><code>kubectl get pods -A</code></td>
</tr>
<tr>
<td>éƒ¨ç½² app</td>
<td><code>kubectl create deployment</code></td>
</tr>
<tr>
<td>å¯¹å¤–æš´éœ²æœåŠ¡</td>
<td><code>kubectl expose</code></td>
</tr>
<tr>
<td>è¿›å…¥ k3s å®¹å™¨</td>
<td><code>docker exec -it k3s-server sh</code></td>
</tr>
</tbody>
</table>
<hr>
<h1 id="å¦‚æœä½ å¸Œæœ›æˆ‘å¸®ä½ ç”Ÿæˆä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬"><strong>å¦‚æœä½ å¸Œæœ›æˆ‘å¸®ä½ ç”Ÿæˆä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬ï¼š</strong> </h1>
<ul>
<li>
<p>è‡ªåŠ¨å¯åŠ¨ k3sï¼ˆå«ç«¯å£ 8888/4433/6444ï¼‰</p>
</li>
<li>
<p>è‡ªåŠ¨å¯¼å‡º kubeconfig</p>
</li>
<li>
<p>è‡ªåŠ¨æ›¿æ¢ server åœ°å€</p>
</li>
<li>
<p>è‡ªåŠ¨é…ç½® kubectl</p>
</li>
</ul>
<p>æˆ‘å¯ä»¥ç»™ä½ ä¸€ä¸ª <strong>ä¸€é”®è„šæœ¬ï¼ˆNAS ä¸“ç”¨ï¼‰</strong>ã€‚</p>
<p>éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆå—ï¼Ÿ</p>
<p>ä½ ç°åœ¨é‡åˆ°çš„æŠ¥é”™éå¸¸å…¸å‹ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>tls: failed to verify certificate: x509: certificate is valid for 10.0.3.9, 10.43.0.1, 127.0.0.1, ::1, not 192.168.31.88
</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼š<br>
<strong>ä½ çš„ kubeconfig æŒ‡å‘äº† <code>https://192.168.31.88:6444</code>ï¼Œä½†æ˜¯ k3s å†…éƒ¨ç”Ÿæˆçš„ APIServer è¯ä¹¦é‡Œå¹¶æ²¡æœ‰è¿™ä¸ª IPï¼Œæ‰€ä»¥ TLS æ ¡éªŒå¤±è´¥ã€‚</strong></p>
<hr>
<h1 id="-è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ä»»é€‰ä¸€ç§">âœ… <strong>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼ˆä»»é€‰ä¸€ç§ï¼‰</strong> </h1>
<hr>
<h1 id="æ–¹æ¡ˆ-aæ¨èé‡æ–°å¯åŠ¨-k3s-æ—¶åŠ å…¥--tls-sanè®©è¯ä¹¦ä¿¡ä»»-1921683188"><strong>æ–¹æ¡ˆ Aï¼ˆæ¨èï¼‰ï¼šé‡æ–°å¯åŠ¨ k3s æ—¶åŠ å…¥ --tls-sanï¼Œè®©è¯ä¹¦ä¿¡ä»» 192.168.31.88</strong> </h1>
<p>k3s åŸç”Ÿæ”¯æŒåŠ å…¥ SAN (Subject Alternative Name)ã€‚</p>
<p>ä½ ç°åœ¨å¯åŠ¨ k3s çš„ docker run å‘½ä»¤åº”è¯¥æ˜¯ç±»ä¼¼è¿™æ ·ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>docker run -d --name k3s-server \
  --privileged \
  -p 6444:6443 \
  -p 8888:80 \
  -p 4433:443 \
  rancher/k3s:v1.32.10-k3s1 server
</code></pre><p>ä½ éœ€è¦åŠ ä¸Šä»¥ä¸‹å‚æ•°ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>--tls-san 192.168.31.88
</code></pre><hr>
<h2 id="-æœ€ç»ˆå‘½ä»¤è¯·é‡æ–°å¯åŠ¨-k3s-å®¹å™¨">ğŸ“Œ <strong>æœ€ç»ˆå‘½ä»¤ï¼ˆè¯·é‡æ–°å¯åŠ¨ k3s å®¹å™¨ï¼‰</strong> </h2>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">docker</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> k3s-server
</code></pre><p>å†å¯åŠ¨ï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> k3s-server <span class="token punctuation">\</span>
  <span class="token parameter variable">--privileged</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">6444</span>:6443 <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">8888</span>:80 <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">4433</span>:443 <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> /var/lib/rancher/k3s:/var/lib/rancher/k3s <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> /var/lib/kubelet:/var/lib/kubelet <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> /var/run:/var/run <span class="token punctuation">\</span>
  rancher/k3s:v1.32.10-k3s1 server <span class="token punctuation">\</span>
  --tls-san <span class="token number">192.168</span>.31.88
</code></pre><p>k3s ä¼šé‡æ–°ç”Ÿæˆè¯ä¹¦ï¼ŒåŒ…å«ä½ çš„ NAS IPã€‚</p>
<hr>
<h1 id="æ–¹æ¡ˆ-bä¿®æ”¹-kubeconfigè®©å…¶å¿½ç•¥è¯ä¹¦æ ¡éªŒä¸æ¨è"><strong>æ–¹æ¡ˆ Bï¼šä¿®æ”¹ kubeconfigï¼Œè®©å…¶å¿½ç•¥è¯ä¹¦æ ¡éªŒï¼ˆä¸æ¨èï¼‰</strong> </h1>
<p>åªéœ€è¦åœ¨ kubeconfig.yaml çš„ cluster ä¸­åŠ å…¥ï¼š</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">insecure-skip-tls-verify</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><p>ä¾‹å¦‚ï¼š</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">clusters</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
    <span class="token key atrule">certificate-authority-data</span><span class="token punctuation">:</span> xxx
    <span class="token key atrule">insecure-skip-tls-verify</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//192.168.31.88<span class="token punctuation">:</span><span class="token number">6444</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> default
</code></pre><p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>
<p>è·³è¿‡ TLS æ ¡éªŒï¼Œä¸å®‰å…¨</p>
</li>
<li>
<p>é•¿æœŸç”¨ä¸æ¨è</p>
</li>
</ul>
<hr>
<h1 id="-ä¸ºä»€ä¹ˆ-k3s-é»˜è®¤è¯ä¹¦ä¸åŒ…å«-1921683188">ğŸ” <strong>ä¸ºä»€ä¹ˆ k3s é»˜è®¤è¯ä¹¦ä¸åŒ…å« 192.168.31.88ï¼Ÿ</strong> </h1>
<p>å› ä¸ºï¼š</p>
<ul>
<li>
<p>k3s åœ¨å®¹å™¨å†…è¿è¡Œ</p>
</li>
<li>
<p>APIServer é»˜è®¤ç”¨ container å†…çš„ç½‘ç»œ IPï¼Œä¾‹å¦‚ <code>10.0.3.9</code></p>
</li>
<li>
<p>k3s ä¸ä¼šè‡ªåŠ¨æŠŠ Host çš„å±€åŸŸç½‘ IP åŠ è¿›å»ï¼ˆé™¤éç”¨ --tls-sanï¼‰</p>
</li>
</ul>
<p>è¿™å±äºæ­£å¸¸è®¾è®¡ã€‚</p>
<hr>
<h1 id="-éªŒè¯ä¿®å¤åçš„çŠ¶æ€">ğŸ§ª <strong>éªŒè¯ä¿®å¤åçš„çŠ¶æ€</strong> </h1>
<p>é‡æ–°å¯¼å‡º kubeconfigï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> k3s-server <span class="token function">cat</span> /etc/rancher/k3s/k3s.yaml <span class="token operator">&gt;</span> kubeconfig.yaml
</code></pre><p>ä¿®æ”¹é‡Œé¢çš„ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>server: https://192.168.31.88:6444
</code></pre><p>ç„¶åæ‰§è¡Œï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/kubeconfig.yaml
kubectl get nodes
</code></pre><p>ä½ åº”è¯¥çœ‹åˆ°ï¼š</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>NAME         STATUS   ROLES                  AGE   VERSION
k3s-server   Ready    control-plane,master   1m    v1.32.10+k3s1
</code></pre><hr>
<h1 id="-æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆæœ€ç»ˆçš„ä¸€é”®è„šæœ¬">ğŸš€ <strong>æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆæœ€ç»ˆçš„ä¸€é”®è„šæœ¬ï¼Ÿ</strong> </h1>
<p>å†…å®¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>è‡ªåŠ¨å¯åŠ¨ k3sï¼ˆå¯è‡ªå®šä¹‰ç«¯å£ï¼‰</p>
</li>
<li>
<p>è‡ªåŠ¨åŠ å…¥ <code>--tls-san NAS_IP</code></p>
</li>
<li>
<p>è‡ªåŠ¨å¯¼å‡ºå¹¶ä¿®å¤ kubeconfig</p>
</li>
<li>
<p>è‡ªåŠ¨åˆ›å»º <code>alias k=kubectl</code></p>
</li>
</ul>
<p>ä½ åªéœ€è¦å‘Šè¯‰æˆ‘ï¼š</p>
<p>ğŸ‘‰ ä½ çš„ NAS IPï¼ˆç¡®è®¤ï¼‰<br>
ğŸ‘‰ ä½ çš„ç«¯å£æ˜¯å¦å›ºå®šï¼š8888 / 4433 / 6444</p>
<p>æˆ‘å³å¯ç”Ÿæˆå®Œæ•´è‡ªåŠ¨åŒ–è„šæœ¬ã€‚</p>

      </div>
      
      
    
    
    <script type="module">
// TODO: If ZenUML gets integrated into mermaid in the future,
//      we can remove the following lines.


var MERMAID_CONFIG = ({"startOnLoad":false});
if (typeof MERMAID_CONFIG !== 'undefined') {
  MERMAID_CONFIG.startOnLoad = false
  MERMAID_CONFIG.cloneCssStyles = false
  MERMAID_CONFIG.theme = "default"
}

mermaid.initialize(MERMAID_CONFIG || {})
if (typeof(window['Reveal']) !== 'undefined') {
  function mermaidRevealHelper(event) {
    var currentSlide = event.currentSlide
    var diagrams = currentSlide.querySelectorAll('.mermaid')
    for (var i = 0; i < diagrams.length; i++) {
      var diagram = diagrams[i]
      if (!diagram.hasAttribute('data-processed')) {
        mermaid.init(null, diagram, ()=> {
          Reveal.slide(event.indexh, event.indexv)
        })
      }
    }
  }
  Reveal.addEventListener('slidetransitionend', mermaidRevealHelper)
  Reveal.addEventListener('ready', mermaidRevealHelper)
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
} else {
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
}
</script>
    
    
    
  
    </body></html>