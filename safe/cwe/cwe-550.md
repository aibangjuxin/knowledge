https://cwe.mitre.org/data/definitions/550.html

é’ˆå¯¹ CWE-550: Information Exposure Through Server Error Messageï¼ˆæœåŠ¡ç«¯é”™è¯¯ä¿¡æ¯æ³„éœ²ï¼‰æ¼æ´ï¼Œæˆ‘çš„é“¾è·¯æ˜¯ï¼š

```
Client --> Nginx(7å±‚) --> Nginx(4å±‚) --> Kong DP --> Kong RT(Java)
```

è¿™ä¸ªæ¼æ´çš„æ ¸å¿ƒé—®é¢˜åœ¨äºï¼š**å†…éƒ¨é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚ stacktraceã€exception messageã€server signature ç­‰ï¼‰è¢«è¿”å›ç»™å®¢æˆ·ç«¯**ï¼Œå¯èƒ½æ³„éœ²æ•æ„Ÿå®ç°ç»†èŠ‚ï¼Œæ”»å‡»è€…å¯ä»¥å€Ÿæ­¤å‘èµ·è¿›ä¸€æ­¥æ”»å‡»ï¼ˆå¦‚è·¯å¾„æ¢æµ‹ã€å‘½ä»¤æ³¨å…¥ã€æ•æ„Ÿæ¥å£è°ƒç”¨ç­‰ï¼‰ã€‚

---

## **ä¸€ã€å¸¸è§æ³„éœ²ç‚¹**

|**å±‚çº§**|**æ³„éœ²å†…å®¹ç¤ºä¾‹**|
|---|---|
|Java åº”ç”¨ï¼ˆKong RTï¼‰|NullPointerException, SQLException, StackTrace, Java ç±»è·¯å¾„ç­‰|
|Kong DP|Upstream è¿æ¥å¤±è´¥åŸå§‹è¿”å›ï¼Œä¾‹å¦‚ "An unexpected error occurred"|
|Nginx|é»˜è®¤çš„ 500, 502, 504 ç­‰é”™è¯¯é¡µé¢ä¸­å«æœ‰ nginx/1.x.x ç­‰ç‰ˆæœ¬ä¿¡æ¯|
|å“åº”å¤´|Server: nginx, X-Powered-By: Java/1.8, Via, X-Kong-* ç­‰å¤´ä¿¡æ¯|

---

## **äºŒã€ä¿®å¤å»ºè®®ï¼ˆé€å±‚ï¼‰**

  

### **1.**Â 

### **Java åº”ç”¨ï¼ˆKong RTï¼‰**

  

ç¡®ä¿åº”ç”¨ä¸ä¼šåœ¨è¿”å›å“åº”æ—¶æš´éœ²é”™è¯¯ç»†èŠ‚ï¼š

```
// ä¸åº”è¯¥ç›´æ¥è¿”å›å¼‚å¸¸ä¿¡æ¯ç»™ç”¨æˆ·
try {
    // logic
} catch (Exception e) {
    logger.error("Internal error", e); // log it
    response.sendError(500, "Internal Server Error"); // or return sanitized JSON
}
```

âœ… å»ºè®®ç»Ÿä¸€ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ˆå¦‚ Spring çš„ @ControllerAdviceï¼‰æ‹¦æˆªå¼‚å¸¸å¹¶è¿”å›ç»Ÿä¸€æ ¼å¼ï¼š

```
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(Exception.class)
    public ResponseEntity<?> handleAllExceptions(Exception ex) {
        // ä¸æš´éœ² ex.getMessage() åˆ°å¤–éƒ¨
        return ResponseEntity.status(500).body(Map.of("error", "Internal Server Error"));
    }
}
```

---

### **2.**Â 

### **Kong Gateway (DP å’Œ RT)**

  

#### **a. å±è”½ Kong å“åº”å¤´ï¼š**

  

åœ¨ kong.conf ä¸­é…ç½®ï¼š

```
headers = off
```

æˆ–è€…åœ¨ GKE/K8S ä¸­é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥ï¼š

```
env:
  - name: KONG_HEADERS
    value: "off"
```

#### **b. è‡ªå®šä¹‰é”™è¯¯å“åº”ï¼š**

  

ä½¿ç”¨æ’ä»¶å¦‚ [response-transformer](https://docs.konghq.com/hub/kong-inc/response-transformer/) æˆ– [custom plugin]ï¼Œå¯¹ 500 é”™è¯¯è¿›è¡Œæ‹¦æˆªå’Œå†…å®¹æ›¿æ¢ã€‚

---

### **3.**Â 

### **Nginx å±‚ï¼ˆ7å±‚å’Œ4å±‚ï¼‰**

  

#### **a. å…³é—­ç‰ˆæœ¬å·æ³„éœ²**

```
server_tokens off;  # ç¦æ­¢åœ¨ header ä¸­æ˜¾ç¤º nginx/x.x.x
```

#### **b. è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼ˆé¿å…æ˜¾ç¤ºé»˜è®¤500/502/504é¡µé¢å†…å®¹ï¼‰**

```
error_page 500 502 503 504 /custom_50x.html;

location = /custom_50x.html {
    root /etc/nginx/html;
    internal;
}
```

#### **c. ç§»é™¤ Server headerï¼ˆå¦‚æœé»˜è®¤é…ç½®æ²¡ç§»é™¤ï¼‰**

```
proxy_hide_header Server;
more_clear_headers Server;
```

> âš ï¸ more_clear_headers éœ€è¦é…åˆ headers-more æ¨¡å—ï¼ŒKong è‡ªå¸¦æ”¯æŒã€‚

---

### **4.**Â 

### **é¢å¤–å»ºè®®ï¼šCloud Armor / WAF**

  

å¦‚æœä½ ä½¿ç”¨ GCPï¼Œå¯ä»¥åœ¨å‰ç½®åŠ  Cloud Armorï¼Œæ£€æµ‹å¹¶é˜»æ–­æ‰«æ/æ¢æµ‹ç±»è¯·æ±‚ï¼Œå¹¶ç»Ÿä¸€å“åº”ç»“æ„ï¼Œé˜²æ­¢è¿‡åº¦æš´éœ²å†…éƒ¨ç»“æ„ï¼š

```
rules:
  - action: deny(403)
    expression: "request.path.matches('/admin/.*') || origin.region_code != 'JP'"
```

---

## **ä¸‰ã€ç¤ºæ„ä¿®å¤æµç¨‹å›¾ï¼ˆMermaidï¼‰**

```mermaid
flowchart TD
    Client --> Nginx7
    Nginx7 --> Nginx4
    Nginx4 --> KongDP
    KongDP --> KongRT

    subgraph ä¿®å¤æªæ–½
        A[å…³é—­ Nginx server_tokens]
        B[è®¾ç½® error_page è‡ªå®šä¹‰ 500 é”™è¯¯å“åº”]
        C[Java ç«¯ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼ˆä¸æš´éœ²å¼‚å¸¸ä¿¡æ¯ï¼‰]
        D[Kong å…³é—­ header å’Œ response debug ä¿¡æ¯]
        E[è®¾ç½® Cloud Armor æˆ– Lua æ’ä»¶æ‹¦æˆªå¼‚å¸¸]
    end
```

---

## **å››ã€æ£€æŸ¥æ¸…å•**

|**æ£€æŸ¥é¡¹**|**å·²å¤„ç†**|**è¯´æ˜**|
|---|---|---|
|Java åº”ç”¨æ˜¯å¦ç»Ÿä¸€å¤„ç†å¼‚å¸¸|âœ… / â›”|ä¸è¿”å› stacktrace ç­‰|
|Kong æ˜¯å¦å…³é—­ X-Kong-* header|âœ… / â›”|KONG_HEADERS=off|
|Nginx æ˜¯å¦å…³é—­ server_tokens|âœ… / â›”|server_tokens off;|
|æ˜¯å¦ä½¿ç”¨ error_page è‡ªå®šä¹‰é”™è¯¯é¡µé¢|âœ… / â›”|é˜²æ­¢æš´éœ²é»˜è®¤500é¡µé¢|
|æ˜¯å¦ç§»é™¤å“åº”å¤´ Server/X-Powered-By|âœ… / â›”|more_clear_headers Server|
|æ˜¯å¦éƒ¨ç½² Cloud Armor WAF|âœ… / â›”|å¯ä½œä¸ºé˜²å¾¡åŠ å±‚|

---

å¦‚æœä½ èƒ½æä¾›ç¤ºä¾‹å“åº”å¤´æˆ–å®é™…é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘å¯ä»¥å¸®ä½ è¿›ä¸€æ­¥åˆ¤æ–­æ³„éœ²ç‚¹ã€‚æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ å†™ä¸€æ®µ Lua æ’ä»¶ç¤ºä¾‹ï¼Œç”¨äº Kong DP æ‹¦æˆªé”™è¯¯å“åº”å†…å®¹ï¼Ÿ


é’ˆå¯¹ CWE-550: ä¿¡æ¯æ³„éœ²ï¼ˆInternal Server Errorï¼‰ æ¼æ´ï¼Œåœ¨ä½ å½“å‰çš„æ¶æ„ä¸­ï¼š

```
Client --> Nginx (L7ç»Ÿä¸€å…¥å£) --> Nginx (L4) --> Kong DP --> Kong RT (Java åº”ç”¨)
```

ä¸”ä½ åœ¨ Nginx L7 å±‚æ˜¯åšç»Ÿä¸€å…¥å£ï¼Œæ ¹æ® api_name åŒ¹é… location å† proxy_passã€‚

---

## **âœ…**Â 

## **æœ€ä½³ä¿®å¤ç€æ‰‹ç‚¹ä¼˜å…ˆçº§å»ºè®®ï¼ˆä»å¤–å¾€å†…é˜²æŠ¤åŸåˆ™ï¼‰**

|**ä¼˜å…ˆçº§**|**å±‚çº§**|**åŸå› **|**è¯´æ˜**|
|---|---|---|---|
|â­ï¸â­ï¸â­ï¸ ç¬¬ä¸€ä¼˜å…ˆ|**Nginx L7ï¼ˆç»Ÿä¸€å…¥å£ï¼‰**|å¤–å±‚æ˜¯æœ€é è¿‘ç”¨æˆ·ï¼Œæœ€å®¹æ˜“æ‹¦æˆª/æ”¹å†™æ³„éœ²å†…å®¹|- å±è”½ç‰ˆæœ¬ä¿¡æ¯- è‡ªå®šä¹‰é”™è¯¯å“åº”- ç§»é™¤ Server å¤´éƒ¨- å¯¹ä¸‹æ¸¸ 500/502 ç­‰é”™è¯¯åŒ…è¿›è¡Œç»Ÿä¸€å¤„ç†|
|â­ï¸â­ï¸ ç¬¬äºŒä¼˜å…ˆ|**Kong DP**|é»˜è®¤ä¼šå¸¦ X-Kong-* headerï¼Œéƒ¨åˆ†æ’ä»¶å¯èƒ½è¿”å› debug å†…å®¹|- è®¾ç½® headers = off- ä½¿ç”¨ Lua æ’ä»¶ç»Ÿä¸€å¤„ç†é”™è¯¯å“åº”ï¼ˆå¯è„±æ•ï¼‰|
|â­ï¸â­ï¸ ç¬¬äºŒä¼˜å…ˆ|**Kong RT (Java åº”ç”¨)**|å¦‚æœé€»è¾‘å±‚ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œä»»ä½•ä¿æŠ¤éƒ½å¯èƒ½å¤±æ•ˆ|- ä½¿ç”¨ @ControllerAdvice æˆ–ç»Ÿä¸€å¼‚å¸¸æ‹¦æˆªå™¨- ç¦æ­¢æŠŠå¼‚å¸¸ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯|
|â­ï¸ ç¬¬ä¸‰ä¼˜å…ˆ|**Nginx L4**|æ— é€»è¾‘èƒ½åŠ›ï¼Œä½œç”¨ä¸»è¦åœ¨ç½‘ç»œå±‚|- æ— éœ€å¤„ç†ï¼Œä»…ä½œä¸ºé€æ˜å±‚è½¬å‘å³å¯|

---

## **ğŸ›  æ¨èä¿®å¤é¡ºåºå’Œé…ç½®å»ºè®®**

  

### **ç¬¬ä¸€æ­¥ï¼šNginx L7**

  

#### **1. å±è”½ç‰ˆæœ¬å·å’Œ**Â 

#### **Server**

#### Â **å“åº”å¤´**

```
server_tokens off;

proxy_hide_header Server;
more_clear_headers Server;  # å¦‚æœæ”¯æŒ headers-more æ¨¡å—
```

#### **2. è‡ªå®šä¹‰é”™è¯¯å“åº”é¡µé¢ï¼Œé¿å…é»˜è®¤ 502/504 è¾“å‡ºæ³„éœ² Kong/Nginx å†…éƒ¨çŠ¶æ€**

```
error_page 500 502 503 504 /custom_50x.html;

location = /custom_50x.html {
    root /etc/nginx/html;
    internal;
}
```

#### **3. ç»Ÿä¸€ proxy_pass å¹¶éšè— Kong è¿”å›é”™è¯¯çš„ detailï¼ˆå¦‚ StackTraceï¼‰**

```
location ~ ^/api/(?<api_name>[^/]+)/ {
    proxy_pass http://backend_$api_name;
    
    # é™åˆ¶ header æ³„éœ²
    proxy_hide_header X-Kong-Error-Code;
    proxy_hide_header X-Kong-Response-Latency;
    proxy_intercept_errors on;
}
```

---

### **ç¬¬äºŒæ­¥ï¼šKong DP**

  

#### **1. é…ç½®éšè—å“åº”å¤´**

  

åœ¨ kong.conf æˆ–ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ï¼š

```
headers = off
```

#### **2. å¯é€‰ï¼šå†™ä¸€ä¸ªç®€æ˜“ Lua æ’ä»¶ç»Ÿä¸€å¤„ç†é”™è¯¯å“åº”**

```
-- handler.lua
local BasePlugin = require "kong.plugins.base_plugin"
local handler = BasePlugin:extend()

function handler:access(conf)
  handler.super.access(self)
end

function handler:header_filter(conf)
  handler.super.header_filter(self)

  if ngx.status >= 500 then
    ngx.header["Content-Type"] = "application/json"
    ngx.header["X-Custom-Error"] = "internal_error"
    ngx.header["X-Kong-Error-Code"] = nil
    ngx.header["X-Kong-Response-Latency"] = nil
    ngx.header["Server"] = nil
    ngx.arg[1] = '{"error":"Internal Server Error"}'
  end
end

return handler
```

---

### **ç¬¬ä¸‰æ­¥ï¼šJava åº”ç”¨ï¼ˆKong RTï¼‰**

  

ç¡®ä¿ä½ ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œä¸å‘å®¢æˆ·ç«¯è¿”å›ä»»ä½•å†…éƒ¨å †æ ˆä¿¡æ¯ï¼š

```
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(Exception.class)
    public ResponseEntity<Map<String, String>> handle(Exception e) {
        // logging å¯ä¿ç•™å †æ ˆæ—¥å¿—
        log.error("Unhandled exception", e);
        return ResponseEntity.status(500).body(Map.of("error", "Internal Server Error"));
    }
}
```

---

## **ğŸ” æœ€ç»ˆå»ºè®®æµç¨‹å›¾**

```
graph TD;
    A[Client] --> B[Nginx L7 ç»Ÿä¸€å…¥å£];
    B --> C[Nginx L4];
    C --> D[Kong DP];
    D --> E[Kong RT - Java];

    subgraph å®‰å…¨å¤„ç†å»ºè®®
        B1[server_tokens off]
        B2[proxy_hide_header]
        B3[error_page 500 è‡ªå®šä¹‰]
        D1[KONG_HEADERS=off]
        D2[Lua æ’ä»¶è„±æ•é”™è¯¯ä¿¡æ¯]
        E1[å…¨å±€å¼‚å¸¸å¤„ç†å™¨ @ControllerAdvice]
    end

    B -->|å¤„ç†| B1 & B2 & B3
    D -->|é…ç½®| D1 & D2
    E -->|ä»£ç | E1
```

---

## **âœ… æ€»ç»“**

  

> **æœ€ä½³èµ·ç‚¹ï¼šä» Nginx L7 ç€æ‰‹**ã€‚å®ƒæ˜¯å¯¹ç”¨æˆ·å“åº”çš„ç¬¬ä¸€é“é˜²çº¿ï¼Œé…ç½®ç®€å•ã€æ•ˆæœç›´æ¥ã€‚

  

ç„¶åï¼š

- æ§åˆ¶ Kong çš„ headers å’Œæ’ä»¶è¡Œä¸ºï¼›
    
- æœ€åç¡®ä¿ Java åº”ç”¨ä¸è¾“å‡ºå†…éƒ¨ç»†èŠ‚ï¼›
    
- æ‰€æœ‰ 500 ç³»åˆ—é”™è¯¯éƒ½ç»Ÿä¸€å“åº” "Internal Server Error"ã€‚
    

  

éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆå®Œæ•´çš„ Nginx é…ç½®æ¨¡æ¿æˆ– Lua æ’ä»¶ demo å—ï¼Ÿ


ä»¥ä¸‹æ˜¯ä¸€ä¸ªé’ˆå¯¹ä½ æ¶æ„åœºæ™¯ï¼ˆNginx L7 ä½œä¸ºç»Ÿä¸€å…¥å£ï¼Œåç«¯ä¸º Nginx4ã€Kong DPã€Kong RTï¼‰çš„å®‰å…¨å¼ºåŒ– **Nginx é…ç½®æ¨¡æ¿**ï¼Œå¯æœ‰æ•ˆç¼“è§£ CWE-550 ç­‰ä¿¡æ¯æ³„éœ²é£é™©ï¼š

---

```
# nginx.conf ç¤ºä¾‹ç‰‡æ®µï¼ˆæ¨èä½œä¸º L7 å±‚ç»Ÿä¸€å…¥å£ Nginx ä½¿ç”¨ï¼‰

server {
    listen 443 ssl http2;
    server_name api.example.com;

    ssl_certificate     /etc/nginx/ssl/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/privkey.pem;

    # âœ… å®‰å…¨æ¨èï¼šéšè— Nginx è‡ªèº«ç‰ˆæœ¬
    server_tokens off;

    # âœ… è®¾ç½®åˆç†çš„è¿”å›å¤´éƒ¨ï¼Œé¿å…æš´éœ²åç«¯æœåŠ¡ä¿¡æ¯
    proxy_hide_header Server;
    proxy_hide_header X-Kong-Error-Code;
    proxy_hide_header X-Kong-Response-Latency;

    # å¦‚æœå¯ç”¨äº† headers-more æ¨¡å—ï¼ˆå»ºè®®å¼€å¯ï¼‰
    more_clear_headers Server;
    more_clear_headers X-Powered-By;
    more_clear_headers X-Kong-Error-Code;
    more_clear_headers X-Kong-Response-Latency;

    # âœ… é¿å…ç›´æ¥æ˜¾ç¤ºåç«¯ 5xx é”™è¯¯
    proxy_intercept_errors on;

    # âœ… è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼ˆå¯ä»¥ç®€å•è¿”å› JSONï¼Œä¹Ÿå¯ä»¥è¿”å› HTMLï¼‰
    error_page 500 502 503 504 /custom_50x.html;

    location = /custom_50x.html {
        internal;
        default_type application/json;
        return 500 '{"error":"Internal Server Error"}';
    }

    # âœ… åŠ¨æ€åŒ¹é…è·¯å¾„ï¼ŒåŸºäº api_name åš proxy_pass
    location ~ ^/api/(?<api_name>[a-zA-Z0-9_-]+)/ {
        # å‡è®¾åç«¯æœ‰å¤šä¸ª service å¯åŠ¨æ€åŒ¹é…ï¼Œä¹Ÿå¯å†™æˆä¸€ä¸ªç»Ÿä¸€çš„ upstream
        proxy_pass http://kong_upstream$request_uri;

        # æ¨èè®¾ç½®
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_http_version 1.1;
        proxy_connect_timeout 5s;
        proxy_read_timeout 10s;

        # éšè— Kong è¿”å›çš„ debug header
        proxy_hide_header X-Kong-Upstream-Latency;
        proxy_hide_header X-Kong-Proxy-Latency;
        proxy_hide_header Via;
    }

    # å¯é€‰ï¼šæ‹¦æˆªå…¶ä»–æœªåŒ¹é…è·¯å¾„
    location / {
        return 404 '{"error":"Not Found"}';
        default_type application/json;
    }
}
```

---

## **âœ… é…ç½®è¯´æ˜**

|**é¡¹ç›®**|**è¯´æ˜**|
|---|---|
|server_tokens off|éšè— Nginx è‡ªèº«ç‰ˆæœ¬å·|
|proxy_hide_header|å±è”½åç«¯ä¼ æ¥çš„ Serverã€X-Kong-* ç­‰æ³„éœ²å¤´éƒ¨|
|error_page + return JSON|è‡ªå®šä¹‰é”™è¯¯å†…å®¹ï¼Œé˜²æ­¢åç«¯å¼‚å¸¸å†…å®¹ç›´æ¥æš´éœ²|
|proxy_intercept_errors|ä½¿å¾—è‡ªå®šä¹‰ error_page ç”Ÿæ•ˆ|
|location ~ /api/...|åŠ¨æ€åŒ¹é… API åï¼Œæ”¯æŒçµæ´»æ‰©å±•|
|default_type application/json|ç»Ÿä¸€è¾“å‡º JSON é”™è¯¯ä¿¡æ¯|

---

## **â›³ï¸ æ¸©é¦¨æç¤º**

- å¦‚æœä½ æ²¡æœ‰ headers-more æ¨¡å—æ”¯æŒï¼Œå¯ä»¥åˆ é™¤ more_clear_headers éƒ¨åˆ†ï¼Œä½†æ¨èä½¿ç”¨å¸¦è¯¥æ¨¡å—çš„æ„å»ºã€‚
    
- proxy_pass ä¹‹åä¸å»ºè®®ä½¿ç”¨ $1 è¿™ç§æ‹¼æ¥åŠ¨æ€å˜é‡å»æ‹¼åç«¯åœ°å€ï¼Œæ¨èç»Ÿä¸€çš„ kong_upstream åç§°ç”± upstream æ¥åšæœåŠ¡è§£æï¼ˆæ›´ç¨³å®šå¯æ§ï¼‰ã€‚
    

---

éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆå¯¹åº”çš„ upstream é…ç½®æˆ–åŸºäº api_name çš„åŠ¨æ€è·¯ç”±ç¤ºä¾‹ä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ã€‚



# Grok
# CWE-550: æœåŠ¡ç«¯é”™è¯¯ä¿¡æ¯æ³„éœ²ä¿®å¤æ–¹æ¡ˆ

é’ˆå¯¹ CWE-550 æ¼æ´ï¼ˆInformation Exposure Through Server Error Messageï¼‰ï¼Œæ‚¨çš„é“¾è·¯ä¸º `Client --> Nginx(7å±‚) --> Nginx(4å±‚) --> Kong DP --> Kong RT(Java)`ï¼Œä»¥ä¸‹æ˜¯ä¿®å¤è¯¥æ¼æ´çš„æœ€ä½³å®è·µæ–¹æ¡ˆã€‚æˆ‘å°†ä»é—®é¢˜æ ¸å¿ƒå…¥æ‰‹ï¼Œåˆ†æå¦‚ä½•é˜²æ­¢å†…éƒ¨é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚ stacktraceã€exception messageã€server signature ç­‰ï¼‰æ³„éœ²ç»™å®¢æˆ·ç«¯ï¼Œå¹¶æä¾›è¯¦ç»†çš„æ­¥éª¤å’Œé…ç½®ç¤ºä¾‹ã€‚

## é—®é¢˜æ ¸å¿ƒåˆ†æ

CWE-550 æ¼æ´çš„å…³é”®åœ¨äºæœåŠ¡ç«¯åœ¨å‘ç”Ÿé”™è¯¯æ—¶è¿”å›äº†è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯èƒ½åŒ…å«æ•æ„Ÿçš„å®ç°ç»†èŠ‚ï¼ˆå¦‚ä»£ç è·¯å¾„ã€å †æ ˆè·Ÿè¸ªã€æœåŠ¡å™¨ç‰ˆæœ¬ç­‰ï¼‰ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›ä¿¡æ¯è¿›è¡Œè¿›ä¸€æ­¥æ”»å‡»ï¼Œä¾‹å¦‚è·¯å¾„éå†ã€å‘½ä»¤æ³¨å…¥æˆ–é’ˆå¯¹ç‰¹å®šç‰ˆæœ¬çš„æ¼æ´åˆ©ç”¨ã€‚

åœ¨æ‚¨çš„é“¾è·¯ä¸­ï¼Œé”™è¯¯ä¿¡æ¯å¯èƒ½åœ¨ä»¥ä¸‹ç¯èŠ‚æ³„éœ²ï¼š
1. **åç«¯ Kong RT (Java)**ï¼šJava åº”ç”¨ç¨‹åºå¯èƒ½åœ¨å¼‚å¸¸æ—¶è¿”å›è¯¦ç»†çš„ stacktraceã€‚
2. **Kong DP (Data Plane)**ï¼šKong ç½‘å…³å¯èƒ½æœªå¯¹åç«¯è¿”å›çš„é”™è¯¯ä¿¡æ¯è¿›è¡Œè¿‡æ»¤ã€‚
3. **Nginx (4å±‚/7å±‚)**ï¼šNginx å¯èƒ½ç›´æ¥è½¬å‘é”™è¯¯ä¿¡æ¯æˆ–è‡ªèº«äº§ç”Ÿå¸¦æœ‰æœåŠ¡å™¨ç­¾åçš„é”™è¯¯é¡µé¢ã€‚

ä¿®å¤ç›®æ ‡æ˜¯ç¡®ä¿åœ¨æ•´ä¸ªé“¾è·¯ä¸Šï¼Œé”™è¯¯ä¿¡æ¯è¢«è§„èŒƒåŒ–ï¼Œæ•æ„Ÿä¿¡æ¯è¢«éšè—æˆ–æ›¿æ¢ä¸ºé€šç”¨çš„é”™è¯¯æç¤ºã€‚

---

## ä¿®å¤æ–¹æ¡ˆä¸æœ€ä½³å®è·µ

### 1. ä»åç«¯ (Kong RT - Java) å…¥æ‰‹ï¼šè§„èŒƒåŒ–é”™è¯¯å“åº”
Java åº”ç”¨ç¨‹åºæ˜¯é”™è¯¯ä¿¡æ¯çš„æºå¤´ï¼Œé¦–å…ˆéœ€è¦ç¡®ä¿åç«¯ä¸ä¼šå°†è¯¦ç»†çš„ stacktrace æˆ–å¼‚å¸¸ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

#### æ­¥éª¤ï¼š
- **å…¨å±€å¼‚å¸¸å¤„ç†**ï¼šåœ¨ Java åº”ç”¨ä¸­å®ç°å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œæ•è·æ‰€æœ‰æœªå¤„ç†çš„å¼‚å¸¸ï¼Œå¹¶è¿”å›æ ‡å‡†åŒ–çš„é”™è¯¯å“åº”ã€‚
- **ç¦ç”¨è¯¦ç»†é”™è¯¯ä¿¡æ¯**ï¼šç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç¦ç”¨è°ƒè¯•æ¨¡å¼ï¼Œé¿å…è¿”å› stacktraceã€‚
- **æ—¥å¿—åˆ†ç¦»**ï¼šå°†è¯¦ç»†é”™è¯¯ä¿¡æ¯è®°å½•åˆ°æœåŠ¡å™¨æ—¥å¿—ä¸­ï¼Œè€Œä¸æ˜¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

#### ç¤ºä¾‹ä»£ç  (Spring Boot)ï¼š
```java
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.context.request.WebRequest;

@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(Exception.class)
    public ResponseEntity<?> handleGlobalException(Exception ex, WebRequest request) {
        // è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯åˆ°æ—¥å¿—
        log.error("Internal Server Error: ", ex);
      
        // è¿”å›æ ‡å‡†åŒ–é”™è¯¯å“åº”
        return new ResponseEntity<>("Internal Server Error. Please contact support.", HttpStatus.INTERNAL_SERVER_ERROR);
    }
}
```

#### é…ç½®ç”Ÿäº§ç¯å¢ƒï¼š
åœ¨ `application.properties` ä¸­ç¦ç”¨è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š
```properties
server.error.include-stacktrace=never
server.error.include-exception=false
server.error.include-message=never
```

---

### 2. åœ¨ Kong DP (Data Plane) é…ç½®é”™è¯¯å¤„ç†æ’ä»¶
Kong ä½œä¸º API ç½‘å…³ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶å¯¹åç«¯è¿”å›çš„é”™è¯¯ä¿¡æ¯è¿›è¡Œè¿‡æ»¤å’Œè§„èŒƒåŒ–ï¼Œç¡®ä¿æ•æ„Ÿä¿¡æ¯ä¸ä¼šä¼ é€’åˆ°å®¢æˆ·ç«¯ã€‚

#### æ­¥éª¤ï¼š
- ä½¿ç”¨ Kong çš„ **Response Transformer** æ’ä»¶æˆ–è‡ªå®šä¹‰æ’ä»¶ï¼Œæ£€æŸ¥å“åº”å†…å®¹æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ "stacktrace"ã€"exception" ç­‰å…³é”®å­—ï¼‰ï¼Œå¹¶æ›¿æ¢ä¸ºé€šç”¨é”™è¯¯ä¿¡æ¯ã€‚
- é…ç½® Kong çš„ **Error Handling** ç­–ç•¥ï¼Œè¿”å›æ ‡å‡†åŒ–çš„é”™è¯¯å“åº”ã€‚

#### ç¤ºä¾‹ï¼šé…ç½® Response Transformer æ’ä»¶
```yaml
plugins:
  - name: response-transformer
    config:
      remove:
        headers:
          - Server
          - X-Powered-By
      add:
        headers:
          - "X-Error-Message: Internal Server Error"
      replace:
        body:
          - search: "stacktrace"
            replace: "Error occurred. Contact support."
```

#### é…ç½®è¯´æ˜ï¼š
- ç§»é™¤å¯èƒ½æ³„éœ²æœåŠ¡å™¨ä¿¡æ¯çš„å¤´ï¼ˆå¦‚ `Server`ã€`X-Powered-By`ï¼‰ã€‚
- æ£€æŸ¥å“åº”ä½“ä¸­æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå¹¶æ›¿æ¢ä¸ºé€šç”¨é”™è¯¯ä¿¡æ¯ã€‚

---

### 3. åœ¨ Nginx (7å±‚) é…ç½®é”™è¯¯é¡µé¢
Nginx ä½œä¸ºåå‘ä»£ç†ï¼Œå¯ä»¥æ‹¦æˆªåç«¯è¿”å›çš„é”™è¯¯å“åº”ï¼Œå¹¶è¿”å›è‡ªå®šä¹‰çš„é”™è¯¯é¡µé¢ï¼Œé¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚

#### æ­¥éª¤ï¼š
- é…ç½®è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼Œè¦†ç›–é»˜è®¤çš„é”™è¯¯å“åº”ã€‚
- ç¦ç”¨ Nginx é»˜è®¤çš„æœåŠ¡å™¨ç­¾åã€‚

#### ç¤ºä¾‹é…ç½®ï¼š
```nginx
http {
    server_tokens off; # ç¦ç”¨æœåŠ¡å™¨ç­¾åï¼Œéšè— Nginx ç‰ˆæœ¬ä¿¡æ¯

    server {
        listen 80;
        server_name example.com;

        # è‡ªå®šä¹‰é”™è¯¯é¡µé¢
        error_page 500 502 503 504 /custom_error.html;
        location = /custom_error.html {
            root /var/www/html;
            internal;
        }

        # ä»£ç†è®¾ç½®ï¼Œç¡®ä¿ä¸ç›´æ¥é€ä¼ é”™è¯¯ä¿¡æ¯
        proxy_intercept_errors on;
        proxy_pass http://kong_dp;
    }
}
```

#### è‡ªå®šä¹‰é”™è¯¯é¡µé¢ (`/var/www/html/custom_error.html`)ï¼š
```html
<!DOCTYPE html>
<html>
<head>
    <title>Internal Server Error</title>
</head>
<body>
    <h1>500 - Internal Server Error</h1>
    <p>An error occurred. Please contact support for assistance.</p>
</body>
</html>
```

---

### 4. åœ¨ Nginx (4å±‚) é…ç½® TCP é”™è¯¯å¤„ç†
å¦‚æœ 4 å±‚ Nginx ä»…ä½œä¸º TCP ä»£ç†ï¼Œé”™è¯¯ä¿¡æ¯é€šå¸¸ç”±ä¸Šå±‚å¤„ç†ã€‚ä½†ä¸ºç¡®ä¿å®‰å…¨ï¼Œå¯ä»¥é™åˆ¶å…¶æš´éœ²çš„ä¿¡æ¯ã€‚

#### æ­¥éª¤ï¼š
- ç¡®ä¿ 4 å±‚ Nginx ä¸è¿”å›ä»»ä½•è‡ªå®šä¹‰é”™è¯¯ä¿¡æ¯ï¼Œç›´æ¥è½¬å‘åˆ° 7 å±‚ã€‚
- å¦‚æœä½¿ç”¨ `stream` æ¨¡å—ï¼Œç¦ç”¨è¯¦ç»†æ—¥å¿—æˆ–é”™è¯¯ä¿¡æ¯è¾“å‡ºã€‚

#### ç¤ºä¾‹é…ç½®ï¼š
```nginx
stream {
    server {
        listen 443;
        proxy_pass kong_dp:443;
        proxy_timeout 10s;
        proxy_connect_timeout 5s;
    }
}
```

---

### 5. å…¨å±€æ£€æŸ¥ä¸æµ‹è¯•
åœ¨æ•´ä¸ªé“¾è·¯ä¸Šé…ç½®å®Œæˆåï¼Œè¿›è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š
- ä½¿ç”¨å·¥å…·ï¼ˆå¦‚ `curl`ï¼‰æ¨¡æ‹Ÿè¯·æ±‚ï¼Œè§¦å‘ 500 é”™è¯¯ï¼Œæ£€æŸ¥è¿”å›å†…å®¹æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚
- æ‰«æå“åº”å¤´ï¼Œç¡®è®¤ `Server`ã€`X-Powered-By` ç­‰å¤´å·²è¢«ç§»é™¤ã€‚
- å®¡æŸ¥æœåŠ¡å™¨æ—¥å¿—ï¼Œç¡®ä¿è¯¦ç»†é”™è¯¯ä¿¡æ¯è¢«è®°å½•ï¼Œè€Œéè¿”å›ç»™å®¢æˆ·ç«¯ã€‚

#### ç¤ºä¾‹ï¼šæµ‹è¯•å‘½ä»¤
```bash
curl -X GET http://example.com/invalid_endpoint -v
```

æ£€æŸ¥è¾“å‡ºä¸­æ˜¯å¦åŒ…å« stacktrace æˆ–æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯ã€‚

---

## æµç¨‹å›¾ï¼šé”™è¯¯ä¿¡æ¯å¤„ç†æµç¨‹

```mermaid
graph TD;
    A[å®¢æˆ·ç«¯è¯·æ±‚] --> B[Nginx 7å±‚];
    B -->|è½¬å‘è¯·æ±‚| C[Nginx 4å±‚];
    C -->|è½¬å‘è¯·æ±‚| D[Kong DP];
    D -->|è½¬å‘è¯·æ±‚| E[Kong RT Java];
    E -->|å‘ç”Ÿé”™è¯¯| F[Java å…¨å±€å¼‚å¸¸å¤„ç†];
    F -->|è®°å½•æ—¥å¿—å¹¶è¿”å›æ ‡å‡†é”™è¯¯| D;
    D -->|Response Transformer è¿‡æ»¤æ•æ„Ÿä¿¡æ¯| B;
    B -->|è‡ªå®šä¹‰é”™è¯¯é¡µé¢| A;
```

---

## æ€»ç»“ä¸å»ºè®®

ä¿®å¤ CWE-550 æ¼æ´çš„æ ¸å¿ƒåœ¨äº**å¤šå±‚é˜²å¾¡**ï¼Œä»æºå¤´ï¼ˆJava åº”ç”¨ï¼‰åˆ°ä¸­é—´å±‚ï¼ˆKongã€Nginxï¼‰é€å±‚è¿‡æ»¤å’Œè§„èŒƒåŒ–é”™è¯¯ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¼˜å…ˆçº§å»ºè®®ï¼š
1. **ä¼˜å…ˆä¿®å¤åç«¯ (Java)**ï¼šç¡®ä¿æºå¤´ä¸æ³„éœ²è¯¦ç»†ä¿¡æ¯ã€‚
2. **é…ç½® Kong æ’ä»¶**ï¼šé€šè¿‡ç½‘å…³è¿‡æ»¤æ•æ„Ÿä¿¡æ¯ã€‚
3. **ä¼˜åŒ– Nginx é…ç½®**ï¼šè‡ªå®šä¹‰é”™è¯¯é¡µé¢å¹¶ç¦ç”¨æœåŠ¡å™¨ç­¾åã€‚
4. **å®šæœŸæµ‹è¯•**ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚ OWASP ZAPï¼‰æ‰«æ API å“åº”ï¼Œæ£€æŸ¥æ˜¯å¦ä»æœ‰ä¿¡æ¯æ³„éœ²ã€‚

å¦‚æœæ‚¨æœ‰å…·ä½“çš„ç¯å¢ƒé…ç½®æˆ–é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥è¿›ä¸€æ­¥æä¾›ç»†èŠ‚ï¼Œæˆ‘ä¼šé’ˆå¯¹æ€§æä¾›æ›´è¯¦ç»†çš„æŒ‡å¯¼ã€‚


#  Claude
é’ˆå¯¹CWE-550æ¼æ´ï¼Œéœ€è¦åœ¨æ•´ä¸ªé“¾è·¯çš„æ¯ä¸€å±‚éƒ½å®æ–½é”™è¯¯ä¿¡æ¯è¿‡æ»¤ã€‚ä»¥ä¸‹æ˜¯æœ€ä½³å®è·µæ–¹æ¡ˆï¼š

## ä¿®å¤ç­–ç•¥æ¦‚è§ˆ

```mermaid
flowchart TD
    A[Client] --> B[Nginx 7å±‚]
    B --> C[Nginx 4å±‚]
    C --> D[Kong DP]
    D --> E[Kong RT Java]
    
    B --> B1[é”™è¯¯é¡µé¢å®šåˆ¶]
    C --> C1[é€šç”¨é”™è¯¯å“åº”]
    D --> D1[é”™è¯¯è½¬æ¢æ’ä»¶]
    E --> E1[å¼‚å¸¸å¤„ç†å™¨]
    
    style B1 fill:#ffcccc
    style C1 fill:#ffcccc
    style D1 fill:#ffcccc
    style E1 fill:#ffcccc
```

## 1. Kong RT (Java) - æºå¤´æ§åˆ¶

### å…¨å±€å¼‚å¸¸å¤„ç†å™¨

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    private static final Logger logger = LoggerFactory.getLogger(GlobalExceptionHandler.class);
    
    @ExceptionHandler(Exception.class)
    public ResponseEntity<ErrorResponse> handleGenericException(Exception ex, HttpServletRequest request) {
        // è®°å½•è¯¦ç»†é”™è¯¯ä¿¡æ¯åˆ°æ—¥å¿—
        logger.error("Unhandled exception for request: {}", request.getRequestURI(), ex);
        
        // è¿”å›é€šç”¨é”™è¯¯ä¿¡æ¯
        ErrorResponse error = ErrorResponse.builder()
            .code("INTERNAL_ERROR")
            .message("An internal error occurred")
            .timestamp(Instant.now())
            .build();
            
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(error);
    }
    
    @ExceptionHandler(ValidationException.class)
    public ResponseEntity<ErrorResponse> handleValidationException(ValidationException ex) {
        ErrorResponse error = ErrorResponse.builder()
            .code("VALIDATION_ERROR")
            .message("Invalid request parameters")
            .timestamp(Instant.now())
            .build();
            
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);
    }
}
```

### é…ç½®Spring Booté”™è¯¯å¤„ç†

```yaml
# application.yml
server:
  error:
    include-stacktrace: never
    include-message: never
    include-binding-errors: never
    include-exception: false
    
logging:
  level:
    org.springframework.web: ERROR
    org.springframework.security: ERROR
```

## 2. Kong DP - ç½‘å…³å±‚è¿‡æ»¤

### é”™è¯¯è½¬æ¢æ’ä»¶é…ç½®

```lua
-- kong/plugins/error-transformer/handler.lua
local ErrorTransformerHandler = {}

function ErrorTransformerHandler:access(conf)
    -- åœ¨accessé˜¶æ®µä¸åšå¤„ç†
end

function ErrorTransformerHandler:header_filter(conf)
    local status = kong.response.get_status()
    
    if status >= 400 then
        -- æ¸…é™¤å¯èƒ½æ³„éœ²ä¿¡æ¯çš„å¤´éƒ¨
        kong.response.clear_header("Server")
        kong.response.clear_header("X-Powered-By")
        kong.response.clear_header("X-Runtime")
    end
end

function ErrorTransformerHandler:body_filter(conf)
    local status = kong.response.get_status()
    
    if status >= 500 then
        -- æ›¿æ¢5xxé”™è¯¯çš„å“åº”ä½“
        local generic_error = {
            error = {
                code = "INTERNAL_ERROR",
                message = "An internal error occurred"
            }
        }
        
        kong.response.set_header("Content-Type", "application/json")
        local body = cjson.encode(generic_error)
        kong.response.set_raw_body(body)
    end
end

return ErrorTransformerHandler
```

### Kongé…ç½®

```yaml
# kong.yml
plugins:
  - name: error-transformer
    config:
      hide_server_errors: true
      custom_error_messages:
        500: "Internal server error"
        502: "Bad gateway"
        503: "Service unavailable"
        504: "Gateway timeout"
```

## 3. Nginx 4å±‚ - ä¼ è¾“å±‚å¤„ç†

```nginx
# nginx-l4.conf
stream {
    map $status $generic_error {
        ~^5 "HTTP/1.1 500 Internal Server Error\r\nContent-Type: application/json\r\n\r\n{\"error\":\"Internal server error\"}";
        default "";
    }
    
    upstream kong_upstream {
        server kong-dp:8000;
        keepalive 32;
    }
    
    server {
        listen 80;
        proxy_pass kong_upstream;
        proxy_timeout 30s;
        proxy_connect_timeout 5s;
        
        # é”™è¯¯å¤„ç†
        error_page 500 502 503 504 =500 @error_page;
    }
}
```

## 4. Nginx 7å±‚ - åº”ç”¨å±‚é˜²æŠ¤

```nginx
# nginx-l7.conf
http {
    # éšè—æœåŠ¡å™¨ä¿¡æ¯
    server_tokens off;
    more_clear_headers 'Server';
    more_clear_headers 'X-Powered-By';
    
    # è‡ªå®šä¹‰é”™è¯¯é¡µé¢
    error_page 400 401 403 404 /4xx.json;
    error_page 500 502 503 504 /5xx.json;
    
    server {
        listen 80;
        
        location /4xx.json {
            internal;
            return 400 '{"error":{"code":"CLIENT_ERROR","message":"Bad request"}}';
            add_header Content-Type application/json;
        }
        
        location /5xx.json {
            internal;
            return 500 '{"error":{"code":"INTERNAL_ERROR","message":"Internal server error"}}';
            add_header Content-Type application/json;
        }
        
        location / {
            proxy_pass http://nginx-l4;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            
            # æ‹¦æˆªé”™è¯¯å“åº”
            proxy_intercept_errors on;
            
            # éšè—ä¸Šæ¸¸é”™è¯¯
            proxy_hide_header X-Runtime;
            proxy_hide_header X-Powered-By;
        }
    }
}
```

## ä¿®å¤ä¼˜å…ˆçº§å’Œå®æ–½æ­¥éª¤

|ä¼˜å…ˆçº§|ç»„ä»¶|ä¿®å¤å†…å®¹|å½±å“èŒƒå›´|å®æ–½éš¾åº¦|
|---|---|---|---|---|
|1|Kong RT (Java)|å…¨å±€å¼‚å¸¸å¤„ç†å™¨|æ‰€æœ‰Javaåº”ç”¨é”™è¯¯|ä¸­ç­‰|
|2|Nginx 7å±‚|é”™è¯¯é¡µé¢å®šåˆ¶|æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚|ç®€å•|
|3|Kong DP|é”™è¯¯è½¬æ¢æ’ä»¶|ç½‘å…³å±‚é”™è¯¯|ä¸­ç­‰|
|4|Nginx 4å±‚|ä¼ è¾“å±‚é”™è¯¯å¤„ç†|è¿æ¥å±‚é”™è¯¯|ç®€å•|

## éªŒè¯å’Œæµ‹è¯•

### æµ‹è¯•è„šæœ¬

```bash
#!/bin/bash
# test-error-handling.sh

echo "Testing error handling..."

# æµ‹è¯•å„ç§é”™è¯¯åœºæ™¯
test_cases=(
    "GET /non-existent-endpoint"
    "POST /api/invalid-data"
    "GET /api/trigger-500-error"
)

for test_case in "${test_cases[@]}"; do
    echo "Testing: $test_case"
    response=$(curl -s -w "\nStatus: %{http_code}\n" -X ${test_case%% *} "http://your-domain${test_case##* }")
    
    # æ£€æŸ¥æ˜¯å¦åŒ…å«æ•æ„Ÿä¿¡æ¯
    if echo "$response" | grep -E "(stacktrace|exception|SQLException|java\.|org\.)" > /dev/null; then
        echo "âŒ FAIL: Response contains sensitive information"
        echo "$response"
    else
        echo "âœ… PASS: Response is clean"
    fi
    echo "---"
done
```

## ç›‘æ§å’Œå‘Šè­¦

```yaml
# prometheus-rules.yml
groups:
  - name: error-exposure
    rules:
      - alert: SensitiveErrorExposure
        expr: increase(nginx_http_requests_total{status=~"5.."}[5m]) > 10
        for: 2m
        annotations:
          summary: "High rate of 5xx errors detected"
          description: "Potential information exposure through server errors"
```

## å…³é”®è¦ç‚¹

1. **åˆ†å±‚é˜²æŠ¤**: æ¯ä¸€å±‚éƒ½è¦æœ‰é”™è¯¯å¤„ç†æœºåˆ¶
2. **æºå¤´æ§åˆ¶**: Javaåº”ç”¨å±‚æ˜¯æœ€é‡è¦çš„é˜²æŠ¤ç‚¹
3. **ç»Ÿä¸€é”™è¯¯æ ¼å¼**: æ‰€æœ‰å±‚è¿”å›ä¸€è‡´çš„é”™è¯¯å“åº”æ ¼å¼
4. **è¯¦ç»†æ—¥å¿—è®°å½•**: é”™è¯¯è¯¦æƒ…è®°å½•åˆ°æ—¥å¿—è€Œéè¿”å›ç»™å®¢æˆ·ç«¯
5. **æŒç»­ç›‘æ§**: ç›‘æ§é”™è¯¯ç‡å’Œå“åº”å†…å®¹

é€šè¿‡è¿™ä¸ªå¤šå±‚é˜²æŠ¤ç­–ç•¥ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢CWE-550æ¼æ´ï¼Œç¡®ä¿æ•æ„Ÿä¿¡æ¯ä¸ä¼šæ³„éœ²ç»™å®¢æˆ·ç«¯ã€‚