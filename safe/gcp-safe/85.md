ä¸‹é¢æˆ‘ä» GKE / Cloud Security Command Center (SCC) / Runtime Threat Detectionï¼ˆå®¹å™¨å¨èƒæ£€æµ‹ï¼‰ çš„è§’åº¦ï¼Œç»™ä½ ä¸€ä¸ª å¯ç›´æ¥ç”¨äºå®¡è®¡çš„éªŒè¯æ–¹æ³•ã€‚

â¸»

ğŸ¯ 1. â€œå¿…é¡»é…ç½®å®¹å™¨å¨èƒæ£€æµ‹â€æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ Google Cloud ä½“ç³»ä¸­ï¼š

å®¹å™¨å¨èƒæ£€æµ‹ = Security Command Center (SCC) çš„â€œContainer Threat Detection (CTD)â€åŠŸèƒ½

å®ƒä¼šï¼š
â€¢ æ£€æµ‹å®¹å™¨å†…å¯ç–‘è¡Œä¸º
â€¢ æ£€æµ‹æ¶æ„è„šæœ¬/äºŒè¿›åˆ¶
â€¢ æ£€æµ‹å¯ç–‘åŠ å¯†æŒ–çŸ¿è¿›ç¨‹
â€¢ æ£€æµ‹å®¹å™¨é€ƒé€¸å°è¯•
â€¢ æ£€æµ‹æ¶æ„ç½‘ç»œè¡Œä¸º

åœ¨ GKE é›†ç¾¤ä¸­æ­¤åŠŸèƒ½æ˜¯ é»˜è®¤å¯ç”¨å¹¶ä¸”ä¸å¯å…³é—­ã€‚

â¸»

ğŸ¯ 2. å®¹å™¨å¨èƒæ£€æµ‹åœ¨ GCP å…·ä½“ä½ç½®ï¼Ÿ

åœ¨ SCC ä¸­å±äºï¼š

Security Command Center â†’ Threat Detection â†’ Container Threat Detection

åœ¨ Premium/Standard ç‰ˆæœ¬ä¸­å‡å­˜åœ¨ã€‚

â¸»

ğŸ¯ 3. å¦‚ä½•éªŒè¯ï¼ˆæä¾›å¯ä½œä¸ºâ€œå®¡è®¡è¯æ®â€çš„æ–¹æ³•ï¼‰

ä½ éœ€è¦è¯æ˜ï¼š1. SCC å·²å¯ç”¨ 2. Container Threat Detection æ­£åœ¨è¿è¡Œæˆ–å¤„äºå¯ç”¨çŠ¶æ€ 3. èƒ½çœ‹åˆ°æ­£å¸¸ç”Ÿæˆçš„å¨èƒæ£€æµ‹ Findings

ä¸‹é¢ç»™ä½ å¯ç”¨äºå®¡è®¡æŠ¥å‘Šçš„éªŒè¯æ–¹æ³•ï¼š

â¸»

â­ æ–¹æ³• 1ï¼šæ£€æŸ¥ SCCï¼ˆSecurity Command Centerï¼‰å¯ç”¨çŠ¶æ€ï¼ˆå¿…å¤‡è¯æ®ï¼‰

gcloud scc settings get --organization=ORG_ID

ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š

state: ENABLED

â¸»

â­ æ–¹æ³• 2ï¼šåˆ—å‡ºå¯ç”¨çš„å¨èƒæ£€æµ‹æ¨¡å—ï¼ˆæœ€å…³é”®è¯æ®ï¼‰

æ‰§è¡Œï¼š

gcloud scc container-threat-detection settings describe --organization=ORG_ID

æ­£å¸¸åº”çœ‹åˆ°ï¼š

state: ENABLED

è¿™æ˜¯ Container Threat Detection å·²å¯ç”¨ä¸”ä¸èƒ½ç¦ç”¨ çš„ç›´æ¥è¯æ®ã€‚

â¸»

â­ æ–¹æ³• 3ï¼šæŸ¥çœ‹ Container Threat Detection Findingsï¼ˆå®¡è®¡æœ€å–œæ¬¢çš„è¯æ®ï¼‰

æ‰§è¡Œï¼š

gcloud scc findings list \
 --source=container-threat-detection \
 --organization=ORG_ID --limit=5

å¦‚æœç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼Œä¼šçœ‹åˆ°ç±»ä¼¼ï¼š

category: RUNNING_AS_ROOT
category: REVERSE_SHELL
category: CRYPTO_MINING

è¿™è¯æ˜ï¼š
â€¢ CTD å·²å¯ç”¨
â€¢ æ­£åœ¨å‘ç°å¹¶æŠ¥å‘Šè¡Œä¸º
â€¢ Security findings pipeline å¯ç”¨

â¸»

â­ æ–¹æ³• 4ï¼šGKE Workload Security é¡µé¢æˆªå›¾ï¼ˆå®¡è®¡å¸¸ç”¨ï¼‰

åœ¨ UIï¼š

Security â†’ Threat Detection â†’ Container Threat Detection

ä½ ä¼šçœ‹åˆ°ï¼š
â€¢ â€œå¯ç”¨ï¼ˆEnabledï¼‰â€
â€¢ â€œæ— æ³•ç¦ç”¨ï¼ˆAlways Onï¼‰â€
â€¢ æœ€è¿‘æ‰«æè®°å½•

æˆªå›¾å³å¯ä½œä¸ºè¯æ®æäº¤å®¡è®¡ã€‚

â¸»

ğŸ¯ 4. å¦‚ä½•å†™åœ¨å®¡è®¡æŠ¥å‘Šï¼ˆç›´æ¥å¯ç”¨ï¼‰

Container Threat Detection (CTD) is enabled by default in GKE and cannot be disabled.
Verification steps: 1. Verified SCC organization settings â†’ ENABLED 2. Verified CTD module state:

gcloud scc container-threat-detection settings describe --organization=ORG_ID  
â†’ state: ENABLED

    3.	Verified CTD findings exist in SCC:

gcloud scc findings list --source=container-threat-detection â€¦

è¯æ˜å®¹å™¨å¨èƒæ£€æµ‹åŠŸèƒ½å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œç¬¦åˆå®‰å…¨è¦æ±‚ã€‚

â¸»

ğŸ‰ å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥æ ¹æ® CAEP æ–‡æ¡£é£æ ¼

æˆ‘å¯ä»¥ è‡ªåŠ¨ç”Ÿæˆâ€œå®¡è®¡éªŒè¯æ¨¡æ¿ï¼ˆè¯æ®æˆªå›¾ç‚¹ + å‘½ä»¤ï¼‰â€çš„ Markdown è¡¨æ ¼ï¼Œç›´æ¥é»è´´è¿›ä½ çš„ CAEP æ–‡æ¡£ã€‚

éœ€è¦å—ï¼Ÿ

ä½ å¯ä»¥é€šè¿‡ gcloud / æ§åˆ¶å° / API ä¸‰ç§æ–¹å¼è·å– Organization IDã€‚ä¸‹é¢ç»™ä½ æœ€å¸¸ç”¨ã€æœ€æ¸…æ™°çš„æ–¹æ³•ã€‚

â¸»

âœ… æ–¹æ³• 1ï¼šä½¿ç”¨ gcloudï¼ˆæœ€æ¨èï¼‰

è¿è¡Œï¼š

gcloud organizations list

è¾“å‡ºç¤ºä¾‹ï¼š

DISPLAY_NAME ID
example.com 123456789012

å…¶ä¸­ï¼š
â€¢ ID = 123456789012 å°±æ˜¯ä½ è¦ç”¨çš„ ORG_ID

â¸»

âœ… æ–¹æ³• 2ï¼šä»å½“å‰é¡¹ç›®åæŸ¥ Organization

å¦‚æœä½ ä¸çŸ¥é“é¡¹ç›®å±äºå“ªä¸ª Orgï¼Œå¯ä»¥ç›´æ¥æŸ¥ï¼š

gcloud projects get-ancestors $(gcloud config get-value project)

è¾“å‡ºç¤ºä¾‹ï¼š

type: organization
id: 123456789012
type: folder
id: 456789012345
type: project
id: 998877665544

å…¶ä¸­ï¼š
â€¢ type: organization ä¸‹çš„ id å°±æ˜¯ Organization ID

â¸»

âœ… æ–¹æ³• 3ï¼šä» GCP Console æŸ¥çœ‹ï¼ˆé€‚åˆæˆªå›¾ä½œä¸ºå®¡è®¡è¯æ®ï¼‰

è·¯å¾„ï¼š

Google Cloud Console â†’ IAM & Admin â†’ Settings

å³ä¸Šè§’ä¼šæ˜¾ç¤ºï¼š

Organization: example.com (123456789012)

ä½ å¯ä»¥æˆªå›¾è¿™ä¸ªä½œä¸ºå®¡è®¡ææ–™ã€‚

â¸»

ğŸ“Œ é¢å¤–æç¤ºï¼šå¦‚æœä½ çœ‹åˆ° â€œNo organizationâ€ï¼Ÿ

è¯´æ˜ä½ çš„è´¦å·æ²¡æœ‰åŠ å…¥ Google Workspace / Cloud Identity åŸŸï¼Œ
é‚£ä¹ˆé¡¹ç›®æ˜¯ æ— ç»„ç»‡ï¼ˆNo Orgï¼‰ çš„ã€‚

è¿™æ—¶ä½  æ— æ³•ä½¿ç”¨ Container Threat Detectionï¼ˆCTDï¼‰ï¼Œå› ä¸ºï¼š
â€¢ SCCï¼ˆSecurity Command Centerï¼‰å¿…é¡»å¯ç”¨åœ¨ Organization çº§åˆ«
â€¢ CTD ä¸æ”¯æŒ standalone project

â¸»

ğŸ¯ æœ€åæ€»ç»“ï¼ˆä½ è¦æ‰§è¡Œçš„ï¼‰1. è·å– Org IDï¼š

gcloud organizations list

    2.	ç„¶åéªŒè¯ SCCï¼š

gcloud scc settings get --organization=123456789012

    3.	å†éªŒè¯ Container Threat Detectionï¼š

gcloud scc container-threat-detection settings describe --organization=123456789012

è¿™ä¸‰æ­¥å³å¯å®Œæˆå®¡è®¡è¦æ±‚ã€‚

â¸»

å¦‚ä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥å¸®ä½ æ•´ç†æˆ å®¡è®¡æŠ¥å‘Šæ ¼å¼ï¼ˆMarkdownï¼‰ æˆ–ç”Ÿæˆ K8S/GKE å®‰å…¨åŸºçº¿æ£€æŸ¥æ ‡å‡†æ–‡æ¡£ã€‚
